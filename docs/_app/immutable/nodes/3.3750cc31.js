var ht=Object.defineProperty;var mt=(r,e,t)=>e in r?ht(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var N=(r,e,t)=>(mt(r,typeof e!="symbol"?e+"":e,t),t);import{B as xe,s as Se,f as I,a as E,g as F,h as X,A as te,c as A,d as k,j as g,C as ee,i as C,x as T,D as J,y as he,E as He,F as je,l as fe,m as ce,k as Be,n as be,G as Ve,o as dt,e as ie,H as oe,I as De,J as pt,K as vt,L as Xe,p as gt}from"../chunks/scheduler.e646f8cb.js";import{S as Ie,i as Fe,a as ue,g as yt,t as de,c as _t,b as Oe,d as Pe,m as Ce,e as Me}from"../chunks/index.ceed078a.js";import{$ as wt}from"../chunks/es.c5c32fd6.js";import{w as kt}from"../chunks/index.fdc6412e.js";function pe(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function Tt(){var r,e=0,t=!1;function n(s,i){return r.list.push({type:s,data:i?JSON.parse(JSON.stringify(i)):void 0}),r}return r={list:[],segmentId:function(){return e++},checkIntersection:function(s,i){return n("check",{seg1:s,seg2:i})},segmentChop:function(s,i){return n("div_seg",{seg:s,pt:i}),n("chop",{seg:s,pt:i})},statusRemove:function(s){return n("pop_seg",{seg:s})},segmentUpdate:function(s){return n("seg_update",{seg:s})},segmentNew:function(s,i){return n("new_seg",{seg:s,primary:i})},segmentRemove:function(s){return n("rem_seg",{seg:s})},tempStatus:function(s,i,o){return n("temp_status",{seg:s,above:i,below:o})},rewind:function(s){return n("rewind",{seg:s})},status:function(s,i,o){return n("status",{seg:s,above:i,below:o})},vert:function(s){return s===t?r:(t=s,n("vert",{x:s}))},log:function(s){return typeof s!="string"&&(s=JSON.stringify(s,!1,"  ")),n("log",{txt:s})},reset:function(){return n("reset")},selected:function(s){return n("selected",{segs:s})},chainStart:function(s){return n("chain_start",{seg:s})},chainRemoveHead:function(s,i){return n("chain_rem_head",{index:s,pt:i})},chainRemoveTail:function(s,i){return n("chain_rem_tail",{index:s,pt:i})},chainNew:function(s,i){return n("chain_new",{pt1:s,pt2:i})},chainMatch:function(s){return n("chain_match",{index:s})},chainClose:function(s){return n("chain_close",{index:s})},chainAddHead:function(s,i){return n("chain_add_head",{index:s,pt:i})},chainAddTail:function(s,i){return n("chain_add_tail",{index:s,pt:i})},chainConnect:function(s,i){return n("chain_con",{index1:s,index2:i})},chainReverse:function(s){return n("chain_rev",{index:s})},chainJoin:function(s,i){return n("chain_join",{index1:s,index2:i})},done:function(){return n("done")}},r}var bt=Tt;function St(r){typeof r!="number"&&(r=1e-10);var e={epsilon:function(t){return typeof t=="number"&&(r=t),r},pointAboveOrOnLine:function(t,n,s){var i=n[0],o=n[1],l=s[0],a=s[1],f=t[0],c=t[1];return(l-i)*(c-o)-(a-o)*(f-i)>=-r},pointBetween:function(t,n,s){var i=t[1]-n[1],o=s[0]-n[0],l=t[0]-n[0],a=s[1]-n[1],f=l*o+i*a;if(f<r)return!1;var c=o*o+a*a;return!(f-c>-r)},pointsSameX:function(t,n){return Math.abs(t[0]-n[0])<r},pointsSameY:function(t,n){return Math.abs(t[1]-n[1])<r},pointsSame:function(t,n){return e.pointsSameX(t,n)&&e.pointsSameY(t,n)},pointsCompare:function(t,n){return e.pointsSameX(t,n)?e.pointsSameY(t,n)?0:t[1]<n[1]?-1:1:t[0]<n[0]?-1:1},pointsCollinear:function(t,n,s){var i=t[0]-n[0],o=t[1]-n[1],l=n[0]-s[0],a=n[1]-s[1];return Math.abs(i*a-l*o)<r},linesIntersect:function(t,n,s,i){var o=n[0]-t[0],l=n[1]-t[1],a=i[0]-s[0],f=i[1]-s[1],c=o*f-l*a;if(Math.abs(c)<r)return!1;var v=t[0]-s[0],m=t[1]-s[1],u=(a*m-f*v)/c,h=(o*m-l*v)/c,d={alongA:0,alongB:0,pt:[t[0]+u*o,t[1]+u*l]};return u<=-r?d.alongA=-2:u<r?d.alongA=-1:u-1<=-r?d.alongA=0:u-1<r?d.alongA=1:d.alongA=2,h<=-r?d.alongB=-2:h<r?d.alongB=-1:h-1<=-r?d.alongB=0:h-1<r?d.alongB=1:d.alongB=2,d},pointInsideRegion:function(t,n){for(var s=t[0],i=t[1],o=n[n.length-1][0],l=n[n.length-1][1],a=!1,f=0;f<n.length;f++){var c=n[f][0],v=n[f][1];v-i>r!=l-i>r&&(o-c)*(i-v)/(l-v)+c-s>r&&(a=!a),o=c,l=v}return a}};return e}var It=St,Ft={create:function(){var r={root:{root:!0,next:null},exists:function(e){return!(e===null||e===r.root)},isEmpty:function(){return r.root.next===null},getHead:function(){return r.root.next},insertBefore:function(e,t){for(var n=r.root,s=r.root.next;s!==null;){if(t(s)){e.prev=s.prev,e.next=s,s.prev.next=e,s.prev=e;return}n=s,s=s.next}n.next=e,e.prev=n,e.next=null},findTransition:function(e){for(var t=r.root,n=r.root.next;n!==null&&!e(n);)t=n,n=n.next;return{before:t===r.root?null:t,after:n,insert:function(s){return s.prev=t,s.next=n,t.next=s,n!==null&&(n.prev=s),s}}}};return r},node:function(r){return r.prev=null,r.next=null,r.remove=function(){r.prev.next=r.next,r.next&&(r.next.prev=r.prev),r.prev=null,r.next=null},r}},Nt=Ft,ve=Nt;function Ot(r,e,t){function n(h,d){return{id:t?t.segmentId():-1,start:h,end:d,myFill:{above:null,below:null},otherFill:null}}function s(h,d,p){return{id:t?t.segmentId():-1,start:h,end:d,myFill:{above:p.myFill.above,below:p.myFill.below},otherFill:null}}var i=ve.create();function o(h,d,p,w,b,S){var V=e.pointsCompare(d,b);return V!==0?V:e.pointsSame(p,S)?0:h!==w?h?1:-1:e.pointAboveOrOnLine(p,w?b:S,w?S:b)?1:-1}function l(h,d){i.insertBefore(h,function(p){var w=o(h.isStart,h.pt,d,p.isStart,p.pt,p.other.pt);return w<0})}function a(h,d){var p=ve.node({isStart:!0,pt:h.start,seg:h,primary:d,other:null,status:null});return l(p,h.end),p}function f(h,d,p){var w=ve.node({isStart:!1,pt:d.end,seg:d,primary:p,other:h,status:null});h.other=w,l(w,h.pt)}function c(h,d){var p=a(h,d);return f(p,h,d),p}function v(h,d){t&&t.segmentChop(h.seg,d),h.other.remove(),h.seg.end=d,h.other.pt=d,l(h.other,h.pt)}function m(h,d){var p=s(d,h.seg.end,h.seg);return v(h,d),c(p,h.primary)}function u(h,d){var p=ve.create();function w(_,R){var G=_.seg.start,ne=_.seg.end,H=R.seg.start,q=R.seg.end;return e.pointsCollinear(G,H,q)?e.pointsCollinear(ne,H,q)||e.pointAboveOrOnLine(ne,H,q)?1:-1:e.pointAboveOrOnLine(G,H,q)?1:-1}function b(_){return p.findTransition(function(R){var G=w(_,R.ev);return G>0})}function S(_,R){var G=_.seg,ne=R.seg,H=G.start,q=G.end,le=ne.start,re=ne.end;t&&t.checkIntersection(G,ne);var W=e.linesIntersect(H,q,le,re);if(W===!1){if(!e.pointsCollinear(H,q,le)||e.pointsSame(H,re)||e.pointsSame(q,le))return!1;var Ee=e.pointsSame(H,le),Ae=e.pointsSame(q,re);if(Ee&&Ae)return R;var ut=!Ee&&e.pointBetween(H,le,re),Je=!Ae&&e.pointBetween(q,le,re);if(Ee)return Je?m(R,q):m(_,re),R;ut&&(Ae||(Je?m(R,q):m(_,re)),m(R,H))}else W.alongA===0&&(W.alongB===-1?m(_,le):W.alongB===0?m(_,W.pt):W.alongB===1&&m(_,re)),W.alongB===0&&(W.alongA===-1?m(R,H):W.alongA===0?m(R,W.pt):W.alongA===1&&m(R,q));return!1}for(var V=[];!i.isEmpty();){var y=i.getHead();if(t&&t.vert(y.pt[0]),y.isStart){let _=function(){if(Y){var R=S(y,Y);if(R)return R}return M?S(y,M):!1};t&&t.segmentNew(y.seg,y.primary);var x=b(y),Y=x.before?x.before.ev:null,M=x.after?x.after.ev:null;t&&t.tempStatus(y.seg,Y?Y.seg:!1,M?M.seg:!1);var O=_();if(O){if(r){var B;y.seg.myFill.below===null?B=!0:B=y.seg.myFill.above!==y.seg.myFill.below,B&&(O.seg.myFill.above=!O.seg.myFill.above)}else O.seg.otherFill=y.seg.myFill;t&&t.segmentUpdate(O.seg),y.other.remove(),y.remove()}if(i.getHead()!==y){t&&t.rewind(y.seg);continue}if(r){var B;y.seg.myFill.below===null?B=!0:B=y.seg.myFill.above!==y.seg.myFill.below,M?y.seg.myFill.below=M.seg.myFill.above:y.seg.myFill.below=h,B?y.seg.myFill.above=!y.seg.myFill.below:y.seg.myFill.above=y.seg.myFill.below}else if(y.seg.otherFill===null){var Z;M?y.primary===M.primary?Z=M.seg.otherFill.above:Z=M.seg.myFill.above:Z=y.primary?d:h,y.seg.otherFill={above:Z,below:Z}}t&&t.status(y.seg,Y?Y.seg:!1,M?M.seg:!1),y.other.status=x.insert(ve.node({ev:y}))}else{var D=y.status;if(D===null)throw new Error("PolyBool: Zero-length segment detected; your epsilon is probably too small or too large");if(p.exists(D.prev)&&p.exists(D.next)&&S(D.prev.ev,D.next.ev),t&&t.statusRemove(D.ev.seg),D.remove(),!y.primary){var z=y.seg.myFill;y.seg.myFill=y.seg.otherFill,y.seg.otherFill=z}V.push(y.seg)}i.getHead().remove()}return t&&t.done(),V}return r?{addRegion:function(h){for(var d,p=h[h.length-1],w=0;w<h.length;w++){d=p,p=h[w];var b=e.pointsCompare(d,p);b!==0&&c(n(b<0?d:p,b<0?p:d),!0)}},calculate:function(h){return u(h,!1)}}:{calculate:function(h,d,p,w){return h.forEach(function(b){c(s(b.start,b.end,b),!0)}),p.forEach(function(b){c(s(b.start,b.end,b),!1)}),u(d,w)}}}var Pt=Ot;function Ct(r,e,t){var n=[],s=[];return r.forEach(function(i){var o=i.start,l=i.end;if(e.pointsSame(o,l)){console.warn("PolyBool: Warning: Zero-length segment detected; your epsilon is probably too small or too large");return}t&&t.chainStart(i);var a={index:0,matches_head:!1,matches_pt1:!1},f={index:0,matches_head:!1,matches_pt1:!1},c=a;function v(D,z,_){return c.index=D,c.matches_head=z,c.matches_pt1=_,c===a?(c=f,!1):(c=null,!0)}for(var m=0;m<n.length;m++){var u=n[m],h=u[0];u[1];var d=u[u.length-1];if(u[u.length-2],e.pointsSame(h,o)){if(v(m,!0,!0))break}else if(e.pointsSame(h,l)){if(v(m,!0,!1))break}else if(e.pointsSame(d,o)){if(v(m,!1,!0))break}else if(e.pointsSame(d,l)&&v(m,!1,!1))break}if(c===a){n.push([o,l]),t&&t.chainNew(o,l);return}if(c===f){t&&t.chainMatch(a.index);var p=a.index,w=a.matches_pt1?l:o,b=a.matches_head,u=n[p],S=b?u[0]:u[u.length-1],V=b?u[1]:u[u.length-2],y=b?u[u.length-1]:u[0],x=b?u[u.length-2]:u[1];if(e.pointsCollinear(V,S,w)&&(b?(t&&t.chainRemoveHead(a.index,w),u.shift()):(t&&t.chainRemoveTail(a.index,w),u.pop()),S=V),e.pointsSame(y,w)){n.splice(p,1),e.pointsCollinear(x,y,S)&&(b?(t&&t.chainRemoveTail(a.index,S),u.pop()):(t&&t.chainRemoveHead(a.index,S),u.shift())),t&&t.chainClose(a.index),s.push(u);return}b?(t&&t.chainAddHead(a.index,w),u.unshift(w)):(t&&t.chainAddTail(a.index,w),u.push(w));return}function Y(D){t&&t.chainReverse(D),n[D].reverse()}function M(D,z){var _=n[D],R=n[z],G=_[_.length-1],ne=_[_.length-2],H=R[0],q=R[1];e.pointsCollinear(ne,G,H)&&(t&&t.chainRemoveTail(D,G),_.pop(),G=ne),e.pointsCollinear(G,H,q)&&(t&&t.chainRemoveHead(z,H),R.shift()),t&&t.chainJoin(D,z),n[D]=_.concat(R),n.splice(z,1)}var O=a.index,B=f.index;t&&t.chainConnect(O,B);var Z=n[O].length<n[B].length;a.matches_head?f.matches_head?Z?(Y(O),M(O,B)):(Y(B),M(B,O)):M(B,O):f.matches_head?M(O,B):Z?(Y(O),M(B,O)):(Y(B),M(O,B))}),s}var Mt=Ct;function ge(r,e,t){var n=[];return r.forEach(function(s){var i=(s.myFill.above?8:0)+(s.myFill.below?4:0)+(s.otherFill&&s.otherFill.above?2:0)+(s.otherFill&&s.otherFill.below?1:0);e[i]!==0&&n.push({id:t?t.segmentId():-1,start:s.start,end:s.end,myFill:{above:e[i]===1,below:e[i]===2},otherFill:null})}),t&&t.selected(n),n}var Rt={union:function(r,e){return ge(r,[0,2,1,0,2,2,0,0,1,0,1,0,0,0,0,0],e)},intersect:function(r,e){return ge(r,[0,0,0,0,0,2,0,2,0,0,1,1,0,2,1,0],e)},difference:function(r,e){return ge(r,[0,0,0,0,2,0,2,0,1,1,0,0,0,1,2,0],e)},differenceRev:function(r,e){return ge(r,[0,2,1,0,0,0,1,1,0,2,0,2,0,0,0,0],e)},xor:function(r,e){return ge(r,[0,2,1,0,2,0,0,1,1,0,0,2,0,1,2,0],e)}},Et=Rt,At={toPolygon:function(r,e){function t(i){if(i.length<=0)return r.segments({inverted:!1,regions:[]});function o(f){var c=f.slice(0,f.length-1);return r.segments({inverted:!1,regions:[c]})}for(var l=o(i[0]),a=1;a<i.length;a++)l=r.selectDifference(r.combine(l,o(i[a])));return l}if(e.type==="Polygon")return r.polygon(t(e.coordinates));if(e.type==="MultiPolygon"){for(var n=r.segments({inverted:!1,regions:[]}),s=0;s<e.coordinates.length;s++)n=r.selectUnion(r.combine(n,t(e.coordinates[s])));return r.polygon(n)}throw new Error("PolyBool: Cannot convert GeoJSON object to PolyBool polygon")},fromPolygon:function(r,e,t){t=r.polygon(r.segments(t));function n(u,h){return e.pointInsideRegion([(u[0][0]+u[1][0])*.5,(u[0][1]+u[1][1])*.5],h)}function s(u){return{region:u,children:[]}}var i=s(null);function o(u,h){for(var d=0;d<u.children.length;d++){var p=u.children[d];if(n(h,p.region)){o(p,h);return}}for(var w=s(h),d=0;d<u.children.length;d++){var p=u.children[d];n(p.region,h)&&(w.children.push(p),u.children.splice(d,1),d--)}u.children.push(w)}for(var l=0;l<t.regions.length;l++){var a=t.regions[l];a.length<3||o(i,a)}function f(u,h){for(var d=0,p=u[u.length-1][0],w=u[u.length-1][1],b=[],S=0;S<u.length;S++){var V=u[S][0],y=u[S][1];b.push([V,y]),d+=y*p-V*w,p=V,w=y}var x=d<0;return x!==h&&b.reverse(),b.push([b[0][0],b[0][1]]),b}var c=[];function v(u){var h=[f(u.region,!1)];c.push(h);for(var d=0;d<u.children.length;d++)h.push(m(u.children[d]))}function m(u){for(var h=0;h<u.children.length;h++)v(u.children[h]);return f(u.region,!0)}for(var l=0;l<i.children.length;l++)v(i.children[l]);return c.length<=0?{type:"Polygon",coordinates:[]}:c.length==1?{type:"Polygon",coordinates:c[0]}:{type:"MultiPolygon",coordinates:c}}},xt=At;/*
 * @copyright 2016 Sean Connelly (@voidqk), http://syntheti.cc
 * @license MIT
 * @preserve Project Home: https://github.com/voidqk/polybooljs
 */var Bt=bt,Dt=It,Ye=Pt,zt=Mt,ye=Et,Ke=xt,Q=!1,_e=Dt(),K;K={buildLog:function(r){return r===!0?Q=Bt():r===!1&&(Q=!1),Q===!1?!1:Q.list},epsilon:function(r){return _e.epsilon(r)},segments:function(r){var e=Ye(!0,_e,Q);return r.regions.forEach(e.addRegion),{segments:e.calculate(r.inverted),inverted:r.inverted}},combine:function(r,e){var t=Ye(!1,_e,Q);return{combined:t.calculate(r.segments,r.inverted,e.segments,e.inverted),inverted1:r.inverted,inverted2:e.inverted}},selectUnion:function(r){return{segments:ye.union(r.combined,Q),inverted:r.inverted1||r.inverted2}},selectIntersect:function(r){return{segments:ye.intersect(r.combined,Q),inverted:r.inverted1&&r.inverted2}},selectDifference:function(r){return{segments:ye.difference(r.combined,Q),inverted:r.inverted1&&!r.inverted2}},selectDifferenceRev:function(r){return{segments:ye.differenceRev(r.combined,Q),inverted:!r.inverted1&&r.inverted2}},selectXor:function(r){return{segments:ye.xor(r.combined,Q),inverted:r.inverted1!==r.inverted2}},polygon:function(r){return{regions:zt(r.segments,_e,Q),inverted:r.inverted}},polygonFromGeoJSON:function(r){return Ke.toPolygon(K,r)},polygonToGeoJSON:function(r){return Ke.fromPolygon(K,_e,r)},union:function(r,e){return we(r,e,K.selectUnion)},intersect:function(r,e){return we(r,e,K.selectIntersect)},difference:function(r,e){return we(r,e,K.selectDifference)},differenceRev:function(r,e){return we(r,e,K.selectDifferenceRev)},xor:function(r,e){return we(r,e,K.selectXor)}};function we(r,e,t){var n=K.segments(r),s=K.segments(e),i=K.combine(n,s),o=t(i);return K.polygon(o)}typeof window=="object"&&(window.PolyBool=K);var ke=K;class Ne{static union(e,t){return ke.union(e,t)}static intersect(e,t){return ke.intersect(e,t)}static difference(e,t){return ke.difference(e,t)}static differenceRev(e,t){return ke.differenceRev(e,t)}static xor(e,t){return ke.xor(e,t)}}class L{constructor(e){N(this,"polygons",[]);N(this,"unoptimizedUnionVectors",[]);this.polygons=e}fastUnion(e){const t=new L(this.polygons);return t.unoptimizedUnionVectors=this.unoptimizedUnionVectors.concat([e]),t}union(e){const t=Ne.union({regions:this.polygons.map(n=>n.nodes),inverted:!1},{regions:e.polygons.map(n=>n.nodes),inverted:!1});return new L(t.regions.map(n=>({nodes:n})))}intersect(e){const t=Ne.intersect({regions:this.polygons.map(n=>n.nodes),inverted:!1},{regions:e.polygons.map(n=>n.nodes),inverted:!1});return new L(t.regions.map(n=>({nodes:n})))}difference(e){const t=Ne.difference({regions:this.polygons.map(n=>n.nodes),inverted:!1},{regions:e.polygons.map(n=>n.nodes),inverted:!1});return new L(t.regions.map(n=>({nodes:n})))}xor(e){const t=Ne.xor({regions:this.polygons.map(n=>n.nodes),inverted:!1},{regions:e.polygons.map(n=>n.nodes),inverted:!1});return new L(t.regions.map(n=>({nodes:n})))}optimize(){let e=new L(this.polygons);for(const t of this.unoptimizedUnionVectors)e=e.union(t);return e}}class ft{static square(e,t,n,s){return new L([{nodes:[[e,t],[e+n,t],[e+n,t+s],[e,t+s]]}])}static circle(e,t,n,s,i=0){const o={nodes:[]};for(let l=0;l<Math.PI*2;l+=Math.PI/s){const a=l+i;o.nodes.push([e+Math.cos(a)*n,t+Math.sin(a)*n])}return new L([o])}}var j=(r=>(r[r.Point=0]="Point",r[r.MajorCity=1]="MajorCity",r[r.City=2]="City",r[r.Town=3]="Town",r[r.Village=4]="Village",r[r.PointOfInterest=99]="PointOfInterest",r))(j||{});const Ge={0:"Point",1:"Major City",2:"City",3:"Town",4:"Village",99:"Point of Interest"};class ze{constructor(){N(this,"version",1);N(this,"terrain",{vector:new L([])});N(this,"features",[]);N(this,"paths",[]);N(this,"points",[])}}class Te{static newMap(){return new ze}static async uploadMap(){const e=await Te.fileDialog(),t=new ze;if(typeof e=="string")return Object.assign(t,JSON.parse(e)),t.terrain.vector=new L(t.terrain.vector.polygons),t.features.forEach(n=>{n.vector=new L(n.vector.polygons)}),t}static async fileDialog(){return new Promise(e=>{const t=document.createElement("input");t.type="file",t.onchange=()=>{const n=t.files;if(n){const s=new FileReader;return s.onload=function(i){var o;return e(((o=i.target)==null?void 0:o.result)||"")},s.readAsText(n[0])}return e(void 0)},t.click()})}static downloadMap(e){const t=document.createElement("a");wt.capture("save_map",{model:e}),t.href="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),t.download="map.json",t.click()}}var Ut=Object.defineProperty,Ht=(r,e,t)=>e in r?Ut(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,jt=(r,e,t)=>(Ht(r,typeof e!="symbol"?e+"":e,t),t);const qe=class{static register(e,t){this.listeners.push({key:e.key,modifiers:e.modifiers,callback:t})}};jt(qe,"listeners",[]);typeof document<"u"?document.addEventListener("keydown",r=>{if(!(r.target&&"tagName"in r.target&&r.target.tagName==="INPUT"))for(const e of qe.listeners)r.key===e.key&&e.callback()}):console.error("No document on keybind registration. No keybinds will work");let me=qe;class Ue{constructor(e){this.model=e}getNearestPoint(e,t,n){const s=n*n;let i,o=1/0;for(const l of this.model.points){const a=(l.x-e)*(l.x-e)+(l.y-t)*(l.y-t);a<=s&&a<o&&(i=l,o=a)}return i}}const se=kt(void 0),Re=class Re{constructor(e,t,n,s){this.x=e,this.y=t,this.width=n,this.height=s}};N(Re,"NO_PAINT",new Re(0,0,0,0));let U=Re;const Vt=[{id:j.MajorCity,label:"Major City"},{id:j.City,label:"City"},{id:j.Town,label:"Town"},{id:j.Village,label:"Village"},{id:j.PointOfInterest,label:"PointOfInterest"}];class qt{getOptions(){return[{name:"Type",key:"type",type:"enum",options:Vt}]}click(e,t,n){if(new Ue(t).getNearestPoint(e.x,e.y,5))return U.NO_PAINT;{const i={x:e.x,y:e.y,type:n.type,name:""};t.points.push(i),se.set(i)}}pressDown(){return U.NO_PAINT}release(){return U.NO_PAINT}render(){}}class Jt{constructor(){N(this,"radius",10)}getOptions(){return[]}click(e,t){const n=new Ue(t).getNearestPoint(e.x,e.y,this.radius);return n?(se.set(n),U.NO_PAINT):(se.set(void 0),U.NO_PAINT)}pressDown(e){const t=xe(se);if(t){t.x=e.x,t.y=e.y;return}return U.NO_PAINT}release(){return U.NO_PAINT}render(e,t,n,s){const i=new Ue(s).getNearestPoint(e[0],e[1],this.radius);i&&(n.strokeStyle="#7EBDC3",n.lineWidth=1,n.strokeRect(i.x-this.radius,i.y-this.radius,this.radius*2,this.radius*2));const o=xe(se);o&&(n.strokeStyle="#7EBDC3",n.lineWidth=2,n.strokeRect(o.x-this.radius,o.y-this.radius,this.radius*2,this.radius*2))}}class Xt{getOptions(){return[{key:"size",name:"Size",type:"number",default:25,min:5,max:100,step:1},{key:"erase",name:"Erase",type:"boolean"}]}click(){return U.NO_PAINT}pressDown(e,t,n){const s=Math.ceil(n.size/(8*Math.PI))+3,i=ft.circle(e.x,e.y,n.size,s,Math.random()*Math.PI);t.features.length===0&&t.features.push({type:"forest",vector:new L([])}),n.erase?t.features[0].vector=t.features[0].vector.difference(i):t.features[0].vector=t.features[0].vector.union(i)}release(e,t){t.features[0].vector=t.features[0].vector.optimize()}render(e,t,n){n.beginPath(),n.fillStyle="#FFFFFF50",n.arc(e[0],e[1],t.size,0,Math.PI*2),n.fill()}}class Yt{getOptions(){return[{key:"size",name:"Size",type:"number",default:25,min:5,max:100,step:1},{key:"erase",name:"Erase",type:"boolean"}]}click(){return U.NO_PAINT}pressDown(e,t,n){const s=Math.ceil(n.size/(2*Math.PI))+3,i=ft.circle(e.x,e.y,n.size,s,Math.random()*Math.PI);n.erase?t.terrain.vector=t.terrain.vector.difference(i):t.terrain.vector=t.terrain.vector.union(i)}release(e,t){t.terrain.vector=t.terrain.vector.optimize()}render(e,t,n){n.beginPath(),n.fillStyle="#FFFFFF50",n.arc(e[0],e[1],t.size,0,Math.PI*2),n.fill()}}class ct{async preload(){}render(e,t){t.clearRect(0,0,1200,860);for(let n=0;n<e.paths.length;n++)this.renderPath(e.paths[n],t)}renderPath(e,t){t.beginPath(),t.moveTo(e.nodes[0][0],e.nodes[0][1]);for(let n=1;n<e.nodes.length;n++){const s=this.midPointBtw(e.nodes[n-1],e.nodes[n]);t.quadraticCurveTo(e.nodes[n-1][0],e.nodes[n-1][1],s[0],s[1])}t.lineTo(e.nodes[e.nodes.length-1][0],e.nodes[e.nodes.length-1][1]),t.filter="blur(0.1px)",t.strokeStyle="#381d0aA0",t.lineWidth=2,t.lineCap="round",t.setLineDash([6,4]),t.stroke()}midPointBtw(e,t){return[e[0]+(t[0]-e[0])/2,e[1]+(t[1]-e[1])/2]}}class Kt{constructor(){N(this,"nodes",[])}getOptions(){return[]}click(e,t){if(this.nodes.length>=1&&this.nodes[this.nodes.length-1][0]===e.x&&this.nodes[this.nodes.length-1][1]===e.y){t.paths.push({nodes:this.nodes});const n={minx:1/0,miny:1/0,maxx:-1/0,maxy:-1/0};for(const s of this.nodes)n.minx=Math.min(n.minx,s[0]),n.miny=Math.min(n.miny,s[0]),n.maxx=Math.max(n.maxx,s[1]),n.maxy=Math.max(n.maxy,s[1]);return this.nodes=[],new U(n.minx,n.miny,n.maxx-n.minx,n.maxy-n.miny)}return this.nodes.push([e.x,e.y]),U.NO_PAINT}pressDown(){return U.NO_PAINT}release(){return U.NO_PAINT}render(e,t,n){if(this.nodes.length>0){const s=this.nodes.concat([e]);new ct().renderPath({nodes:s},n)}}}function Gt(r){let e,t,n='<i class="fa fa-file"></i>',s,i,o='<i class="fa fa-floppy-disk"></i>',l,a,f='<i class="fa fa-folder-open"></i>',c,v,m,u,h='<i class="fa fa-arrow-pointer"></i>',d,p,w='<i class="fa fa-paintbrush"></i>',b,S,V='<i class="fa fa-landmark"></i>',y,x,Y='<i class="fa fa-tree"></i>',M,O,B='<i class="fa fa-road"></i>',Z,D;return{c(){e=I("div"),t=I("button"),t.innerHTML=n,s=E(),i=I("button"),i.innerHTML=o,l=E(),a=I("button"),a.innerHTML=f,c=E(),v=I("hr"),m=E(),u=I("button"),u.innerHTML=h,d=E(),p=I("button"),p.innerHTML=w,b=E(),S=I("button"),S.innerHTML=V,y=E(),x=I("button"),x.innerHTML=Y,M=E(),O=I("button"),O.innerHTML=B,this.h()},l(z){e=F(z,"DIV",{class:!0});var _=X(e);t=F(_,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),te(t)!=="svelte-1m01bc9"&&(t.innerHTML=n),s=A(_),i=F(_,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),te(i)!=="svelte-1gea4ds"&&(i.innerHTML=o),l=A(_),a=F(_,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),te(a)!=="svelte-18vhduo"&&(a.innerHTML=f),c=A(_),v=F(_,"HR",{class:!0}),m=A(_),u=F(_,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),te(u)!=="svelte-1n6mnah"&&(u.innerHTML=h),d=A(_),p=F(_,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),te(p)!=="svelte-1q2mh60"&&(p.innerHTML=w),b=A(_),S=F(_,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),te(S)!=="svelte-10fbohv"&&(S.innerHTML=V),y=A(_),x=F(_,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),te(x)!=="svelte-dgiflo"&&(x.innerHTML=Y),M=A(_),O=F(_,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),te(O)!=="svelte-1gmqo2i"&&(O.innerHTML=B),_.forEach(k),this.h()},h(){g(t,"title","New map"),g(t,"class","svelte-1ecqtnm"),g(i,"title","Save map"),g(i,"class","svelte-1ecqtnm"),g(a,"title","Upload map"),g(a,"class","svelte-1ecqtnm"),g(v,"class","svelte-1ecqtnm"),g(u,"title","Selection tool (S)"),g(u,"class","svelte-1ecqtnm"),ee(u,"selected",r[0]==="select"),g(p,"title","Terrain tool (T)"),g(p,"class","svelte-1ecqtnm"),ee(p,"selected",r[0]==="terrain"),g(S,"title","Settlement tool (E)"),g(S,"class","svelte-1ecqtnm"),ee(S,"selected",r[0]==="point"),g(x,"title","Forest tool (F)"),g(x,"class","svelte-1ecqtnm"),ee(x,"selected",r[0]==="forest"),g(O,"title","Path tool (P)"),g(O,"class","svelte-1ecqtnm"),ee(O,"selected",r[0]==="path"),g(e,"class","toolbar svelte-1ecqtnm")},m(z,_){C(z,e,_),T(e,t),T(e,s),T(e,i),T(e,l),T(e,a),T(e,c),T(e,v),T(e,m),T(e,u),T(e,d),T(e,p),T(e,b),T(e,S),T(e,y),T(e,x),T(e,M),T(e,O),Z||(D=[J(t,"click",r[1]),J(i,"click",r[3]),J(a,"click",r[2]),J(u,"click",r[5]),J(p,"click",r[6]),J(S,"click",r[7]),J(x,"click",r[8]),J(O,"click",r[9])],Z=!0)},p(z,[_]){_&1&&ee(u,"selected",z[0]==="select"),_&1&&ee(p,"selected",z[0]==="terrain"),_&1&&ee(S,"selected",z[0]==="point"),_&1&&ee(x,"selected",z[0]==="forest"),_&1&&ee(O,"selected",z[0]==="path")},i:he,o:he,d(z){z&&k(e),Z=!1,He(D)}}}function Lt(r,e,t){const n=je(),s={select:new Jt,terrain:new Yt,point:new qt,forest:new Xt,path:new Kt};let{selectedToolKey:i="terrain"}=e,{model:o}=e;setTimeout(()=>{n("toolSelected",s[i])},200);function l(){n("modelReplaced",Te.newMap())}async function a(){const d=await Te.uploadMap();d&&n("modelReplaced",d)}function f(){Te.downloadMap(o)}me.register({key:"s"},()=>t(0,i="select")),me.register({key:"t"},()=>t(0,i="terrain")),me.register({key:"e"},()=>t(0,i="point")),me.register({key:"f"},()=>t(0,i="forest")),me.register({key:"p"},()=>t(0,i="path"));const c=()=>t(0,i="select"),v=()=>t(0,i="terrain"),m=()=>t(0,i="point"),u=()=>t(0,i="forest"),h=()=>t(0,i="path");return r.$$set=d=>{"selectedToolKey"in d&&t(0,i=d.selectedToolKey),"model"in d&&t(4,o=d.model)},r.$$.update=()=>{r.$$.dirty&1&&n("toolSelected",s[i])},[i,l,a,f,o,c,v,m,u,h]}class Zt extends Ie{constructor(e){super(),Fe(this,e,Lt,Gt,Se,{selectedToolKey:0,model:4})}}const P=class P{static async preload(e){let n=0;e(n++/8,"Loading water.png"),P.water=await P.loadImage("/images/map/water.png"),e(n++/8,"Loading grass.png"),P.grass=await P.loadImage("/images/map/grass.png"),e(n++/8,"Loading settlement-major-city.png"),P.majorCity=await P.loadImage("/images/map/settlement-major-city.png"),e(n++/8,"Loading settlement-city.png"),P.city=await P.loadImage("/images/map/settlement-city.png"),e(n++/8,"Loading settlement-town.png"),P.town=await P.loadImage("/images/map/settlement-town.png"),e(n++/8,"Loading settlement-village.png"),P.village=await P.loadImage("/images/map/settlement-village.png"),e(n++/8,"Loading settlement-poi.png"),P.pointOfInterest=await P.loadImage("/images/map/settlement-poi.png"),e(n++/8,"Loading tree-1.png"),P.tree=await P.loadImage("/images/map/tree-1.png")}static async loadImage(e){const t=new Image,n=new Promise(s=>t.onload=s);return t.src=P.getPath(e),await n,t}static getPath(e){return document.location.href.includes("github")?"/cartoga"+e:e}};N(P,"water"),N(P,"grass"),N(P,"majorCity"),N(P,"city"),N(P,"town"),N(P,"village"),N(P,"pointOfInterest"),N(P,"tree");let $=P;class Qt{constructor(){N(this,"textures",new Map);N(this,"nameOptions",new Map)}async preload(){this.textures.set(j.MajorCity,$.majorCity),this.textures.set(j.City,$.city),this.textures.set(j.Town,$.town),this.textures.set(j.Village,$.village),this.textures.set(j.PointOfInterest,$.pointOfInterest),this.nameOptions.set(j.MajorCity,{render:!0,fontSize:14}),this.nameOptions.set(j.City,{render:!0,fontSize:12}),this.nameOptions.set(j.Town,{render:!0,fontSize:8}),this.nameOptions.set(j.Village,{render:!1,fontSize:0}),this.nameOptions.set(j.PointOfInterest,{render:!0,fontSize:8})}render(e,t){var n,s;t.clearRect(0,0,1200,860);for(const i of e.points){const o=this.textures.get(i.type);let l=5;o?(l=o.height,t.drawImage(o,i.x-o.width/2,i.y-o.height/2)):(t.strokeStyle="#381d0a",t.beginPath(),t.rect(i.x,i.y,5,5),t.stroke()),"name"in i&&((n=this.nameOptions.get(i.type))!=null&&n.render)&&(t.filter="blur(2px)",t.textAlign="center",t.fillStyle="white",t.font=`${(s=this.nameOptions.get(i.type))==null?void 0:s.fontSize}px Eczar`,t.fillText(new String(i.name).toString(),i.x,i.y+l),t.filter="none",t.fillStyle="#381d0a",t.fillText(new String(i.name).toString(),i.x,i.y+l))}}}class Wt{constructor(){N(this,"offsets");N(this,"stampSize",[14,16]);N(this,"spacing",10)}async preload(){}render(e,t){this.offsets||(this.offsets=this.computeOffsets()),t.clearRect(0,0,1200,860),t.filter="blur(4px)",this.drawVector(e,t),t.filter="none",this.drawStamps(e,t)}drawVector(e,t){for(const n of e.features){t.beginPath();for(let s=0;s<n.vector.polygons.length;s++){const i=n.vector.polygons[s];t.moveTo(i.nodes[0][0],i.nodes[0][1]);for(let o=1;o<i.nodes.length;o++)t.lineTo(i.nodes[o][0],i.nodes[o][1])}t.strokeStyle="#381d0a30",t.fillStyle="#381d0a40",t.fill("evenodd"),t.stroke()}}drawStamps(e,t){const n=t.getImageData(0,0,1200,860);for(let s=0;s<1200/this.spacing;s++)for(let i=0;i<860/this.spacing;i++){const o=this.offsets[s][i],l=[Math.round(s*this.spacing+o[0]),Math.round(i*this.spacing+o[1])];n.data[l[1]*(n.width*4)+l[0]*4+3]>=32&&t.drawImage($.tree,l[0]-this.stampSize[0]/2,l[1]-this.stampSize[1]/2)}}computeOffsets(){const e=[];for(let t=0;t<1200/this.spacing;t++){e.push([]);for(let n=0;n<860/this.spacing;n++)e[t][n]=[Math.random()*this.spacing*.7,Math.random()*this.spacing*.7]}return e}}class $t{constructor(){N(this,"grassPattern")}async preload(){}render(e,t,n){if(!this.grassPattern){const s=t.createPattern($.grass,"repeat");s&&(this.grassPattern=s)}t.fillStyle=this.grassPattern||"#003000FF",t.clearRect(0,0,1200,860),t.beginPath();for(let s=0;s<e.terrain.vector.polygons.length;s++){const i=e.terrain.vector.polygons[s];t.moveTo(i.nodes[0][0],i.nodes[0][1]);for(let o=1;o<i.nodes.length;o++)t.lineTo(i.nodes[o][0],i.nodes[o][1]);t.closePath()}t.strokeStyle="#FFFFFF30",t.filter="blur(8px)",t.lineWidth=32,t.stroke(),t.filter="none",t.fill("evenodd"),t.strokeStyle="#381d0a30",t.lineWidth=3,t.stroke();for(let s=0;s<e.terrain.vector.unoptimizedUnionVectors.length;s++){const i=e.terrain.vector.unoptimizedUnionVectors[s];t.beginPath();for(let o=0;o<i.polygons.length;o++){const l=i.polygons[o];t.moveTo(l.nodes[0][0],l.nodes[0][1]);for(let a=1;a<l.nodes.length;a++)t.lineTo(l.nodes[a][0],l.nodes[a][1])}t.fill("evenodd")}}}const ae={background:0,terrain:1,terrainFeatures:2,paths:3,points:4,tool:5};class en{constructor(){N(this,"terrainRenderer");N(this,"terrainFeatureRenderer");N(this,"pointRenderer");N(this,"pathRenderer",new ct);this.terrainRenderer=new $t,this.terrainFeatureRenderer=new Wt,this.pointRenderer=new Qt,!(typeof document>"u")&&(setTimeout(()=>this.terrainRenderer.preload(),100),setTimeout(()=>this.terrainFeatureRenderer.preload(),100),setTimeout(()=>this.pointRenderer.preload(),100))}renderBackground(e,t,n){const s=t.createPattern($.water,"repeat");s&&(t.fillStyle=s,t.fillRect(n.x,n.y,n.width,n.height))}renderTerrain(e,t,n){this.terrainRenderer.render(e,t,n)}renderTerrainFeatures(e,t){this.terrainFeatureRenderer.render(e,t)}renderPoints(e,t){this.pointRenderer.render(e,t)}renderPaths(e,t){this.pathRenderer.render(e,t)}renderTool(e,t,n,s,i){s.clearRect(0,0,1200,860),e.render(t,n,s,i)}}function tn(r){let e,t,n,s,i,o=r[0]*100+"",l,a,f,c,v;return{c(){e=I("div"),t=I("div"),n=I("div"),s=E(),i=I("span"),l=fe(o),a=fe("%"),f=E(),c=I("span"),v=fe(r[1]),this.h()},l(m){e=F(m,"DIV",{class:!0});var u=X(e);t=F(u,"DIV",{class:!0});var h=X(t);n=F(h,"DIV",{class:!0,style:!0}),X(n).forEach(k),s=A(h),i=F(h,"SPAN",{class:!0});var d=X(i);l=ce(d,o),a=ce(d,"%"),d.forEach(k),h.forEach(k),f=A(u),c=F(u,"SPAN",{});var p=X(c);v=ce(p,r[1]),p.forEach(k),u.forEach(k),this.h()},h(){g(n,"class","progress-complete svelte-caggyw"),Be(n,"width",r[0]*100+"%"),g(i,"class","svelte-caggyw"),g(t,"class","progress svelte-caggyw"),g(e,"class","loading svelte-caggyw")},m(m,u){C(m,e,u),T(e,t),T(t,n),T(t,s),T(t,i),T(i,l),T(i,a),T(e,f),T(e,c),T(c,v)},p(m,[u]){u&1&&Be(n,"width",m[0]*100+"%"),u&1&&o!==(o=m[0]*100+"")&&be(l,o),u&2&&be(v,m[1])},i:he,o:he,d(m){m&&k(e)}}}function nn(r,e,t){let{progress:n=0}=e,{message:s="Loading"}=e;return r.$$set=i=>{"progress"in i&&t(0,n=i.progress),"message"in i&&t(1,s=i.message)},[n,s]}class rn extends Ie{constructor(e){super(),Fe(this,e,nn,tn,Se,{progress:0,message:1})}}function Le(r,e,t){const n=r.slice();return n[7]=e[t],n}function Ze(r){let e,t;return e=new rn({props:{progress:r[0].progress,message:r[0].message}}),{c(){Oe(e.$$.fragment)},l(n){Pe(e.$$.fragment,n)},m(n,s){Ce(e,n,s),t=!0},p(n,s){const i={};s&1&&(i.progress=n[0].progress),s&1&&(i.message=n[0].message),e.$set(i)},i(n){t||(ue(e.$$.fragment,n),t=!0)},o(n){de(e.$$.fragment,n),t=!1},d(n){Me(e,n)}}}function Qe(r){let e;return{c(){e=I("canvas"),this.h()},l(t){e=F(t,"CANVAS",{id:!0,width:!0,height:!0,style:!0,class:!0}),X(e).forEach(k),this.h()},h(){g(e,"id","layer-"+r[7]),g(e,"width","1200"),g(e,"height","860"),Be(e,"border","1px solid #000000"),g(e,"class","svelte-1cguo7c")},m(t,n){C(t,e,n)},p:he,d(t){t&&k(e)}}}function sn(r){let e,t,n,s=r[0]&&Ze(r),i=pe(Object.values(ae)),o=[];for(let l=0;l<i.length;l+=1)o[l]=Qe(Le(r,i,l));return{c(){s&&s.c(),e=E(),t=I("div");for(let l=0;l<o.length;l+=1)o[l].c();this.h()},l(l){s&&s.l(l),e=A(l),t=F(l,"DIV",{class:!0});var a=X(t);for(let f=0;f<o.length;f+=1)o[f].l(a);a.forEach(k),this.h()},h(){g(t,"class","canvas-container svelte-1cguo7c")},m(l,a){s&&s.m(l,a),C(l,e,a),C(l,t,a);for(let f=0;f<o.length;f+=1)o[f]&&o[f].m(t,null);n=!0},p(l,[a]){if(l[0]?s?(s.p(l,a),a&1&&ue(s,1)):(s=Ze(l),s.c(),ue(s,1),s.m(e.parentNode,e)):s&&(yt(),de(s,1,1,()=>{s=null}),_t()),a&0){i=pe(Object.values(ae));let f;for(f=0;f<i.length;f+=1){const c=Le(l,i,f);o[f]?o[f].p(c,a):(o[f]=Qe(c),o[f].c(),o[f].m(t,null))}for(;f<o.length;f+=1)o[f].d(1);o.length=i.length}},i(l){n||(ue(s),n=!0)},o(l){de(s),n=!1},d(l){l&&(k(e),k(t)),s&&s.d(l),Ve(o,l)}}}function on(r,e,t){const n=je();let{model:s}=e;const i=new en;let o=[],l={progress:0,message:"Initializing"};dt(async()=>{await $.preload((m,u)=>t(0,l={progress:m,message:u})),t(0,l=void 0);const c=Array.from(document.querySelectorAll("canvas"));o=c.map(m=>m.getContext("2d"));const v=c[c.length-1];a(),i.renderBackground(s,o[0],new U(0,0,1200,860)),v.addEventListener("mousedown",m=>{n("click",{x:m.clientX-(v.offsetLeft??0),y:m.clientY-(v.offsetTop??0)}),n("pressDown",{x:m.clientX-(v.offsetLeft??0),y:m.clientY-(v.offsetTop??0)})}),v.addEventListener("mousemove",m=>{m.buttons===1&&n("pressDown",{x:m.clientX-(v.offsetLeft??0),y:m.clientY-(v.offsetTop??0)}),n("move",{x:m.clientX-(v.offsetLeft??0),y:m.clientY-(v.offsetTop??0)})}),v.addEventListener("mouseup",m=>{n("release",{x:m.clientX-(v.offsetLeft??0),y:m.clientY-(v.offsetTop??0)})})});function a(c){const v=c??new U(0,0,1200,860);i.renderTerrain(s,o[ae.terrain],v),i.renderTerrainFeatures(s,o[ae.terrainFeatures]),i.renderPoints(s,o[ae.points]),i.renderPaths(s,o[ae.paths])}function f(c,v,m){i.renderTool(c,v,m,o[ae.tool],s)}return r.$$set=c=>{"model"in c&&t(1,s=c.model)},[l,s,a,f]}class ln extends Ie{constructor(e){super(),Fe(this,e,on,sn,Se,{model:1,render:2,renderTool:3})}get render(){return this.$$.ctx[2]}get renderTool(){return this.$$.ctx[3]}}function We(r,e,t){const n=r.slice();return n[11]=e[t],n[12]=e,n[13]=t,n}function $e(r,e,t){const n=r.slice();return n[14]=e[t],n}function et(r){let e,t="Tool options",n,s,i=pe(r[0].getOptions()),o=[];for(let l=0;l<i.length;l+=1)o[l]=ot(We(r,i,l));return{c(){e=I("h2"),e.textContent=t,n=E();for(let l=0;l<o.length;l+=1)o[l].c();s=ie(),this.h()},l(l){e=F(l,"H2",{class:!0,"data-svelte-h":!0}),te(e)!=="svelte-sit87u"&&(e.textContent=t),n=A(l);for(let a=0;a<o.length;a+=1)o[a].l(l);s=ie(),this.h()},h(){g(e,"class","svelte-12rgorr")},m(l,a){C(l,e,a),C(l,n,a);for(let f=0;f<o.length;f+=1)o[f]&&o[f].m(l,a);C(l,s,a)},p(l,a){if(a&3){i=pe(l[0].getOptions());let f;for(f=0;f<i.length;f+=1){const c=We(l,i,f);o[f]?o[f].p(c,a):(o[f]=ot(c),o[f].c(),o[f].m(s.parentNode,s))}for(;f<o.length;f+=1)o[f].d(1);o.length=i.length}},d(l){l&&(k(e),k(n),k(s)),Ve(o,l)}}}function tt(r){let e,t,n,s,i,o;function l(){r[5].call(e,r[11])}let a="min"in r[11]&&nt(r);return{c(){e=I("input"),n=E(),a&&a.c(),s=ie(),this.h()},l(f){e=F(f,"INPUT",{name:!0,type:!0,class:!0}),n=A(f),a&&a.l(f),s=ie(),this.h()},h(){g(e,"name",t=r[11].key),g(e,"type","number"),g(e,"class","svelte-12rgorr")},m(f,c){C(f,e,c),oe(e,r[1][r[11].key]),C(f,n,c),a&&a.m(f,c),C(f,s,c),i||(o=J(e,"input",l),i=!0)},p(f,c){r=f,c&1&&t!==(t=r[11].key)&&g(e,"name",t),c&3&&De(e.value)!==r[1][r[11].key]&&oe(e,r[1][r[11].key]),"min"in r[11]?a?a.p(r,c):(a=nt(r),a.c(),a.m(s.parentNode,s)):a&&(a.d(1),a=null)},d(f){f&&(k(e),k(n),k(s)),a&&a.d(f),i=!1,o()}}}function nt(r){let e,t,n,s,i,o,l;function a(){r[6].call(e,r[11])}return{c(){e=I("input"),this.h()},l(f){e=F(f,"INPUT",{name:!0,type:!0,min:!0,max:!0,step:!0,class:!0}),this.h()},h(){g(e,"name",t=r[11].key),g(e,"type","range"),g(e,"min",n=r[11].min),g(e,"max",s=r[11].max),g(e,"step",i=r[11].step),g(e,"class","svelte-12rgorr")},m(f,c){C(f,e,c),oe(e,r[1][r[11].key]),o||(l=[J(e,"change",a),J(e,"input",a)],o=!0)},p(f,c){r=f,c&1&&t!==(t=r[11].key)&&g(e,"name",t),c&1&&n!==(n=r[11].min)&&g(e,"min",n),c&1&&s!==(s=r[11].max)&&g(e,"max",s),c&1&&i!==(i=r[11].step)&&g(e,"step",i),c&3&&oe(e,r[1][r[11].key])},d(f){f&&k(e),o=!1,He(l)}}}function rt(r){let e,t,n,s;function i(){r[7].call(e,r[11])}return{c(){e=I("input"),this.h()},l(o){e=F(o,"INPUT",{name:!0,type:!0,class:!0}),this.h()},h(){g(e,"name",t=r[11].key),g(e,"type","checkbox"),g(e,"class","svelte-12rgorr")},m(o,l){C(o,e,l),e.checked=r[1][r[11].key],n||(s=J(e,"change",i),n=!0)},p(o,l){r=o,l&1&&t!==(t=r[11].key)&&g(e,"name",t),l&3&&(e.checked=r[1][r[11].key])},d(o){o&&k(e),n=!1,s()}}}function st(r){let e,t,n,s,i=pe(r[11].options),o=[];for(let a=0;a<i.length;a+=1)o[a]=it($e(r,i,a));function l(){r[8].call(e,r[11])}return{c(){e=I("select");for(let a=0;a<o.length;a+=1)o[a].c();this.h()},l(a){e=F(a,"SELECT",{name:!0,class:!0});var f=X(e);for(let c=0;c<o.length;c+=1)o[c].l(f);f.forEach(k),this.h()},h(){g(e,"name",t=r[11].key),g(e,"class","svelte-12rgorr"),r[1][r[11].key]===void 0&&vt(l)},m(a,f){C(a,e,f);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(e,null);Xe(e,r[1][r[11].key],!0),n||(s=J(e,"change",l),n=!0)},p(a,f){if(r=a,f&1){i=pe(r[11].options);let c;for(c=0;c<i.length;c+=1){const v=$e(r,i,c);o[c]?o[c].p(v,f):(o[c]=it(v),o[c].c(),o[c].m(e,null))}for(;c<o.length;c+=1)o[c].d(1);o.length=i.length}f&1&&t!==(t=r[11].key)&&g(e,"name",t),f&3&&Xe(e,r[1][r[11].key])},d(a){a&&k(e),Ve(o,a),n=!1,s()}}}function it(r){let e,t=r[14].label+"",n,s;return{c(){e=I("option"),n=fe(t),this.h()},l(i){e=F(i,"OPTION",{});var o=X(e);n=ce(o,t),o.forEach(k),this.h()},h(){e.__value=s=r[14].id,oe(e,e.__value)},m(i,o){C(i,e,o),T(e,n)},p(i,o){o&1&&t!==(t=i[14].label+"")&&be(n,t),o&1&&s!==(s=i[14].id)&&(e.__value=s,oe(e,e.__value))},d(i){i&&k(e)}}}function ot(r){let e,t,n=r[11].name+"",s,i,o,l,a,f,c=r[11].type==="number"&&tt(r),v=r[11].type==="boolean"&&rt(r),m=r[11].type==="enum"&&st(r);return{c(){e=I("div"),t=I("label"),s=fe(n),o=E(),c&&c.c(),l=E(),v&&v.c(),a=E(),m&&m.c(),f=E(),this.h()},l(u){e=F(u,"DIV",{class:!0});var h=X(e);t=F(h,"LABEL",{for:!0,class:!0});var d=X(t);s=ce(d,n),d.forEach(k),o=A(h),c&&c.l(h),l=A(h),v&&v.l(h),a=A(h),m&&m.l(h),f=A(h),h.forEach(k),this.h()},h(){g(t,"for",i=r[11].key),g(t,"class","svelte-12rgorr"),g(e,"class","option svelte-12rgorr")},m(u,h){C(u,e,h),T(e,t),T(t,s),T(e,o),c&&c.m(e,null),T(e,l),v&&v.m(e,null),T(e,a),m&&m.m(e,null),T(e,f)},p(u,h){h&1&&n!==(n=u[11].name+"")&&be(s,n),h&1&&i!==(i=u[11].key)&&g(t,"for",i),u[11].type==="number"?c?c.p(u,h):(c=tt(u),c.c(),c.m(e,l)):c&&(c.d(1),c=null),u[11].type==="boolean"?v?v.p(u,h):(v=rt(u),v.c(),v.m(e,a)):v&&(v.d(1),v=null),u[11].type==="enum"?m?m.p(u,h):(m=st(u),m.c(),m.m(e,f)):m&&(m.d(1),m=null)},d(u){u&&k(e),c&&c.d(),v&&v.d(),m&&m.d()}}}function lt(r){let e,t,n=Ge[r[2].type]+"",s,i,o,l="name"in r[2]&&at(r);return{c(){e=I("h2"),t=fe("Selected: "),s=fe(n),i=E(),l&&l.c(),o=ie(),this.h()},l(a){e=F(a,"H2",{class:!0});var f=X(e);t=ce(f,"Selected: "),s=ce(f,n),f.forEach(k),i=A(a),l&&l.l(a),o=ie(),this.h()},h(){g(e,"class","svelte-12rgorr")},m(a,f){C(a,e,f),T(e,t),T(e,s),C(a,i,f),l&&l.m(a,f),C(a,o,f)},p(a,f){f&4&&n!==(n=Ge[a[2].type]+"")&&be(s,n),"name"in a[2]?l?l.p(a,f):(l=at(a),l.c(),l.m(o.parentNode,o)):l&&(l.d(1),l=null)},d(a){a&&(k(e),k(i),k(o)),l&&l.d(a)}}}function at(r){let e,t,n="Name",s,i,o,l;return{c(){e=I("div"),t=I("label"),t.textContent=n,s=E(),i=I("input"),this.h()},l(a){e=F(a,"DIV",{class:!0});var f=X(e);t=F(f,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),te(t)!=="svelte-bs9sy6"&&(t.textContent=n),s=A(f),i=F(f,"INPUT",{name:!0,type:!0,class:!0}),f.forEach(k),this.h()},h(){g(t,"for","name"),g(t,"class","svelte-12rgorr"),g(i,"name","name"),g(i,"type","text"),g(i,"class","svelte-12rgorr"),g(e,"class","option svelte-12rgorr")},m(a,f){C(a,e,f),T(e,t),T(e,s),T(e,i),oe(i,r[2].name),o||(l=[J(i,"input",r[9]),J(i,"change",r[10])],o=!0)},p(a,f){f&4&&i.value!==a[2].name&&oe(i,a[2].name)},d(a){a&&k(e),o=!1,He(l)}}}function an(r){let e,t,n=r[0]&&et(r),s=r[2]!==void 0&&lt(r);return{c(){n&&n.c(),e=E(),s&&s.c(),t=ie()},l(i){n&&n.l(i),e=A(i),s&&s.l(i),t=ie()},m(i,o){n&&n.m(i,o),C(i,e,o),s&&s.m(i,o),C(i,t,o)},p(i,[o]){i[0]?n?n.p(i,o):(n=et(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null),i[2]!==void 0?s?s.p(i,o):(s=lt(i),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null)},i:he,o:he,d(i){i&&(k(e),k(t)),n&&n.d(i),s&&s.d(i)}}}function fn(r,e,t){const n=je();let s;se.subscribe(h=>{t(2,s=h)});let{selectedTool:i}=e,o;const l={};function a(h){l[h.key]=De(this.value),t(1,l),t(0,i),t(4,o),t(0,i)}function f(h){l[h.key]=De(this.value),t(1,l),t(0,i),t(4,o),t(0,i)}function c(h){l[h.key]=this.checked,t(1,l),t(0,i),t(4,o),t(0,i)}function v(h){l[h.key]=pt(this),t(1,l),t(0,i),t(4,o),t(0,i)}function m(){s.name=this.value,t(2,s)}const u=()=>n("render");return r.$$set=h=>{"selectedTool"in h&&t(0,i=h.selectedTool)},r.$$.update=()=>{if(r.$$.dirty&19){if(t(4,o=i==null?void 0:i.getOptions()),o){t(4,o=i.getOptions());for(const h of o)"default"in h&&t(1,l[h.key]=l[h.key]??h.default,l)}n("optionsChanged",l)}r.$$.dirty&2&&n("optionsChanged",l)},[i,l,s,n,o,a,f,c,v,m,u]}class cn extends Ie{constructor(e){super(),Fe(this,e,fn,an,Se,{selectedTool:0})}}function un(r){let e,t,n,s,i,o,l;e=new Zt({props:{model:r[3]}}),e.$on("toolSelected",r[9]),e.$on("modelReplaced",r[8]);let a={model:r[3]};return n=new ln({props:a}),r[10](n),n.$on("click",r[4]),n.$on("pressDown",r[5]),n.$on("move",r[6]),n.$on("release",r[7]),o=new cn({props:{selectedTool:r[0]}}),o.$on("optionsChanged",r[11]),o.$on("render",r[12]),{c(){Oe(e.$$.fragment),t=E(),Oe(n.$$.fragment),s=E(),i=I("div"),Oe(o.$$.fragment),this.h()},l(f){Pe(e.$$.fragment,f),t=A(f),Pe(n.$$.fragment,f),s=A(f),i=F(f,"DIV",{class:!0});var c=X(i);Pe(o.$$.fragment,c),c.forEach(k),this.h()},h(){g(i,"class","sidebar svelte-1qhawc6")},m(f,c){Ce(e,f,c),C(f,t,c),Ce(n,f,c),C(f,s,c),C(f,i,c),Ce(o,i,null),l=!0},p(f,[c]){const v={};c&8&&(v.model=f[3]),e.$set(v);const m={};c&8&&(m.model=f[3]),n.$set(m);const u={};c&1&&(u.selectedTool=f[0]),o.$set(u)},i(f){l||(ue(e.$$.fragment,f),ue(n.$$.fragment,f),ue(o.$$.fragment,f),l=!0)},o(f){de(e.$$.fragment,f),de(n.$$.fragment,f),de(o.$$.fragment,f),l=!1},d(f){f&&(k(t),k(s),k(i)),Me(e,f),r[10](null),Me(n,f),Me(o)}}}function hn(r,e,t){let n,s={},i,o=new ze;function l(p){let w=n.click(p.detail,o,s);i.render(w)}function a(p){let w=n.pressDown(p.detail,o,s);i.render(w),i.renderTool(n,[p.detail.x,p.detail.y],s)}function f(p){i.renderTool(n,[p.detail.x,p.detail.y],s)}function c(p){let w=n.release(p.detail,o,s);i.render(w)}function v(p){t(3,o=p.detail),setTimeout(()=>{i.render(void 0)})}me.register({key:"Delete"},()=>{const p=xe(se);p&&(t(3,o.points=o.points.filter(w=>w!==p),o),se.set(void 0),i.render(void 0),i.renderTool(n,[-1,-1],s))});const m=p=>t(0,n=p.detail);function u(p){gt[p?"unshift":"push"](()=>{i=p,t(2,i)})}return[n,s,i,o,l,a,f,c,v,m,u,p=>t(1,s=p.detail),()=>i.render(void 0)]}class _n extends Ie{constructor(e){super(),Fe(this,e,hn,un,Se,{})}}export{_n as component};
