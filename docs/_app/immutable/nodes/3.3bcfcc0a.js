var ft=Object.defineProperty;var ct=(r,e,t)=>e in r?ft(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var F=(r,e,t)=>(ct(r,typeof e!="symbol"?e+"":e,t),t);import{s as be,f as O,a as z,g as M,h as L,A as re,c as D,d as T,j as w,B as ee,i as x,x as b,C as X,y as le,D as rt,E as ze,l as _e,m as we,k as Ae,n as Ne,F as De,o as ut,e as ce,G as ie,H as Be,I as ht,J as mt,K as je,p as it,L as dt}from"../chunks/scheduler.cf9d4a9b.js";import{S as Te,i as Se,a as ae,g as pt,t as fe,c as vt,b as Fe,d as Ie,m as Oe,e as Me,f as gt}from"../chunks/index.b20454c5.js";import{$ as yt}from"../chunks/es.c5c32fd6.js";function ue(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function _t(){var r,e=0,t=!1;function n(i,s){return r.list.push({type:i,data:s?JSON.parse(JSON.stringify(s)):void 0}),r}return r={list:[],segmentId:function(){return e++},checkIntersection:function(i,s){return n("check",{seg1:i,seg2:s})},segmentChop:function(i,s){return n("div_seg",{seg:i,pt:s}),n("chop",{seg:i,pt:s})},statusRemove:function(i){return n("pop_seg",{seg:i})},segmentUpdate:function(i){return n("seg_update",{seg:i})},segmentNew:function(i,s){return n("new_seg",{seg:i,primary:s})},segmentRemove:function(i){return n("rem_seg",{seg:i})},tempStatus:function(i,s,o){return n("temp_status",{seg:i,above:s,below:o})},rewind:function(i){return n("rewind",{seg:i})},status:function(i,s,o){return n("status",{seg:i,above:s,below:o})},vert:function(i){return i===t?r:(t=i,n("vert",{x:i}))},log:function(i){return typeof i!="string"&&(i=JSON.stringify(i,!1,"  ")),n("log",{txt:i})},reset:function(){return n("reset")},selected:function(i){return n("selected",{segs:i})},chainStart:function(i){return n("chain_start",{seg:i})},chainRemoveHead:function(i,s){return n("chain_rem_head",{index:i,pt:s})},chainRemoveTail:function(i,s){return n("chain_rem_tail",{index:i,pt:s})},chainNew:function(i,s){return n("chain_new",{pt1:i,pt2:s})},chainMatch:function(i){return n("chain_match",{index:i})},chainClose:function(i){return n("chain_close",{index:i})},chainAddHead:function(i,s){return n("chain_add_head",{index:i,pt:s})},chainAddTail:function(i,s){return n("chain_add_tail",{index:i,pt:s})},chainConnect:function(i,s){return n("chain_con",{index1:i,index2:s})},chainReverse:function(i){return n("chain_rev",{index:i})},chainJoin:function(i,s){return n("chain_join",{index1:i,index2:s})},done:function(){return n("done")}},r}var wt=_t;function kt(r){typeof r!="number"&&(r=1e-10);var e={epsilon:function(t){return typeof t=="number"&&(r=t),r},pointAboveOrOnLine:function(t,n,i){var s=n[0],o=n[1],a=i[0],f=i[1],m=t[0],c=t[1];return(a-s)*(c-o)-(f-o)*(m-s)>=-r},pointBetween:function(t,n,i){var s=t[1]-n[1],o=i[0]-n[0],a=t[0]-n[0],f=i[1]-n[1],m=a*o+s*f;if(m<r)return!1;var c=o*o+f*f;return!(m-c>-r)},pointsSameX:function(t,n){return Math.abs(t[0]-n[0])<r},pointsSameY:function(t,n){return Math.abs(t[1]-n[1])<r},pointsSame:function(t,n){return e.pointsSameX(t,n)&&e.pointsSameY(t,n)},pointsCompare:function(t,n){return e.pointsSameX(t,n)?e.pointsSameY(t,n)?0:t[1]<n[1]?-1:1:t[0]<n[0]?-1:1},pointsCollinear:function(t,n,i){var s=t[0]-n[0],o=t[1]-n[1],a=n[0]-i[0],f=n[1]-i[1];return Math.abs(s*f-a*o)<r},linesIntersect:function(t,n,i,s){var o=n[0]-t[0],a=n[1]-t[1],f=s[0]-i[0],m=s[1]-i[1],c=o*m-a*f;if(Math.abs(c)<r)return!1;var v=t[0]-i[0],u=t[1]-i[1],l=(f*u-m*v)/c,h=(o*u-a*v)/c,d={alongA:0,alongB:0,pt:[t[0]+l*o,t[1]+l*a]};return l<=-r?d.alongA=-2:l<r?d.alongA=-1:l-1<=-r?d.alongA=0:l-1<r?d.alongA=1:d.alongA=2,h<=-r?d.alongB=-2:h<r?d.alongB=-1:h-1<=-r?d.alongB=0:h-1<r?d.alongB=1:d.alongB=2,d},pointInsideRegion:function(t,n){for(var i=t[0],s=t[1],o=n[n.length-1][0],a=n[n.length-1][1],f=!1,m=0;m<n.length;m++){var c=n[m][0],v=n[m][1];v-s>r!=a-s>r&&(o-c)*(s-v)/(a-v)+c-i>r&&(f=!f),o=c,a=v}return f}};return e}var bt=kt,Tt={create:function(){var r={root:{root:!0,next:null},exists:function(e){return!(e===null||e===r.root)},isEmpty:function(){return r.root.next===null},getHead:function(){return r.root.next},insertBefore:function(e,t){for(var n=r.root,i=r.root.next;i!==null;){if(t(i)){e.prev=i.prev,e.next=i,i.prev.next=e,i.prev=e;return}n=i,i=i.next}n.next=e,e.prev=n,e.next=null},findTransition:function(e){for(var t=r.root,n=r.root.next;n!==null&&!e(n);)t=n,n=n.next;return{before:t===r.root?null:t,after:n,insert:function(i){return i.prev=t,i.next=n,t.next=i,n!==null&&(n.prev=i),i}}}};return r},node:function(r){return r.prev=null,r.next=null,r.remove=function(){r.prev.next=r.next,r.next&&(r.next.prev=r.prev),r.prev=null,r.next=null},r}},St=Tt,he=St;function Pt(r,e,t){function n(h,d){return{id:t?t.segmentId():-1,start:h,end:d,myFill:{above:null,below:null},otherFill:null}}function i(h,d,p){return{id:t?t.segmentId():-1,start:h,end:d,myFill:{above:p.myFill.above,below:p.myFill.below},otherFill:null}}var s=he.create();function o(h,d,p,g,k,S){var V=e.pointsCompare(d,k);return V!==0?V:e.pointsSame(p,S)?0:h!==g?h?1:-1:e.pointAboveOrOnLine(p,g?k:S,g?S:k)?1:-1}function a(h,d){s.insertBefore(h,function(p){var g=o(h.isStart,h.pt,d,p.isStart,p.pt,p.other.pt);return g<0})}function f(h,d){var p=he.node({isStart:!0,pt:h.start,seg:h,primary:d,other:null,status:null});return a(p,h.end),p}function m(h,d,p){var g=he.node({isStart:!1,pt:d.end,seg:d,primary:p,other:h,status:null});h.other=g,a(g,h.pt)}function c(h,d){var p=f(h,d);return m(p,h,d),p}function v(h,d){t&&t.segmentChop(h.seg,d),h.other.remove(),h.seg.end=d,h.other.pt=d,a(h.other,h.pt)}function u(h,d){var p=i(d,h.seg.end,h.seg);return v(h,d),c(p,h.primary)}function l(h,d){var p=he.create();function g(_,C){var K=_.seg.start,te=_.seg.end,U=C.seg.start,q=C.seg.end;return e.pointsCollinear(K,U,q)?e.pointsCollinear(te,U,q)||e.pointAboveOrOnLine(te,U,q)?1:-1:e.pointAboveOrOnLine(K,U,q)?1:-1}function k(_){return p.findTransition(function(C){var K=g(_,C.ev);return K>0})}function S(_,C){var K=_.seg,te=C.seg,U=K.start,q=K.end,se=te.start,ne=te.end;t&&t.checkIntersection(K,te);var W=e.linesIntersect(U,q,se,ne);if(W===!1){if(!e.pointsCollinear(U,q,se)||e.pointsSame(U,ne)||e.pointsSame(q,se))return!1;var Re=e.pointsSame(U,se),Ee=e.pointsSame(q,ne);if(Re&&Ee)return C;var lt=!Re&&e.pointBetween(U,se,ne),He=!Ee&&e.pointBetween(q,se,ne);if(Re)return He?u(C,q):u(_,ne),C;lt&&(Ee||(He?u(C,q):u(_,ne)),u(C,U))}else W.alongA===0&&(W.alongB===-1?u(_,se):W.alongB===0?u(_,W.pt):W.alongB===1&&u(_,ne)),W.alongB===0&&(W.alongA===-1?u(C,U):W.alongA===0?u(C,W.pt):W.alongA===1&&u(C,q));return!1}for(var V=[];!s.isEmpty();){var y=s.getHead();if(t&&t.vert(y.pt[0]),y.isStart){let _=function(){if(J){var C=S(y,J);if(C)return C}return N?S(y,N):!1};t&&t.segmentNew(y.seg,y.primary);var R=k(y),J=R.before?R.before.ev:null,N=R.after?R.after.ev:null;t&&t.tempStatus(y.seg,J?J.seg:!1,N?N.seg:!1);var P=_();if(P){if(r){var E;y.seg.myFill.below===null?E=!0:E=y.seg.myFill.above!==y.seg.myFill.below,E&&(P.seg.myFill.above=!P.seg.myFill.above)}else P.seg.otherFill=y.seg.myFill;t&&t.segmentUpdate(P.seg),y.other.remove(),y.remove()}if(s.getHead()!==y){t&&t.rewind(y.seg);continue}if(r){var E;y.seg.myFill.below===null?E=!0:E=y.seg.myFill.above!==y.seg.myFill.below,N?y.seg.myFill.below=N.seg.myFill.above:y.seg.myFill.below=h,E?y.seg.myFill.above=!y.seg.myFill.below:y.seg.myFill.above=y.seg.myFill.below}else if(y.seg.otherFill===null){var Z;N?y.primary===N.primary?Z=N.seg.otherFill.above:Z=N.seg.myFill.above:Z=y.primary?d:h,y.seg.otherFill={above:Z,below:Z}}t&&t.status(y.seg,J?J.seg:!1,N?N.seg:!1),y.other.status=R.insert(he.node({ev:y}))}else{var A=y.status;if(A===null)throw new Error("PolyBool: Zero-length segment detected; your epsilon is probably too small or too large");if(p.exists(A.prev)&&p.exists(A.next)&&S(A.prev.ev,A.next.ev),t&&t.statusRemove(A.ev.seg),A.remove(),!y.primary){var B=y.seg.myFill;y.seg.myFill=y.seg.otherFill,y.seg.otherFill=B}V.push(y.seg)}s.getHead().remove()}return t&&t.done(),V}return r?{addRegion:function(h){for(var d,p=h[h.length-1],g=0;g<h.length;g++){d=p,p=h[g];var k=e.pointsCompare(d,p);k!==0&&c(n(k<0?d:p,k<0?p:d),!0)}},calculate:function(h){return l(h,!1)}}:{calculate:function(h,d,p,g){return h.forEach(function(k){c(i(k.start,k.end,k),!0)}),p.forEach(function(k){c(i(k.start,k.end,k),!1)}),l(d,g)}}}var Ft=Pt;function It(r,e,t){var n=[],i=[];return r.forEach(function(s){var o=s.start,a=s.end;if(e.pointsSame(o,a)){console.warn("PolyBool: Warning: Zero-length segment detected; your epsilon is probably too small or too large");return}t&&t.chainStart(s);var f={index:0,matches_head:!1,matches_pt1:!1},m={index:0,matches_head:!1,matches_pt1:!1},c=f;function v(A,B,_){return c.index=A,c.matches_head=B,c.matches_pt1=_,c===f?(c=m,!1):(c=null,!0)}for(var u=0;u<n.length;u++){var l=n[u],h=l[0];l[1];var d=l[l.length-1];if(l[l.length-2],e.pointsSame(h,o)){if(v(u,!0,!0))break}else if(e.pointsSame(h,a)){if(v(u,!0,!1))break}else if(e.pointsSame(d,o)){if(v(u,!1,!0))break}else if(e.pointsSame(d,a)&&v(u,!1,!1))break}if(c===f){n.push([o,a]),t&&t.chainNew(o,a);return}if(c===m){t&&t.chainMatch(f.index);var p=f.index,g=f.matches_pt1?a:o,k=f.matches_head,l=n[p],S=k?l[0]:l[l.length-1],V=k?l[1]:l[l.length-2],y=k?l[l.length-1]:l[0],R=k?l[l.length-2]:l[1];if(e.pointsCollinear(V,S,g)&&(k?(t&&t.chainRemoveHead(f.index,g),l.shift()):(t&&t.chainRemoveTail(f.index,g),l.pop()),S=V),e.pointsSame(y,g)){n.splice(p,1),e.pointsCollinear(R,y,S)&&(k?(t&&t.chainRemoveTail(f.index,S),l.pop()):(t&&t.chainRemoveHead(f.index,S),l.shift())),t&&t.chainClose(f.index),i.push(l);return}k?(t&&t.chainAddHead(f.index,g),l.unshift(g)):(t&&t.chainAddTail(f.index,g),l.push(g));return}function J(A){t&&t.chainReverse(A),n[A].reverse()}function N(A,B){var _=n[A],C=n[B],K=_[_.length-1],te=_[_.length-2],U=C[0],q=C[1];e.pointsCollinear(te,K,U)&&(t&&t.chainRemoveTail(A,K),_.pop(),K=te),e.pointsCollinear(K,U,q)&&(t&&t.chainRemoveHead(B,U),C.shift()),t&&t.chainJoin(A,B),n[A]=_.concat(C),n.splice(B,1)}var P=f.index,E=m.index;t&&t.chainConnect(P,E);var Z=n[P].length<n[E].length;f.matches_head?m.matches_head?Z?(J(P),N(P,E)):(J(E),N(E,P)):N(E,P):m.matches_head?N(P,E):Z?(J(P),N(E,P)):(J(E),N(P,E))}),i}var Ot=It;function me(r,e,t){var n=[];return r.forEach(function(i){var s=(i.myFill.above?8:0)+(i.myFill.below?4:0)+(i.otherFill&&i.otherFill.above?2:0)+(i.otherFill&&i.otherFill.below?1:0);e[s]!==0&&n.push({id:t?t.segmentId():-1,start:i.start,end:i.end,myFill:{above:e[s]===1,below:e[s]===2},otherFill:null})}),t&&t.selected(n),n}var Mt={union:function(r,e){return me(r,[0,2,1,0,2,2,0,0,1,0,1,0,0,0,0,0],e)},intersect:function(r,e){return me(r,[0,0,0,0,0,2,0,2,0,0,1,1,0,2,1,0],e)},difference:function(r,e){return me(r,[0,0,0,0,2,0,2,0,1,1,0,0,0,1,2,0],e)},differenceRev:function(r,e){return me(r,[0,2,1,0,0,0,1,1,0,2,0,2,0,0,0,0],e)},xor:function(r,e){return me(r,[0,2,1,0,2,0,0,1,1,0,0,2,0,1,2,0],e)}},Nt=Mt,Ct={toPolygon:function(r,e){function t(s){if(s.length<=0)return r.segments({inverted:!1,regions:[]});function o(m){var c=m.slice(0,m.length-1);return r.segments({inverted:!1,regions:[c]})}for(var a=o(s[0]),f=1;f<s.length;f++)a=r.selectDifference(r.combine(a,o(s[f])));return a}if(e.type==="Polygon")return r.polygon(t(e.coordinates));if(e.type==="MultiPolygon"){for(var n=r.segments({inverted:!1,regions:[]}),i=0;i<e.coordinates.length;i++)n=r.selectUnion(r.combine(n,t(e.coordinates[i])));return r.polygon(n)}throw new Error("PolyBool: Cannot convert GeoJSON object to PolyBool polygon")},fromPolygon:function(r,e,t){t=r.polygon(r.segments(t));function n(l,h){return e.pointInsideRegion([(l[0][0]+l[1][0])*.5,(l[0][1]+l[1][1])*.5],h)}function i(l){return{region:l,children:[]}}var s=i(null);function o(l,h){for(var d=0;d<l.children.length;d++){var p=l.children[d];if(n(h,p.region)){o(p,h);return}}for(var g=i(h),d=0;d<l.children.length;d++){var p=l.children[d];n(p.region,h)&&(g.children.push(p),l.children.splice(d,1),d--)}l.children.push(g)}for(var a=0;a<t.regions.length;a++){var f=t.regions[a];f.length<3||o(s,f)}function m(l,h){for(var d=0,p=l[l.length-1][0],g=l[l.length-1][1],k=[],S=0;S<l.length;S++){var V=l[S][0],y=l[S][1];k.push([V,y]),d+=y*p-V*g,p=V,g=y}var R=d<0;return R!==h&&k.reverse(),k.push([k[0][0],k[0][1]]),k}var c=[];function v(l){var h=[m(l.region,!1)];c.push(h);for(var d=0;d<l.children.length;d++)h.push(u(l.children[d]))}function u(l){for(var h=0;h<l.children.length;h++)v(l.children[h]);return m(l.region,!0)}for(var a=0;a<s.children.length;a++)v(s.children[a]);return c.length<=0?{type:"Polygon",coordinates:[]}:c.length==1?{type:"Polygon",coordinates:c[0]}:{type:"MultiPolygon",coordinates:c}}},Rt=Ct;/*
 * @copyright 2016 Sean Connelly (@voidqk), http://syntheti.cc
 * @license MIT
 * @preserve Project Home: https://github.com/voidqk/polybooljs
 */var Et=wt,At=bt,Ve=Ft,Bt=Ot,de=Nt,qe=Rt,Q=!1,pe=At(),Y;Y={buildLog:function(r){return r===!0?Q=Et():r===!1&&(Q=!1),Q===!1?!1:Q.list},epsilon:function(r){return pe.epsilon(r)},segments:function(r){var e=Ve(!0,pe,Q);return r.regions.forEach(e.addRegion),{segments:e.calculate(r.inverted),inverted:r.inverted}},combine:function(r,e){var t=Ve(!1,pe,Q);return{combined:t.calculate(r.segments,r.inverted,e.segments,e.inverted),inverted1:r.inverted,inverted2:e.inverted}},selectUnion:function(r){return{segments:de.union(r.combined,Q),inverted:r.inverted1||r.inverted2}},selectIntersect:function(r){return{segments:de.intersect(r.combined,Q),inverted:r.inverted1&&r.inverted2}},selectDifference:function(r){return{segments:de.difference(r.combined,Q),inverted:r.inverted1&&!r.inverted2}},selectDifferenceRev:function(r){return{segments:de.differenceRev(r.combined,Q),inverted:!r.inverted1&&r.inverted2}},selectXor:function(r){return{segments:de.xor(r.combined,Q),inverted:r.inverted1!==r.inverted2}},polygon:function(r){return{regions:Bt(r.segments,pe,Q),inverted:r.inverted}},polygonFromGeoJSON:function(r){return qe.toPolygon(Y,r)},polygonToGeoJSON:function(r){return qe.fromPolygon(Y,pe,r)},union:function(r,e){return ve(r,e,Y.selectUnion)},intersect:function(r,e){return ve(r,e,Y.selectIntersect)},difference:function(r,e){return ve(r,e,Y.selectDifference)},differenceRev:function(r,e){return ve(r,e,Y.selectDifferenceRev)},xor:function(r,e){return ve(r,e,Y.selectXor)}};function ve(r,e,t){var n=Y.segments(r),i=Y.segments(e),s=Y.combine(n,i),o=t(s);return Y.polygon(o)}typeof window=="object"&&(window.PolyBool=Y);var ge=Y;class Pe{static union(e,t){return ge.union(e,t)}static intersect(e,t){return ge.intersect(e,t)}static difference(e,t){return ge.difference(e,t)}static differenceRev(e,t){return ge.differenceRev(e,t)}static xor(e,t){return ge.xor(e,t)}}class G{constructor(e){F(this,"polygons",[]);F(this,"unoptimizedUnionVectors",[]);this.polygons=e}fastUnion(e){const t=new G(this.polygons);return t.unoptimizedUnionVectors=this.unoptimizedUnionVectors.concat([e]),t}union(e){const t=Pe.union({regions:this.polygons.map(n=>n.nodes),inverted:!1},{regions:e.polygons.map(n=>n.nodes),inverted:!1});return new G(t.regions.map(n=>({nodes:n})))}intersect(e){const t=Pe.intersect({regions:this.polygons.map(n=>n.nodes),inverted:!1},{regions:e.polygons.map(n=>n.nodes),inverted:!1});return new G(t.regions.map(n=>({nodes:n})))}difference(e){const t=Pe.difference({regions:this.polygons.map(n=>n.nodes),inverted:!1},{regions:e.polygons.map(n=>n.nodes),inverted:!1});return new G(t.regions.map(n=>({nodes:n})))}xor(e){const t=Pe.xor({regions:this.polygons.map(n=>n.nodes),inverted:!1},{regions:e.polygons.map(n=>n.nodes),inverted:!1});return new G(t.regions.map(n=>({nodes:n})))}optimize(){let e=new G(this.polygons);for(const t of this.unoptimizedUnionVectors)e=e.union(t);return e}}class st{static square(e,t,n,i){return new G([{nodes:[[e,t],[e+n,t],[e+n,t+i],[e,t+i]]}])}static circle(e,t,n,i,s=0){const o={nodes:[]};for(let a=0;a<Math.PI*2;a+=Math.PI/i){const f=a+s;o.nodes.push([e+Math.cos(f)*n,t+Math.sin(f)*n])}return new G([o])}}var H=(r=>(r[r.Point=0]="Point",r[r.MajorCity=1]="MajorCity",r[r.City=2]="City",r[r.Town=3]="Town",r[r.Village=4]="Village",r[r.PointOfInterest=99]="PointOfInterest",r))(H||{});class xe{constructor(){F(this,"version",1);F(this,"terrain",{vector:new G([])});F(this,"features",[]);F(this,"paths",[]);F(this,"points",[])}}class ke{static newMap(){return new xe}static async uploadMap(){const e=await ke.fileDialog(),t=new xe;if(typeof e=="string")return Object.assign(t,JSON.parse(e)),t.terrain.vector=new G(t.terrain.vector.polygons),t.features.forEach(n=>{n.vector=new G(n.vector.polygons)}),t}static async fileDialog(){return new Promise(e=>{const t=document.createElement("input");t.type="file",t.onchange=()=>{const n=t.files;if(n){const i=new FileReader;return i.onload=function(s){var o;return e(((o=s.target)==null?void 0:o.result)||"")},i.readAsText(n[0])}return e(void 0)},t.click()})}static downloadMap(e){const t=document.createElement("a");yt.capture("save_map",{model:e}),t.href="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),t.download="map.json",t.click()}}var xt=Object.defineProperty,zt=(r,e,t)=>e in r?xt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Dt=(r,e,t)=>(zt(r,typeof e!="symbol"?e+"":e,t),t);const Ue=class{static register(e,t){this.listeners.push({key:e.key,modifiers:e.modifiers,callback:t})}};Dt(Ue,"listeners",[]);typeof document<"u"?document.addEventListener("keydown",r=>{for(const e of Ue.listeners)r.key===e.key&&e.callback()}):console.error("No document on keybind registration. No keybinds will work");let ye=Ue;class ot{constructor(e){this.model=e}getNearestPoint(e,t,n){const i=n*n;let s,o=1/0;for(const a of this.model.points){const f=(a.x-e)*(a.x-e)+(a.y-t)*(a.y-t);f<=i&&f<o&&(s=a,o=f)}return s}}const Ce=class Ce{constructor(e,t,n,i){this.x=e,this.y=t,this.width=n,this.height=i}};F(Ce,"NO_PAINT",new Ce(0,0,0,0));let j=Ce;const Ut=[{id:H.MajorCity,label:"Major City"},{id:H.City,label:"City"},{id:H.Town,label:"Town"},{id:H.Village,label:"Village"},{id:H.PointOfInterest,label:"PointOfInterest"}];class Ht{getOptions(){return[{name:"Type",key:"type",type:"enum",options:Ut}]}click(e,t,n){if(new ot(t).getNearestPoint(e.x,e.y,5))return j.NO_PAINT;{const s={x:e.x,y:e.y,type:n.type,name:""};t.points.push(s)}}pressDown(){return j.NO_PAINT}release(){return j.NO_PAINT}render(){}}class jt{constructor(e){this.onSelectionChanged=e}getOptions(){return[]}click(e,t){const n=new ot(t).getNearestPoint(e.x,e.y,5);return n?(this.onSelectionChanged("point",n),j.NO_PAINT):(this.onSelectionChanged("none",void 0),j.NO_PAINT)}pressDown(){return j.NO_PAINT}release(){}render(){}}class Vt{getOptions(){return[{key:"size",name:"Size",type:"number",default:25,min:5,max:100,step:1},{key:"erase",name:"Erase",type:"boolean"}]}click(){return j.NO_PAINT}pressDown(e,t,n){const i=Math.ceil(n.size/(8*Math.PI))+3,s=st.circle(e.x,e.y,n.size,i,Math.random()*Math.PI);t.features.length===0&&t.features.push({type:"forest",vector:new G([])}),n.erase?t.features[0].vector=t.features[0].vector.difference(s):t.features[0].vector=t.features[0].vector.union(s)}release(e,t){t.features[0].vector=t.features[0].vector.optimize()}render(e,t,n){n.beginPath(),n.fillStyle="#FFFFFF50",n.arc(e[0],e[1],t.size,0,Math.PI*2),n.fill()}}class qt{getOptions(){return[{key:"size",name:"Size",type:"number",default:25,min:5,max:100,step:1},{key:"erase",name:"Erase",type:"boolean"}]}click(){return j.NO_PAINT}pressDown(e,t,n){const i=Math.ceil(n.size/(2*Math.PI))+3,s=st.circle(e.x,e.y,n.size,i,Math.random()*Math.PI);n.erase?t.terrain.vector=t.terrain.vector.difference(s):t.terrain.vector=t.terrain.vector.union(s)}release(e,t){t.terrain.vector=t.terrain.vector.optimize()}render(e,t,n){n.beginPath(),n.fillStyle="#FFFFFF50",n.arc(e[0],e[1],t.size,0,Math.PI*2),n.fill()}}class at{async preload(){}render(e,t){t.clearRect(0,0,1200,860);for(let n=0;n<e.paths.length;n++)this.renderPath(e.paths[n],t)}renderPath(e,t){t.beginPath(),t.moveTo(e.nodes[0][0],e.nodes[0][1]);for(let n=1;n<e.nodes.length;n++){const i=this.midPointBtw(e.nodes[n-1],e.nodes[n]);t.quadraticCurveTo(e.nodes[n-1][0],e.nodes[n-1][1],i[0],i[1])}t.lineTo(e.nodes[e.nodes.length-1][0],e.nodes[e.nodes.length-1][1]),t.filter="blur(0.1px)",t.strokeStyle="#381d0aA0",t.lineWidth=2,t.lineCap="round",t.setLineDash([6,4]),t.stroke()}midPointBtw(e,t){return[e[0]+(t[0]-e[0])/2,e[1]+(t[1]-e[1])/2]}}class Jt{constructor(){F(this,"nodes",[])}getOptions(){return[]}click(e,t){if(this.nodes.length>=1&&this.nodes[this.nodes.length-1][0]===e.x&&this.nodes[this.nodes.length-1][1]===e.y){t.paths.push({nodes:this.nodes});const n={minx:1/0,miny:1/0,maxx:-1/0,maxy:-1/0};for(const i of this.nodes)n.minx=Math.min(n.minx,i[0]),n.miny=Math.min(n.miny,i[0]),n.maxx=Math.max(n.maxx,i[1]),n.maxy=Math.max(n.maxy,i[1]);return this.nodes=[],new j(n.minx,n.miny,n.maxx-n.minx,n.maxy-n.miny)}return this.nodes.push([e.x,e.y]),j.NO_PAINT}pressDown(){return j.NO_PAINT}release(){return j.NO_PAINT}render(e,t,n){if(this.nodes.length>0){const i=this.nodes.concat([e]);new at().renderPath({nodes:i},n)}}}function Xt(r){let e,t,n='<i class="fa fa-file"></i>',i,s,o='<i class="fa fa-floppy-disk"></i>',a,f,m='<i class="fa fa-folder-open"></i>',c,v,u,l,h='<i class="fa fa-arrow-pointer"></i>',d,p,g='<i class="fa fa-paintbrush"></i>',k,S,V='<i class="fa fa-landmark"></i>',y,R,J='<i class="fa fa-tree"></i>',N,P,E='<i class="fa fa-road"></i>',Z,A;return{c(){e=O("div"),t=O("button"),t.innerHTML=n,i=z(),s=O("button"),s.innerHTML=o,a=z(),f=O("button"),f.innerHTML=m,c=z(),v=O("hr"),u=z(),l=O("button"),l.innerHTML=h,d=z(),p=O("button"),p.innerHTML=g,k=z(),S=O("button"),S.innerHTML=V,y=z(),R=O("button"),R.innerHTML=J,N=z(),P=O("button"),P.innerHTML=E,this.h()},l(B){e=M(B,"DIV",{class:!0});var _=L(e);t=M(_,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),re(t)!=="svelte-1m01bc9"&&(t.innerHTML=n),i=D(_),s=M(_,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),re(s)!=="svelte-1gea4ds"&&(s.innerHTML=o),a=D(_),f=M(_,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),re(f)!=="svelte-18vhduo"&&(f.innerHTML=m),c=D(_),v=M(_,"HR",{class:!0}),u=D(_),l=M(_,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),re(l)!=="svelte-1n6mnah"&&(l.innerHTML=h),d=D(_),p=M(_,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),re(p)!=="svelte-1q2mh60"&&(p.innerHTML=g),k=D(_),S=M(_,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),re(S)!=="svelte-10fbohv"&&(S.innerHTML=V),y=D(_),R=M(_,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),re(R)!=="svelte-dgiflo"&&(R.innerHTML=J),N=D(_),P=M(_,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),re(P)!=="svelte-1gmqo2i"&&(P.innerHTML=E),_.forEach(T),this.h()},h(){w(t,"title","New map"),w(t,"class","svelte-1ecqtnm"),w(s,"title","Save map"),w(s,"class","svelte-1ecqtnm"),w(f,"title","Upload map"),w(f,"class","svelte-1ecqtnm"),w(v,"class","svelte-1ecqtnm"),w(l,"title","Selection tool (S)"),w(l,"class","svelte-1ecqtnm"),ee(l,"selected",r[0]==="select"),w(p,"title","Terrain tool (T)"),w(p,"class","svelte-1ecqtnm"),ee(p,"selected",r[0]==="terrain"),w(S,"title","Settlement tool (E)"),w(S,"class","svelte-1ecqtnm"),ee(S,"selected",r[0]==="point"),w(R,"title","Forest tool (F)"),w(R,"class","svelte-1ecqtnm"),ee(R,"selected",r[0]==="forest"),w(P,"title","Path tool (P)"),w(P,"class","svelte-1ecqtnm"),ee(P,"selected",r[0]==="path"),w(e,"class","toolbar svelte-1ecqtnm")},m(B,_){x(B,e,_),b(e,t),b(e,i),b(e,s),b(e,a),b(e,f),b(e,c),b(e,v),b(e,u),b(e,l),b(e,d),b(e,p),b(e,k),b(e,S),b(e,y),b(e,R),b(e,N),b(e,P),Z||(A=[X(t,"click",r[1]),X(s,"click",r[3]),X(f,"click",r[2]),X(l,"click",r[6]),X(p,"click",r[7]),X(S,"click",r[8]),X(R,"click",r[9]),X(P,"click",r[10])],Z=!0)},p(B,[_]){_&1&&ee(l,"selected",B[0]==="select"),_&1&&ee(p,"selected",B[0]==="terrain"),_&1&&ee(S,"selected",B[0]==="point"),_&1&&ee(R,"selected",B[0]==="forest"),_&1&&ee(P,"selected",B[0]==="path")},i:le,o:le,d(B){B&&T(e),Z=!1,rt(A)}}}function Yt(r,e,t){const n=ze(),i={select:new jt((p,g)=>t(4,c=g)),terrain:new qt,point:new Ht,forest:new Vt,path:new Jt};let{selectedToolKey:s="terrain"}=e,{model:o}=e;setTimeout(()=>{n("toolSelected",i[s])},200);function a(){n("modelReplaced",ke.newMap())}async function f(){const p=await ke.uploadMap();p&&n("modelReplaced",p)}function m(){ke.downloadMap(o)}ye.register({key:"s"},()=>t(0,s="select")),ye.register({key:"t"},()=>t(0,s="terrain")),ye.register({key:"e"},()=>t(0,s="point")),ye.register({key:"f"},()=>t(0,s="forest")),ye.register({key:"p"},()=>t(0,s="path"));let{selectedPoint:c=void 0}=e;const v=()=>t(0,s="select"),u=()=>t(0,s="terrain"),l=()=>t(0,s="point"),h=()=>t(0,s="forest"),d=()=>t(0,s="path");return r.$$set=p=>{"selectedToolKey"in p&&t(0,s=p.selectedToolKey),"model"in p&&t(5,o=p.model),"selectedPoint"in p&&t(4,c=p.selectedPoint)},r.$$.update=()=>{r.$$.dirty&1&&n("toolSelected",i[s])},[s,a,f,m,c,o,v,u,l,h,d]}class Kt extends Te{constructor(e){super(),Se(this,e,Yt,Xt,be,{selectedToolKey:0,model:5,selectedPoint:4})}}const I=class I{static async preload(e){let n=0;e(n++/8,"Loading water.png"),I.water=await I.loadImage("/images/map/water.png"),e(n++/8,"Loading grass.png"),I.grass=await I.loadImage("/images/map/grass.png"),e(n++/8,"Loading settlement-major-city.png"),I.majorCity=await I.loadImage("/images/map/settlement-major-city.png"),e(n++/8,"Loading settlement-city.png"),I.city=await I.loadImage("/images/map/settlement-city.png"),e(n++/8,"Loading settlement-town.png"),I.town=await I.loadImage("/images/map/settlement-town.png"),e(n++/8,"Loading settlement-village.png"),I.village=await I.loadImage("/images/map/settlement-village.png"),e(n++/8,"Loading settlement-poi.png"),I.pointOfInterest=await I.loadImage("/images/map/settlement-poi.png"),e(n++/8,"Loading tree-1.png"),I.tree=await I.loadImage("/images/map/tree-1.png")}static async loadImage(e){const t=new Image,n=new Promise(i=>t.onload=i);return t.src=I.getPath(e),await n,t}static getPath(e){return document.location.href.includes("github")?"/cartoga"+e:e}};F(I,"water"),F(I,"grass"),F(I,"majorCity"),F(I,"city"),F(I,"town"),F(I,"village"),F(I,"pointOfInterest"),F(I,"tree");let $=I;class Gt{constructor(){F(this,"textures",new Map);F(this,"nameOptions",new Map)}async preload(){this.textures.set(H.MajorCity,$.majorCity),this.textures.set(H.City,$.city),this.textures.set(H.Town,$.town),this.textures.set(H.Village,$.village),this.textures.set(H.PointOfInterest,$.pointOfInterest),this.nameOptions.set(H.MajorCity,{render:!0,fontSize:14}),this.nameOptions.set(H.City,{render:!0,fontSize:12}),this.nameOptions.set(H.Town,{render:!0,fontSize:8}),this.nameOptions.set(H.Village,{render:!1,fontSize:0}),this.nameOptions.set(H.PointOfInterest,{render:!0,fontSize:8})}render(e,t){var n,i;t.clearRect(0,0,1200,860);for(const s of e.points){const o=this.textures.get(s.type);let a=5;o?(a=o.height,t.drawImage(o,s.x-o.width/2,s.y-o.height/2)):(t.strokeStyle="#381d0a",t.beginPath(),t.rect(s.x,s.y,5,5),t.stroke()),"name"in s&&((n=this.nameOptions.get(s.type))!=null&&n.render)&&(t.filter="blur(2px)",t.textAlign="center",t.fillStyle="white",t.font=`${(i=this.nameOptions.get(s.type))==null?void 0:i.fontSize}px Eczar`,t.fillText(new String(s.name).toString(),s.x,s.y+a),t.filter="none",t.fillStyle="#381d0a",t.fillText(new String(s.name).toString(),s.x,s.y+a))}}}class Lt{constructor(){F(this,"offsets");F(this,"stampSize",[14,16]);F(this,"spacing",10)}async preload(){}render(e,t){this.offsets||(this.offsets=this.computeOffsets()),t.clearRect(0,0,1200,860),t.filter="blur(4px)",this.drawVector(e,t),t.filter="none",this.drawStamps(e,t)}drawVector(e,t){for(const n of e.features){t.beginPath();for(let i=0;i<n.vector.polygons.length;i++){const s=n.vector.polygons[i];t.moveTo(s.nodes[0][0],s.nodes[0][1]);for(let o=1;o<s.nodes.length;o++)t.lineTo(s.nodes[o][0],s.nodes[o][1])}t.strokeStyle="#381d0a30",t.fillStyle="#381d0a40",t.fill("evenodd"),t.stroke()}}drawStamps(e,t){const n=t.getImageData(0,0,1200,860);for(let i=0;i<1200/this.spacing;i++)for(let s=0;s<860/this.spacing;s++){const o=this.offsets[i][s],a=[Math.round(i*this.spacing+o[0]),Math.round(s*this.spacing+o[1])];n.data[a[1]*(n.width*4)+a[0]*4+3]>=32&&t.drawImage($.tree,a[0]-this.stampSize[0]/2,a[1]-this.stampSize[1]/2)}}computeOffsets(){const e=[];for(let t=0;t<1200/this.spacing;t++){e.push([]);for(let n=0;n<860/this.spacing;n++)e[t][n]=[Math.random()*this.spacing*.7,Math.random()*this.spacing*.7]}return e}}class Zt{constructor(){F(this,"grassPattern")}async preload(){}render(e,t,n){if(!this.grassPattern){const i=t.createPattern($.grass,"repeat");i&&(this.grassPattern=i)}t.fillStyle=this.grassPattern||"#003000FF",t.clearRect(0,0,1200,860),t.beginPath();for(let i=0;i<e.terrain.vector.polygons.length;i++){const s=e.terrain.vector.polygons[i];t.moveTo(s.nodes[0][0],s.nodes[0][1]);for(let o=1;o<s.nodes.length;o++)t.lineTo(s.nodes[o][0],s.nodes[o][1]);t.closePath()}t.strokeStyle="#FFFFFF30",t.filter="blur(8px)",t.lineWidth=32,t.stroke(),t.filter="none",t.fill("evenodd"),t.strokeStyle="#381d0a30",t.lineWidth=3,t.stroke();for(let i=0;i<e.terrain.vector.unoptimizedUnionVectors.length;i++){const s=e.terrain.vector.unoptimizedUnionVectors[i];t.beginPath();for(let o=0;o<s.polygons.length;o++){const a=s.polygons[o];t.moveTo(a.nodes[0][0],a.nodes[0][1]);for(let f=1;f<a.nodes.length;f++)t.lineTo(a.nodes[f][0],a.nodes[f][1])}t.fill("evenodd")}}}const oe={background:0,terrain:1,terrainFeatures:2,paths:3,points:4,tool:5};class Qt{constructor(){F(this,"terrainRenderer");F(this,"terrainFeatureRenderer");F(this,"pointRenderer");F(this,"pathRenderer",new at);this.terrainRenderer=new Zt,this.terrainFeatureRenderer=new Lt,this.pointRenderer=new Gt,!(typeof document>"u")&&(setTimeout(()=>this.terrainRenderer.preload(),100),setTimeout(()=>this.terrainFeatureRenderer.preload(),100),setTimeout(()=>this.pointRenderer.preload(),100))}renderBackground(e,t,n){const i=t.createPattern($.water,"repeat");i&&(t.fillStyle=i,t.fillRect(n.x,n.y,n.width,n.height))}renderTerrain(e,t,n){this.terrainRenderer.render(e,t,n)}renderTerrainFeatures(e,t){this.terrainFeatureRenderer.render(e,t)}renderPoints(e,t){this.pointRenderer.render(e,t)}renderPaths(e,t){this.pathRenderer.render(e,t)}renderTool(e,t,n,i){i.clearRect(0,0,1200,860),e.render(t,n,i)}}function Wt(r){let e,t,n,i,s,o=r[0]*100+"",a,f,m,c,v;return{c(){e=O("div"),t=O("div"),n=O("div"),i=z(),s=O("span"),a=_e(o),f=_e("%"),m=z(),c=O("span"),v=_e(r[1]),this.h()},l(u){e=M(u,"DIV",{class:!0});var l=L(e);t=M(l,"DIV",{class:!0});var h=L(t);n=M(h,"DIV",{class:!0,style:!0}),L(n).forEach(T),i=D(h),s=M(h,"SPAN",{class:!0});var d=L(s);a=we(d,o),f=we(d,"%"),d.forEach(T),h.forEach(T),m=D(l),c=M(l,"SPAN",{});var p=L(c);v=we(p,r[1]),p.forEach(T),l.forEach(T),this.h()},h(){w(n,"class","progress-complete svelte-caggyw"),Ae(n,"width",r[0]*100+"%"),w(s,"class","svelte-caggyw"),w(t,"class","progress svelte-caggyw"),w(e,"class","loading svelte-caggyw")},m(u,l){x(u,e,l),b(e,t),b(t,n),b(t,i),b(t,s),b(s,a),b(s,f),b(e,m),b(e,c),b(c,v)},p(u,[l]){l&1&&Ae(n,"width",u[0]*100+"%"),l&1&&o!==(o=u[0]*100+"")&&Ne(a,o),l&2&&Ne(v,u[1])},i:le,o:le,d(u){u&&T(e)}}}function $t(r,e,t){let{progress:n=0}=e,{message:i="Loading"}=e;return r.$$set=s=>{"progress"in s&&t(0,n=s.progress),"message"in s&&t(1,i=s.message)},[n,i]}class en extends Te{constructor(e){super(),Se(this,e,$t,Wt,be,{progress:0,message:1})}}function Je(r,e,t){const n=r.slice();return n[7]=e[t],n}function Xe(r){let e,t;return e=new en({props:{progress:r[0].progress,message:r[0].message}}),{c(){Fe(e.$$.fragment)},l(n){Ie(e.$$.fragment,n)},m(n,i){Oe(e,n,i),t=!0},p(n,i){const s={};i&1&&(s.progress=n[0].progress),i&1&&(s.message=n[0].message),e.$set(s)},i(n){t||(ae(e.$$.fragment,n),t=!0)},o(n){fe(e.$$.fragment,n),t=!1},d(n){Me(e,n)}}}function Ye(r){let e;return{c(){e=O("canvas"),this.h()},l(t){e=M(t,"CANVAS",{id:!0,width:!0,height:!0,style:!0,class:!0}),L(e).forEach(T),this.h()},h(){w(e,"id","layer-"+r[7]),w(e,"width","1200"),w(e,"height","860"),Ae(e,"border","1px solid #000000"),w(e,"class","svelte-1cguo7c")},m(t,n){x(t,e,n)},p:le,d(t){t&&T(e)}}}function tn(r){let e,t,n,i=r[0]&&Xe(r),s=ue(Object.values(oe)),o=[];for(let a=0;a<s.length;a+=1)o[a]=Ye(Je(r,s,a));return{c(){i&&i.c(),e=z(),t=O("div");for(let a=0;a<o.length;a+=1)o[a].c();this.h()},l(a){i&&i.l(a),e=D(a),t=M(a,"DIV",{class:!0});var f=L(t);for(let m=0;m<o.length;m+=1)o[m].l(f);f.forEach(T),this.h()},h(){w(t,"class","canvas-container svelte-1cguo7c")},m(a,f){i&&i.m(a,f),x(a,e,f),x(a,t,f);for(let m=0;m<o.length;m+=1)o[m]&&o[m].m(t,null);n=!0},p(a,[f]){if(a[0]?i?(i.p(a,f),f&1&&ae(i,1)):(i=Xe(a),i.c(),ae(i,1),i.m(e.parentNode,e)):i&&(pt(),fe(i,1,1,()=>{i=null}),vt()),f&0){s=ue(Object.values(oe));let m;for(m=0;m<s.length;m+=1){const c=Je(a,s,m);o[m]?o[m].p(c,f):(o[m]=Ye(c),o[m].c(),o[m].m(t,null))}for(;m<o.length;m+=1)o[m].d(1);o.length=s.length}},i(a){n||(ae(i),n=!0)},o(a){fe(i),n=!1},d(a){a&&(T(e),T(t)),i&&i.d(a),De(o,a)}}}function nn(r,e,t){const n=ze();let{model:i}=e;const s=new Qt;let o=[],a={progress:0,message:"Initializing"};ut(async()=>{await $.preload((u,l)=>t(0,a={progress:u,message:l})),t(0,a=void 0);const c=Array.from(document.querySelectorAll("canvas"));o=c.map(u=>u.getContext("2d"));const v=c[c.length-1];f(),s.renderBackground(i,o[0],new j(0,0,1200,860)),v.addEventListener("mousedown",u=>{n("click",{x:u.clientX-(v.offsetLeft??0),y:u.clientY-(v.offsetTop??0)}),n("pressDown",{x:u.clientX-(v.offsetLeft??0),y:u.clientY-(v.offsetTop??0)})}),v.addEventListener("mousemove",u=>{u.buttons===1&&n("pressDown",{x:u.clientX-(v.offsetLeft??0),y:u.clientY-(v.offsetTop??0)}),n("move",{x:u.clientX-(v.offsetLeft??0),y:u.clientY-(v.offsetTop??0)})}),v.addEventListener("mouseup",u=>{n("release",{x:u.clientX-(v.offsetLeft??0),y:u.clientY-(v.offsetTop??0)})})});function f(c){const v=c??new j(0,0,1200,860);s.renderTerrain(i,o[oe.terrain],v),s.renderTerrainFeatures(i,o[oe.terrainFeatures]),s.renderPoints(i,o[oe.points]),s.renderPaths(i,o[oe.paths])}function m(c,v,u){s.renderTool(c,v,u,o[oe.tool])}return r.$$set=c=>{"model"in c&&t(1,i=c.model)},[a,i,f,m]}class rn extends Te{constructor(e){super(),Se(this,e,nn,tn,be,{model:1,render:2,renderTool:3})}get render(){return this.$$.ctx[2]}get renderTool(){return this.$$.ctx[3]}}function Ke(r,e,t){const n=r.slice();return n[10]=e[t],n[11]=e,n[12]=t,n}function Ge(r,e,t){const n=r.slice();return n[13]=e[t],n}function Le(r){let e,t=ue(r[1].getOptions()),n=[];for(let i=0;i<t.length;i+=1)n[i]=tt(Ke(r,t,i));return{c(){for(let i=0;i<n.length;i+=1)n[i].c();e=ce()},l(i){for(let s=0;s<n.length;s+=1)n[s].l(i);e=ce()},m(i,s){for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(i,s);x(i,e,s)},p(i,s){if(s&6){t=ue(i[1].getOptions());let o;for(o=0;o<t.length;o+=1){const a=Ke(i,t,o);n[o]?n[o].p(a,s):(n[o]=tt(a),n[o].c(),n[o].m(e.parentNode,e))}for(;o<n.length;o+=1)n[o].d(1);n.length=t.length}},d(i){i&&T(e),De(n,i)}}}function Ze(r){let e,t,n,i,s,o;function a(){r[4].call(e,r[10])}let f="min"in r[10]&&Qe(r);return{c(){e=O("input"),n=z(),f&&f.c(),i=ce(),this.h()},l(m){e=M(m,"INPUT",{name:!0,type:!0}),n=D(m),f&&f.l(m),i=ce(),this.h()},h(){w(e,"name",t=r[10].key),w(e,"type","number")},m(m,c){x(m,e,c),ie(e,r[2][r[10].key]),x(m,n,c),f&&f.m(m,c),x(m,i,c),s||(o=X(e,"input",a),s=!0)},p(m,c){r=m,c&2&&t!==(t=r[10].key)&&w(e,"name",t),c&6&&Be(e.value)!==r[2][r[10].key]&&ie(e,r[2][r[10].key]),"min"in r[10]?f?f.p(r,c):(f=Qe(r),f.c(),f.m(i.parentNode,i)):f&&(f.d(1),f=null)},d(m){m&&(T(e),T(n),T(i)),f&&f.d(m),s=!1,o()}}}function Qe(r){let e,t,n,i,s,o,a;function f(){r[5].call(e,r[10])}return{c(){e=O("input"),this.h()},l(m){e=M(m,"INPUT",{name:!0,type:!0,min:!0,max:!0,step:!0}),this.h()},h(){w(e,"name",t=r[10].key),w(e,"type","range"),w(e,"min",n=r[10].min),w(e,"max",i=r[10].max),w(e,"step",s=r[10].step)},m(m,c){x(m,e,c),ie(e,r[2][r[10].key]),o||(a=[X(e,"change",f),X(e,"input",f)],o=!0)},p(m,c){r=m,c&2&&t!==(t=r[10].key)&&w(e,"name",t),c&2&&n!==(n=r[10].min)&&w(e,"min",n),c&2&&i!==(i=r[10].max)&&w(e,"max",i),c&2&&s!==(s=r[10].step)&&w(e,"step",s),c&6&&ie(e,r[2][r[10].key])},d(m){m&&T(e),o=!1,rt(a)}}}function We(r){let e,t,n,i;function s(){r[6].call(e,r[10])}return{c(){e=O("input"),this.h()},l(o){e=M(o,"INPUT",{name:!0,type:!0}),this.h()},h(){w(e,"name",t=r[10].key),w(e,"type","checkbox")},m(o,a){x(o,e,a),e.checked=r[2][r[10].key],n||(i=X(e,"change",s),n=!0)},p(o,a){r=o,a&2&&t!==(t=r[10].key)&&w(e,"name",t),a&6&&(e.checked=r[2][r[10].key])},d(o){o&&T(e),n=!1,i()}}}function $e(r){let e,t,n,i,s=ue(r[10].options),o=[];for(let f=0;f<s.length;f+=1)o[f]=et(Ge(r,s,f));function a(){r[7].call(e,r[10])}return{c(){e=O("select");for(let f=0;f<o.length;f+=1)o[f].c();this.h()},l(f){e=M(f,"SELECT",{name:!0});var m=L(e);for(let c=0;c<o.length;c+=1)o[c].l(m);m.forEach(T),this.h()},h(){w(e,"name",t=r[10].key),r[2][r[10].key]===void 0&&mt(a)},m(f,m){x(f,e,m);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(e,null);je(e,r[2][r[10].key],!0),n||(i=X(e,"change",a),n=!0)},p(f,m){if(r=f,m&2){s=ue(r[10].options);let c;for(c=0;c<s.length;c+=1){const v=Ge(r,s,c);o[c]?o[c].p(v,m):(o[c]=et(v),o[c].c(),o[c].m(e,null))}for(;c<o.length;c+=1)o[c].d(1);o.length=s.length}m&2&&t!==(t=r[10].key)&&w(e,"name",t),m&6&&je(e,r[2][r[10].key])},d(f){f&&T(e),De(o,f),n=!1,i()}}}function et(r){let e,t=r[13].label+"",n,i;return{c(){e=O("option"),n=_e(t),this.h()},l(s){e=M(s,"OPTION",{});var o=L(e);n=we(o,t),o.forEach(T),this.h()},h(){e.__value=i=r[13].id,ie(e,e.__value)},m(s,o){x(s,e,o),b(e,n)},p(s,o){o&2&&t!==(t=s[13].label+"")&&Ne(n,t),o&2&&i!==(i=s[13].id)&&(e.__value=i,ie(e,e.__value))},d(s){s&&T(e)}}}function tt(r){let e,t,n=r[10].name+"",i,s,o,a,f,m,c=r[10].type==="number"&&Ze(r),v=r[10].type==="boolean"&&We(r),u=r[10].type==="enum"&&$e(r);return{c(){e=O("div"),t=O("label"),i=_e(n),o=z(),c&&c.c(),a=z(),v&&v.c(),f=z(),u&&u.c(),m=z(),this.h()},l(l){e=M(l,"DIV",{class:!0});var h=L(e);t=M(h,"LABEL",{for:!0});var d=L(t);i=we(d,n),d.forEach(T),o=D(h),c&&c.l(h),a=D(h),v&&v.l(h),f=D(h),u&&u.l(h),m=D(h),h.forEach(T),this.h()},h(){w(t,"for",s=r[10].key),w(e,"class","option svelte-78v74y")},m(l,h){x(l,e,h),b(e,t),b(t,i),b(e,o),c&&c.m(e,null),b(e,a),v&&v.m(e,null),b(e,f),u&&u.m(e,null),b(e,m)},p(l,h){h&2&&n!==(n=l[10].name+"")&&Ne(i,n),h&2&&s!==(s=l[10].key)&&w(t,"for",s),l[10].type==="number"?c?c.p(l,h):(c=Ze(l),c.c(),c.m(e,a)):c&&(c.d(1),c=null),l[10].type==="boolean"?v?v.p(l,h):(v=We(l),v.c(),v.m(e,f)):v&&(v.d(1),v=null),l[10].type==="enum"?u?u.p(l,h):(u=$e(l),u.c(),u.m(e,m)):u&&(u.d(1),u=null)},d(l){l&&T(e),c&&c.d(),v&&v.d(),u&&u.d()}}}function nt(r){let e,t,n;return{c(){e=O("input"),this.h()},l(i){e=M(i,"INPUT",{type:!0}),this.h()},h(){w(e,"type","text")},m(i,s){x(i,e,s),ie(e,r[0].name),t||(n=X(e,"input",r[8]),t=!0)},p(i,s){s&1&&e.value!==i[0].name&&ie(e,i[0].name)},d(i){i&&T(e),t=!1,n()}}}function sn(r){let e,t,n=r[1]&&Le(r),i=r[0]!==void 0&&"name"in r[0]&&nt(r);return{c(){n&&n.c(),e=z(),i&&i.c(),t=ce()},l(s){n&&n.l(s),e=D(s),i&&i.l(s),t=ce()},m(s,o){n&&n.m(s,o),x(s,e,o),i&&i.m(s,o),x(s,t,o)},p(s,[o]){s[1]?n?n.p(s,o):(n=Le(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null),s[0]!==void 0&&"name"in s[0]?i?i.p(s,o):(i=nt(s),i.c(),i.m(t.parentNode,t)):i&&(i.d(1),i=null)},i:le,o:le,d(s){s&&(T(e),T(t)),n&&n.d(s),i&&i.d(s)}}}function on(r,e,t){const n=ze();let{selectedPoint:i}=e,{selectedTool:s}=e,o;const a={};function f(l){a[l.key]=Be(this.value),t(2,a),t(1,s),t(3,o),t(1,s)}function m(l){a[l.key]=Be(this.value),t(2,a),t(1,s),t(3,o),t(1,s)}function c(l){a[l.key]=this.checked,t(2,a),t(1,s),t(3,o),t(1,s)}function v(l){a[l.key]=ht(this),t(2,a),t(1,s),t(3,o),t(1,s)}function u(){i.name=this.value,t(0,i)}return r.$$set=l=>{"selectedPoint"in l&&t(0,i=l.selectedPoint),"selectedTool"in l&&t(1,s=l.selectedTool)},r.$$.update=()=>{if(r.$$.dirty&14){if(t(3,o=s==null?void 0:s.getOptions()),o){t(3,o=s.getOptions());for(const l of o)"default"in l&&t(2,a[l.key]=a[l.key]??l.default,a)}n("optionsChanged",a)}r.$$.dirty&4&&n("optionsChanged",a)},[i,s,a,o,f,m,c,v,u]}class an extends Te{constructor(e){super(),Se(this,e,on,sn,be,{selectedPoint:0,selectedTool:1})}}function ln(r){let e,t,n,i,s,o,a,f;function m(u){r[10](u)}let c={model:r[4]};r[0]!==void 0&&(c.selectedPoint=r[0]),e=new Kt({props:c}),it.push(()=>gt(e,"selectedPoint",m)),e.$on("toolSelected",r[11]),e.$on("modelReplaced",r[9]);let v={model:r[4]};return i=new rn({props:v}),r[12](i),i.$on("click",r[5]),i.$on("pressDown",r[6]),i.$on("move",r[7]),i.$on("release",r[8]),a=new an({props:{selectedTool:r[1],selectedPoint:r[0]}}),a.$on("optionsChanged",r[13]),{c(){Fe(e.$$.fragment),n=z(),Fe(i.$$.fragment),s=z(),o=O("div"),Fe(a.$$.fragment),this.h()},l(u){Ie(e.$$.fragment,u),n=D(u),Ie(i.$$.fragment,u),s=D(u),o=M(u,"DIV",{class:!0});var l=L(o);Ie(a.$$.fragment,l),l.forEach(T),this.h()},h(){w(o,"class","sidebar svelte-1eawmxs")},m(u,l){Oe(e,u,l),x(u,n,l),Oe(i,u,l),x(u,s,l),x(u,o,l),Oe(a,o,null),f=!0},p(u,[l]){const h={};l&16&&(h.model=u[4]),!t&&l&1&&(t=!0,h.selectedPoint=u[0],dt(()=>t=!1)),e.$set(h);const d={};l&16&&(d.model=u[4]),i.$set(d);const p={};l&2&&(p.selectedTool=u[1]),l&1&&(p.selectedPoint=u[0]),a.$set(p)},i(u){f||(ae(e.$$.fragment,u),ae(i.$$.fragment,u),ae(a.$$.fragment,u),f=!0)},o(u){fe(e.$$.fragment,u),fe(i.$$.fragment,u),fe(a.$$.fragment,u),f=!1},d(u){u&&(T(n),T(s),T(o)),Me(e,u),r[12](null),Me(i,u),Me(a)}}}function fn(r,e,t){let n,i,s={},o,a=new xe;function f(g){let k=i.click(g.detail,a,s);o.render(k)}function m(g){let k=i.pressDown(g.detail,a,s);o.render(k)}function c(g){o.renderTool(i,[g.detail.x,g.detail.y],s)}function v(g){let k=i.release(g.detail,a,s);o.render(k)}function u(g){t(4,a=g.detail),setTimeout(()=>{o.render(void 0)})}function l(g){n=g,t(0,n)}const h=g=>t(1,i=g.detail);function d(g){it[g?"unshift":"push"](()=>{o=g,t(3,o)})}return[n,i,s,o,a,f,m,c,v,u,l,h,d,g=>t(2,s=g.detail)]}class pn extends Te{constructor(e){super(),Se(this,e,fn,ln,be,{})}}export{pn as component};
