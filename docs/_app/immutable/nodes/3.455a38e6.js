var Ct=Object.defineProperty;var Ft=(r,e,t)=>e in r?Ct(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var P=(r,e,t)=>(Ft(r,typeof e!="symbol"?e+"":e,t),t);import{B as we,s as Re,f as M,a as N,g as S,h as J,A as ne,c as O,d as b,j as g,C as te,i as C,x,D as q,y as ye,E as $e,F as et,l as de,m as ve,k as Je,n as Fe,G as tt,o as Rt,e as ce,H as fe,I as Xe,J as Nt,K as Ot,L as it,p as Et}from"../chunks/scheduler.e646f8cb.js";import{S as Ne,i as Oe,a as ge,g as At,t as ke,c as Dt,b as Ae,d as De,m as Be,e as je}from"../chunks/index.ceed078a.js";import{$ as Bt}from"../chunks/es.c5c32fd6.js";import{w as Mt}from"../chunks/index.fdc6412e.js";function be(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}var jt=Object.defineProperty,Ut=(r,e,t)=>e in r?jt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,St=(r,e,t)=>(Ut(r,typeof e!="symbol"?e+"":e,t),t);const He=class ie{static timerStart(e){ie.openTimers.push({key:e,start:new Date().getTime()})}static timerEnd(e){const t=ie.openTimers.findIndex(i=>i.key===e);if(t<0)return;const n=ie.openTimers[t];ie.openTimers.splice(t,1),ie.telemetryData[e]=ie.telemetryData[e]??{key:e,calls:[],callsPerSecond:0,averageMsPerCall:0,maxMsPerCall:0,busyTime:0},ie.telemetryData[e].calls.push({key:e,start:n.start,end:new Date().getTime()})}static print(){console.log(["key","calls","busyTime","averageMsPerCall","callsPerSecond","maxMsPerCall"].join("	")),Object.values(ie.telemetryData).sort((e,t)=>t.busyTime-e.busyTime).forEach(e=>{console.log([e.key,e.calls.length,e.busyTime.toFixed(2),e.averageMsPerCall.toFixed(2),e.callsPerSecond.toFixed(2),e.maxMsPerCall.toFixed(2)].join("	"))})}};St(He,"openTimers",[]);St(He,"telemetryData",{});setInterval(()=>{const e=new Date().getTime()-6e4;Object.values(He.telemetryData).forEach(t=>{t.calls=t.calls.filter(n=>n.start>=e),t.callsPerSecond=t.calls.length/10,t.averageMsPerCall=t.calls.reduce((n,i)=>n+i.end-i.start,0)/t.calls.length,t.maxMsPerCall=t.calls.reduce((n,i)=>Math.max(n,i.end-i.start),0),t.busyTime=t.calls.reduce((n,i)=>n+i.end-i.start,0)/6e4})},5e3);let K=He;typeof document<"u"&&(document.printTelemetry=()=>K.print());function Ht(){var r,e=0,t=!1;function n(i,o){return r.list.push({type:i,data:o?JSON.parse(JSON.stringify(o)):void 0}),r}return r={list:[],segmentId:function(){return e++},checkIntersection:function(i,o){return n("check",{seg1:i,seg2:o})},segmentChop:function(i,o){return n("div_seg",{seg:i,pt:o}),n("chop",{seg:i,pt:o})},statusRemove:function(i){return n("pop_seg",{seg:i})},segmentUpdate:function(i){return n("seg_update",{seg:i})},segmentNew:function(i,o){return n("new_seg",{seg:i,primary:o})},segmentRemove:function(i){return n("rem_seg",{seg:i})},tempStatus:function(i,o,s){return n("temp_status",{seg:i,above:o,below:s})},rewind:function(i){return n("rewind",{seg:i})},status:function(i,o,s){return n("status",{seg:i,above:o,below:s})},vert:function(i){return i===t?r:(t=i,n("vert",{x:i}))},log:function(i){return typeof i!="string"&&(i=JSON.stringify(i,!1,"  ")),n("log",{txt:i})},reset:function(){return n("reset")},selected:function(i){return n("selected",{segs:i})},chainStart:function(i){return n("chain_start",{seg:i})},chainRemoveHead:function(i,o){return n("chain_rem_head",{index:i,pt:o})},chainRemoveTail:function(i,o){return n("chain_rem_tail",{index:i,pt:o})},chainNew:function(i,o){return n("chain_new",{pt1:i,pt2:o})},chainMatch:function(i){return n("chain_match",{index:i})},chainClose:function(i){return n("chain_close",{index:i})},chainAddHead:function(i,o){return n("chain_add_head",{index:i,pt:o})},chainAddTail:function(i,o){return n("chain_add_tail",{index:i,pt:o})},chainConnect:function(i,o){return n("chain_con",{index1:i,index2:o})},chainReverse:function(i){return n("chain_rev",{index:i})},chainJoin:function(i,o){return n("chain_join",{index1:i,index2:o})},done:function(){return n("done")}},r}var Vt=Ht;function Lt(r){typeof r!="number"&&(r=1e-10);var e={epsilon:function(t){return typeof t=="number"&&(r=t),r},pointAboveOrOnLine:function(t,n,i){var o=n[0],s=n[1],l=i[0],c=i[1],a=t[0],f=t[1];return(l-o)*(f-s)-(c-s)*(a-o)>=-r},pointBetween:function(t,n,i){var o=t[1]-n[1],s=i[0]-n[0],l=t[0]-n[0],c=i[1]-n[1],a=l*s+o*c;if(a<r)return!1;var f=s*s+c*c;return!(a-f>-r)},pointsSameX:function(t,n){return Math.abs(t[0]-n[0])<r},pointsSameY:function(t,n){return Math.abs(t[1]-n[1])<r},pointsSame:function(t,n){return e.pointsSameX(t,n)&&e.pointsSameY(t,n)},pointsCompare:function(t,n){return e.pointsSameX(t,n)?e.pointsSameY(t,n)?0:t[1]<n[1]?-1:1:t[0]<n[0]?-1:1},pointsCollinear:function(t,n,i){var o=t[0]-n[0],s=t[1]-n[1],l=n[0]-i[0],c=n[1]-i[1];return Math.abs(o*c-l*s)<r},linesIntersect:function(t,n,i,o){var s=n[0]-t[0],l=n[1]-t[1],c=o[0]-i[0],a=o[1]-i[1],f=s*a-l*c;if(Math.abs(f)<r)return!1;var d=t[0]-i[0],v=t[1]-i[1],u=(c*v-a*d)/f,h=(s*v-l*d)/f,p={alongA:0,alongB:0,pt:[t[0]+u*s,t[1]+u*l]};return u<=-r?p.alongA=-2:u<r?p.alongA=-1:u-1<=-r?p.alongA=0:u-1<r?p.alongA=1:p.alongA=2,h<=-r?p.alongB=-2:h<r?p.alongB=-1:h-1<=-r?p.alongB=0:h-1<r?p.alongB=1:p.alongB=2,p},pointInsideRegion:function(t,n){for(var i=t[0],o=t[1],s=n[n.length-1][0],l=n[n.length-1][1],c=!1,a=0;a<n.length;a++){var f=n[a][0],d=n[a][1];d-o>r!=l-o>r&&(s-f)*(o-d)/(l-d)+f-i>r&&(c=!c),s=f,l=d}return c}};return e}var qt=Lt,Jt={create:function(){var r={root:{root:!0,next:null},exists:function(e){return!(e===null||e===r.root)},isEmpty:function(){return r.root.next===null},getHead:function(){return r.root.next},insertBefore:function(e,t){for(var n=r.root,i=r.root.next;i!==null;){if(t(i)){e.prev=i.prev,e.next=i,i.prev.next=e,i.prev=e;return}n=i,i=i.next}n.next=e,e.prev=n,e.next=null},findTransition:function(e){for(var t=r.root,n=r.root.next;n!==null&&!e(n);)t=n,n=n.next;return{before:t===r.root?null:t,after:n,insert:function(i){return i.prev=t,i.next=n,t.next=i,n!==null&&(n.prev=i),i}}}};return r},node:function(r){return r.prev=null,r.next=null,r.remove=function(){r.prev.next=r.next,r.next&&(r.next.prev=r.prev),r.prev=null,r.next=null},r}},Xt=Jt,xe=Xt;function Yt(r,e,t){function n(h,p){return{id:t?t.segmentId():-1,start:h,end:p,myFill:{above:null,below:null},otherFill:null}}function i(h,p,m){return{id:t?t.segmentId():-1,start:h,end:p,myFill:{above:m.myFill.above,below:m.myFill.below},otherFill:null}}var o=xe.create();function s(h,p,m,y,k,T){var V=e.pointsCompare(p,k);return V!==0?V:e.pointsSame(m,T)?0:h!==y?h?1:-1:e.pointAboveOrOnLine(m,y?k:T,y?T:k)?1:-1}function l(h,p){o.insertBefore(h,function(m){var y=s(h.isStart,h.pt,p,m.isStart,m.pt,m.other.pt);return y<0})}function c(h,p){var m=xe.node({isStart:!0,pt:h.start,seg:h,primary:p,other:null,status:null});return l(m,h.end),m}function a(h,p,m){var y=xe.node({isStart:!1,pt:p.end,seg:p,primary:m,other:h,status:null});h.other=y,l(y,h.pt)}function f(h,p){var m=c(h,p);return a(m,h,p),m}function d(h,p){t&&t.segmentChop(h.seg,p),h.other.remove(),h.seg.end=p,h.other.pt=p,l(h.other,h.pt)}function v(h,p){var m=i(p,h.seg.end,h.seg);return d(h,p),f(m,h.primary)}function u(h,p){var m=xe.create();function y(w,R){var G=w.seg.start,re=w.seg.end,U=R.seg.start,L=R.seg.end;return e.pointsCollinear(G,U,L)?e.pointsCollinear(re,U,L)||e.pointAboveOrOnLine(re,U,L)?1:-1:e.pointAboveOrOnLine(G,U,L)?1:-1}function k(w){return m.findTransition(function(R){var G=y(w,R.ev);return G>0})}function T(w,R){var G=w.seg,re=R.seg,U=G.start,L=G.end,he=re.start,oe=re.end;t&&t.checkIntersection(G,re);var $=e.linesIntersect(U,L,he,oe);if($===!1){if(!e.pointsCollinear(U,L,he)||e.pointsSame(U,oe)||e.pointsSame(L,he))return!1;var Ve=e.pointsSame(U,he),Le=e.pointsSame(L,oe);if(Ve&&Le)return R;var zt=!Ve&&e.pointBetween(U,he,oe),rt=!Le&&e.pointBetween(L,he,oe);if(Ve)return rt?v(R,L):v(w,oe),R;zt&&(Le||(rt?v(R,L):v(w,oe)),v(R,U))}else $.alongA===0&&($.alongB===-1?v(w,he):$.alongB===0?v(w,$.pt):$.alongB===1&&v(w,oe)),$.alongB===0&&($.alongA===-1?v(R,U):$.alongA===0?v(R,$.pt):$.alongA===1&&v(R,L));return!1}for(var V=[];!o.isEmpty();){var _=o.getHead();if(t&&t.vert(_.pt[0]),_.isStart){let w=function(){if(X){var R=T(_,X);if(R)return R}return F?T(_,F):!1};t&&t.segmentNew(_.seg,_.primary);var E=k(_),X=E.before?E.before.ev:null,F=E.after?E.after.ev:null;t&&t.tempStatus(_.seg,X?X.seg:!1,F?F.seg:!1);var I=w();if(I){if(r){var A;_.seg.myFill.below===null?A=!0:A=_.seg.myFill.above!==_.seg.myFill.below,A&&(I.seg.myFill.above=!I.seg.myFill.above)}else I.seg.otherFill=_.seg.myFill;t&&t.segmentUpdate(I.seg),_.other.remove(),_.remove()}if(o.getHead()!==_){t&&t.rewind(_.seg);continue}if(r){var A;_.seg.myFill.below===null?A=!0:A=_.seg.myFill.above!==_.seg.myFill.below,F?_.seg.myFill.below=F.seg.myFill.above:_.seg.myFill.below=h,A?_.seg.myFill.above=!_.seg.myFill.below:_.seg.myFill.above=_.seg.myFill.below}else if(_.seg.otherFill===null){var Z;F?_.primary===F.primary?Z=F.seg.otherFill.above:Z=F.seg.myFill.above:Z=_.primary?p:h,_.seg.otherFill={above:Z,below:Z}}t&&t.status(_.seg,X?X.seg:!1,F?F.seg:!1),_.other.status=E.insert(xe.node({ev:_}))}else{var D=_.status;if(D===null)throw new Error("PolyBool: Zero-length segment detected; your epsilon is probably too small or too large");if(m.exists(D.prev)&&m.exists(D.next)&&T(D.prev.ev,D.next.ev),t&&t.statusRemove(D.ev.seg),D.remove(),!_.primary){var B=_.seg.myFill;_.seg.myFill=_.seg.otherFill,_.seg.otherFill=B}V.push(_.seg)}o.getHead().remove()}return t&&t.done(),V}return r?{addRegion:function(h){for(var p,m=h[h.length-1],y=0;y<h.length;y++){p=m,m=h[y];var k=e.pointsCompare(p,m);k!==0&&f(n(k<0?p:m,k<0?m:p),!0)}},calculate:function(h){return u(h,!1)}}:{calculate:function(h,p,m,y){return h.forEach(function(k){f(i(k.start,k.end,k),!0)}),m.forEach(function(k){f(i(k.start,k.end,k),!1)}),u(p,y)}}}var Gt=Yt;function Kt(r,e,t){var n=[],i=[];return r.forEach(function(o){var s=o.start,l=o.end;if(e.pointsSame(s,l)){console.warn("PolyBool: Warning: Zero-length segment detected; your epsilon is probably too small or too large");return}t&&t.chainStart(o);var c={index:0,matches_head:!1,matches_pt1:!1},a={index:0,matches_head:!1,matches_pt1:!1},f=c;function d(D,B,w){return f.index=D,f.matches_head=B,f.matches_pt1=w,f===c?(f=a,!1):(f=null,!0)}for(var v=0;v<n.length;v++){var u=n[v],h=u[0];u[1];var p=u[u.length-1];if(u[u.length-2],e.pointsSame(h,s)){if(d(v,!0,!0))break}else if(e.pointsSame(h,l)){if(d(v,!0,!1))break}else if(e.pointsSame(p,s)){if(d(v,!1,!0))break}else if(e.pointsSame(p,l)&&d(v,!1,!1))break}if(f===c){n.push([s,l]),t&&t.chainNew(s,l);return}if(f===a){t&&t.chainMatch(c.index);var m=c.index,y=c.matches_pt1?l:s,k=c.matches_head,u=n[m],T=k?u[0]:u[u.length-1],V=k?u[1]:u[u.length-2],_=k?u[u.length-1]:u[0],E=k?u[u.length-2]:u[1];if(e.pointsCollinear(V,T,y)&&(k?(t&&t.chainRemoveHead(c.index,y),u.shift()):(t&&t.chainRemoveTail(c.index,y),u.pop()),T=V),e.pointsSame(_,y)){n.splice(m,1),e.pointsCollinear(E,_,T)&&(k?(t&&t.chainRemoveTail(c.index,T),u.pop()):(t&&t.chainRemoveHead(c.index,T),u.shift())),t&&t.chainClose(c.index),i.push(u);return}k?(t&&t.chainAddHead(c.index,y),u.unshift(y)):(t&&t.chainAddTail(c.index,y),u.push(y));return}function X(D){t&&t.chainReverse(D),n[D].reverse()}function F(D,B){var w=n[D],R=n[B],G=w[w.length-1],re=w[w.length-2],U=R[0],L=R[1];e.pointsCollinear(re,G,U)&&(t&&t.chainRemoveTail(D,G),w.pop(),G=re),e.pointsCollinear(G,U,L)&&(t&&t.chainRemoveHead(B,U),R.shift()),t&&t.chainJoin(D,B),n[D]=w.concat(R),n.splice(B,1)}var I=c.index,A=a.index;t&&t.chainConnect(I,A);var Z=n[I].length<n[A].length;c.matches_head?a.matches_head?Z?(X(I),F(I,A)):(X(A),F(A,I)):F(A,I):a.matches_head?F(I,A):Z?(X(I),F(A,I)):(X(A),F(I,A))}),i}var Qt=Kt;function Te(r,e,t){var n=[];for(let o=0;o<r.length;o++){const s=r[o];var i=(s.myFill.above?8:0)+(s.myFill.below?4:0)+(s.otherFill&&s.otherFill.above?2:0)+(s.otherFill&&s.otherFill.below?1:0);e[i]!==0&&n.push({id:t?t.segmentId():-1,start:s.start,end:s.end,myFill:{above:e[i]===1,below:e[i]===2},otherFill:null})}return t&&t.selected(n),n}var Zt={union:function(r,e){return Te(r,[0,2,1,0,2,2,0,0,1,0,1,0,0,0,0,0],e)},intersect:function(r,e){return Te(r,[0,0,0,0,0,2,0,2,0,0,1,1,0,2,1,0],e)},difference:function(r,e){return Te(r,[0,0,0,0,2,0,2,0,1,1,0,0,0,1,2,0],e)},differenceRev:function(r,e){return Te(r,[0,2,1,0,0,0,1,1,0,2,0,2,0,0,0,0],e)},xor:function(r,e){return Te(r,[0,2,1,0,2,0,0,1,1,0,0,2,0,1,2,0],e)}},Wt=Zt,$t={toPolygon:function(r,e){function t(o){if(o.length<=0)return r.segments({inverted:!1,regions:[]});function s(a){var f=a.slice(0,a.length-1);return r.segments({inverted:!1,regions:[f]})}for(var l=s(o[0]),c=1;c<o.length;c++)l=r.selectDifference(r.combine(l,s(o[c])));return l}if(e.type==="Polygon")return r.polygon(t(e.coordinates));if(e.type==="MultiPolygon"){for(var n=r.segments({inverted:!1,regions:[]}),i=0;i<e.coordinates.length;i++)n=r.selectUnion(r.combine(n,t(e.coordinates[i])));return r.polygon(n)}throw new Error("PolyBool: Cannot convert GeoJSON object to PolyBool polygon")},fromPolygon:function(r,e,t){t=r.polygon(r.segments(t));function n(u,h){return e.pointInsideRegion([(u[0][0]+u[1][0])*.5,(u[0][1]+u[1][1])*.5],h)}function i(u){return{region:u,children:[]}}var o=i(null);function s(u,h){for(var p=0;p<u.children.length;p++){var m=u.children[p];if(n(h,m.region)){s(m,h);return}}for(var y=i(h),p=0;p<u.children.length;p++){var m=u.children[p];n(m.region,h)&&(y.children.push(m),u.children.splice(p,1),p--)}u.children.push(y)}for(var l=0;l<t.regions.length;l++){var c=t.regions[l];c.length<3||s(o,c)}function a(u,h){for(var p=0,m=u[u.length-1][0],y=u[u.length-1][1],k=[],T=0;T<u.length;T++){var V=u[T][0],_=u[T][1];k.push([V,_]),p+=_*m-V*y,m=V,y=_}var E=p<0;return E!==h&&k.reverse(),k.push([k[0][0],k[0][1]]),k}var f=[];function d(u){var h=[a(u.region,!1)];f.push(h);for(var p=0;p<u.children.length;p++)h.push(v(u.children[p]))}function v(u){for(var h=0;h<u.children.length;h++)d(u.children[h]);return a(u.region,!0)}for(var l=0;l<o.children.length;l++)d(o.children[l]);return f.length<=0?{type:"Polygon",coordinates:[]}:f.length==1?{type:"Polygon",coordinates:f[0]}:{type:"MultiPolygon",coordinates:f}}},en=$t;/*
 * @copyright 2016 Sean Connelly (@voidqk), http://syntheti.cc
 * @license MIT
 * @preserve Project Home: https://github.com/voidqk/polybooljs
 */var tn=Vt,nn=qt,ot=Gt,rn=Qt,Me=Wt,st=en,W=!1,Se=nn(),Y;Y={buildLog:function(r){return r===!0?W=tn():r===!1&&(W=!1),W===!1?!1:W.list},epsilon:function(r){return Se.epsilon(r)},segments:function(r){var e=ot(!0,Se,W);return r.regions.forEach(e.addRegion),{segments:e.calculate(r.inverted),inverted:r.inverted}},combine:function(r,e){var t=ot(!1,Se,W);return{combined:t.calculate(r.segments,r.inverted,e.segments,e.inverted),inverted1:r.inverted,inverted2:e.inverted}},selectUnion:function(r){return{segments:Me.union(r.combined,W),inverted:r.inverted1||r.inverted2}},selectIntersect:function(r){return{segments:Me.intersect(r.combined,W),inverted:r.inverted1&&r.inverted2}},selectDifference:function(r){return{segments:Me.difference(r.combined,W),inverted:r.inverted1&&!r.inverted2}},selectDifferenceRev:function(r){return{segments:Me.differenceRev(r.combined,W),inverted:!r.inverted1&&r.inverted2}},selectXor:function(r){return{segments:Me.xor(r.combined,W),inverted:r.inverted1!==r.inverted2}},polygon:function(r){return{regions:rn(r.segments,Se,W),inverted:r.inverted}},polygonFromGeoJSON:function(r){return st.toPolygon(Y,r)},polygonToGeoJSON:function(r){return st.fromPolygon(Y,Se,r)},union:function(r,e){return Pe(r,e,Y.selectUnion)},intersect:function(r,e){return Pe(r,e,Y.selectIntersect)},difference:function(r,e){return Pe(r,e,Y.selectDifference)},differenceRev:function(r,e){return Pe(r,e,Y.selectDifferenceRev)},xor:function(r,e){return Pe(r,e,Y.selectXor)}};function Pe(r,e,t){var n=Y.segments(r),i=Y.segments(e),o=Y.combine(n,i),s=t(o);return Y.polygon(s)}typeof window=="object"&&(window.PolyBool=Y);var Ie=Y;class Ee{static union(e,t){return Ie.union(e,t)}static intersect(e,t){return Ie.intersect(e,t)}static difference(e,t){return Ie.difference(e,t)}static differenceRev(e,t){return Ie.differenceRev(e,t)}static xor(e,t){return Ie.xor(e,t)}}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function on(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(a){return function(f){return c([a,f])}}function c(a){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,i=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){t.label=a[1];break}if(a[0]===6&&t.label<o[1]){t.label=o[1],o=a;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(a);break}o[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(r,t)}catch(f){a=[6,f],i=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}var ue=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function sn(r,e){return r>e?1:r<e?-1:0}function se(r,e,t){for(var n=new ue(null,null),i=n,o=n;;){var s=t(r,e.key);if(s<0){if(e.left===null)break;if(t(r,e.left.key)<0){var l=e.left;if(e.left=l.right,l.right=e,e=l,e.left===null)break}o.left=e,o=e,e=e.left}else if(s>0){if(e.right===null)break;if(t(r,e.right.key)>0){var l=e.right;if(e.right=l.left,l.left=e,e=l,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function qe(r,e,t,n){var i=new ue(r,e);if(t===null)return i.left=i.right=null,i;t=se(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function lt(r,e,t){var n=null,i=null;if(e){e=se(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function ln(r,e,t){return e===null?r:(r===null||(e=se(r.key,e,t),e.left=r),e)}function Ye(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&Ye(r.left,o,!1,n,i),r.right&&Ye(r.right,o,!0,n,i)}}var an=function(){function r(e){e===void 0&&(e=sn),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=qe(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new ue(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=se(e,this._root,i),s=i(e,o.key);return s===0?this._root=o:(s<0?(n.left=o.left,n.right=o,o.left=null):s>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=se(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=se(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=se(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=se(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],s=this._comparator,l=this._root,c;o.length!==0||l;)if(l)o.push(l),l=l.left;else{if(l=o.pop(),c=s(l.key,t),c>0)break;if(s(l.key,e)>=0&&n.call(i,l))return this;l=l.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return fn(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&Qe(e,t,0,i-1,o),this._root===null)this._root=Ge(e,t,0,i),this._size=i;else{var s=un(this.toList(),cn(e,t),o);i=this._size+i,this._root=Ke({head:s},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return Ye(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=lt(e,this._root,i),s=o.left,l=o.right;i(e,t)<0?l=qe(t,n,l,i):s=qe(t,n,s,i),this._root=ln(s,l,i)},r.prototype.split=function(e){return lt(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e,t,n;return on(this,function(i){switch(i.label){case 0:e=this._root,t=[],n=!1,i.label=1;case 1:return n?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return i.sent(),e=e.right,[3,5];case 4:n=!0,i.label=5;case 5:return[3,1];case 6:return[2]}})},r}();function Ge(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),s=r[o],l=e[o],c=new ue(s,l);return c.left=Ge(r,e,t,o),c.right=Ge(r,e,o+1,n),c}return null}function cn(r,e){for(var t=new ue(null,null),n=t,i=0;i<r.length;i++)n=n.next=new ue(r[i],e[i]);return n.next=null,t.next}function fn(r){for(var e=r,t=[],n=!1,i=new ue(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function Ke(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=Ke(r,e,i),s=r.head;return s.left=o,r.head=r.head.next,s.right=Ke(r,i+1,t),s}return null}function un(r,e,t){for(var n=new ue(null,null),i=n,o=r,s=e;o!==null&&s!==null;)t(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;return o!==null?i.next=o:s!==null&&(i.next=s),n.next}function Qe(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],s=t-1,l=n+1;;){do s++;while(i(r[s],o)<0);do l--;while(i(r[l],o)>0);if(s>=l)break;var c=r[s];r[s]=r[l],r[l]=c,c=e[s],e[s]=e[l],e[l]=c}Qe(r,e,t,l,i),Qe(r,e,l+1,n,i)}}let le=Number.EPSILON;le===void 0&&(le=Math.pow(2,-52));const hn=le*le,at=(r,e)=>{if(-le<r&&r<le&&-le<e&&e<le)return 0;const t=r-e;return t*t<hn*r*e?0:r<e?-1:1};class pn{constructor(){this.reset()}reset(){this.xRounder=new ct,this.yRounder=new ct}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class ct{constructor(){this.tree=new an,this.round(0)}round(e){const t=this.tree.add(e),n=this.tree.prev(t);if(n!==null&&at(t.key,n.key)===0)return this.tree.remove(e),n.key;const i=this.tree.next(t);return i!==null&&at(t.key,i.key)===0?(this.tree.remove(e),i.key):e}}new pn;class Q{constructor(e){P(this,"polygons",[]);P(this,"unoptimizedUnionVectors",[]);this.polygons=e}fastUnion(e){const t=new Q(this.polygons);return t.unoptimizedUnionVectors=this.unoptimizedUnionVectors.concat([e]),t}union(e){K.timerStart("Vector union polybool");const t=Ee.union({regions:this.polygons.map(i=>i.nodes),inverted:!1},{regions:e.polygons.map(i=>i.nodes),inverted:!1}),n=new Q(t.regions.map(i=>({nodes:i})));return K.timerEnd("Vector union polybool"),n}intersect(e){const t=Ee.intersect({regions:this.polygons.map(n=>n.nodes),inverted:!1},{regions:e.polygons.map(n=>n.nodes),inverted:!1});return new Q(t.regions.map(n=>({nodes:n})))}difference(e){const t=Ee.difference({regions:this.polygons.map(n=>n.nodes),inverted:!1},{regions:e.polygons.map(n=>n.nodes),inverted:!1});return new Q(t.regions.map(n=>({nodes:n})))}xor(e){const t=Ee.xor({regions:this.polygons.map(n=>n.nodes),inverted:!1},{regions:e.polygons.map(n=>n.nodes),inverted:!1});return new Q(t.regions.map(n=>({nodes:n})))}optimize(){let e=new Q(this.polygons);for(const t of this.unoptimizedUnionVectors)e=e.union(t);return e}}class Pt{static square(e,t,n,i){return new Q([{nodes:[[e,t],[e+n,t],[e+n,t+i],[e,t+i]]}])}static circle(e,t,n,i,o=0){const s={nodes:[]};for(let l=0;l<Math.PI*2;l+=Math.PI/i){const c=l+o;s.nodes.push([e+Math.cos(c)*n,t+Math.sin(c)*n])}return new Q([s])}}var H=(r=>(r[r.Point=0]="Point",r[r.MajorCity=1]="MajorCity",r[r.City=2]="City",r[r.Town=3]="Town",r[r.Village=4]="Village",r[r.PointOfInterest=99]="PointOfInterest",r))(H||{});const ft={0:"Point",1:"Major City",2:"City",3:"Town",4:"Village",99:"Point of Interest"};class Ze{constructor(){P(this,"version",1);P(this,"terrain",{vector:new Q([])});P(this,"features",[]);P(this,"paths",[]);P(this,"points",[])}}class Ce{static newMap(){return new Ze}static async uploadMap(){const e=await Ce.fileDialog(),t=new Ze;if(typeof e=="string")return Object.assign(t,JSON.parse(e)),t.terrain.vector=new Q(t.terrain.vector.polygons),t.features.forEach(n=>{n.vector=new Q(n.vector.polygons)}),t}static async fileDialog(){return new Promise(e=>{const t=document.createElement("input");t.type="file",t.onchange=()=>{const n=t.files;if(n){const i=new FileReader;return i.onload=function(o){var s;return e(((s=o.target)==null?void 0:s.result)||"")},i.readAsText(n[0])}return e(void 0)},t.click()})}static downloadMap(e){const t=document.createElement("a");Bt.capture("save_map",{model:e}),t.href="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),t.download="map.json",t.click()}}var mn=Object.defineProperty,dn=(r,e,t)=>e in r?mn(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,vn=(r,e,t)=>(dn(r,typeof e!="symbol"?e+"":e,t),t);const nt=class{static register(e,t){this.listeners.push({key:e.key,modifiers:e.modifiers,callback:t})}};vn(nt,"listeners",[]);typeof document<"u"?document.addEventListener("keydown",r=>{if(!(r.target&&"tagName"in r.target&&r.target.tagName==="INPUT"))for(const e of nt.listeners)r.key===e.key&&e.callback()}):console.error("No document on keybind registration. No keybinds will work");let _e=nt;class We{constructor(e){this.model=e}getNearestPoint(e,t,n){const i=n*n;let o,s=1/0;for(const l of this.model.points){const c=(l.x-e)*(l.x-e)+(l.y-t)*(l.y-t);c<=i&&c<s&&(o=l,s=c)}return o}}const ae=Mt(void 0),Ue=class Ue{constructor(e,t,n,i){this.x=e,this.y=t,this.width=n,this.height=i}};P(Ue,"NO_PAINT",new Ue(0,0,0,0));let j=Ue;const gn=[{id:H.MajorCity,label:"Major City"},{id:H.City,label:"City"},{id:H.Town,label:"Town"},{id:H.Village,label:"Village"},{id:H.PointOfInterest,label:"PointOfInterest"}];class yn{getOptions(){return[{name:"Type",key:"type",type:"enum",options:gn}]}click(e,t,n){if(new We(t).getNearestPoint(e.x,e.y,5))return j.NO_PAINT;{const o={x:e.x,y:e.y,type:n.type,name:""};t.points.push(o),ae.set(o)}}pressDown(){return j.NO_PAINT}release(){return j.NO_PAINT}render(){}}class _n{constructor(){P(this,"radius",10)}getOptions(){return[]}click(e,t){const n=new We(t).getNearestPoint(e.x,e.y,this.radius);return n?(ae.set(n),j.NO_PAINT):(ae.set(void 0),j.NO_PAINT)}pressDown(e){const t=we(ae);if(t){t.x=e.x,t.y=e.y;return}return j.NO_PAINT}release(){return j.NO_PAINT}render(e,t,n,i){const o=new We(i).getNearestPoint(e[0],e[1],this.radius);o&&(n.strokeStyle="#7EBDC3",n.lineWidth=1,n.strokeRect(o.x-this.radius,o.y-this.radius,this.radius*2,this.radius*2));const s=we(ae);s&&(n.strokeStyle="#7EBDC3",n.lineWidth=2,n.strokeRect(s.x-this.radius,s.y-this.radius,this.radius*2,this.radius*2))}}class wn{getOptions(){return[{key:"size",name:"Size",type:"number",default:25,min:5,max:100,step:1},{key:"erase",name:"Erase",type:"boolean"}]}click(){return j.NO_PAINT}pressDown(e,t,n){const i=Math.ceil(n.size/(8*Math.PI))+3,o=Pt.circle(e.x,e.y,n.size,i,Math.random()*Math.PI);t.features.length===0&&t.features.push({type:"forest",vector:new Q([])}),n.erase?t.features[0].vector=t.features[0].vector.difference(o):t.features[0].vector=t.features[0].vector.union(o)}release(e,t){t.features[0].vector=t.features[0].vector.optimize()}render(e,t,n){n.beginPath(),n.fillStyle="#FFFFFF50",n.arc(e[0],e[1],t.size,0,Math.PI*2),n.fill()}}class kn{getOptions(){return[{key:"size",name:"Size",type:"number",default:25,min:5,max:100,step:1},{key:"erase",name:"Erase",type:"boolean"}]}click(){return j.NO_PAINT}pressDown(e,t,n){const i=Math.ceil(n.size/(2*Math.PI))+3,o=Pt.circle(e.x,e.y,n.size,i,Math.random()*Math.PI);n.erase?t.terrain.vector=t.terrain.vector.difference(o):t.terrain.vector=t.terrain.vector.union(o)}release(e,t){t.terrain.vector=t.terrain.vector.optimize()}render(e,t,n){n.beginPath(),n.fillStyle="#FFFFFF50",n.arc(e[0],e[1],t.size,0,Math.PI*2),n.fill()}}class It{async preload(){}render(e,t){t.clearRect(0,0,1200,860);for(let n=0;n<e.paths.length;n++)this.renderPath(e.paths[n],t)}renderPath(e,t){t.beginPath(),t.moveTo(e.nodes[0][0],e.nodes[0][1]);for(let n=1;n<e.nodes.length;n++){const i=this.midPointBtw(e.nodes[n-1],e.nodes[n]);t.quadraticCurveTo(e.nodes[n-1][0],e.nodes[n-1][1],i[0],i[1])}t.lineTo(e.nodes[e.nodes.length-1][0],e.nodes[e.nodes.length-1][1]),t.filter="blur(0.1px)",t.strokeStyle="#381d0aA0",t.lineWidth=2,t.lineCap="round",t.setLineDash([6,4]),t.stroke()}midPointBtw(e,t){return[e[0]+(t[0]-e[0])/2,e[1]+(t[1]-e[1])/2]}}class bn{constructor(){P(this,"nodes",[])}getOptions(){return[]}click(e,t){if(this.nodes.length>=1&&this.nodes[this.nodes.length-1][0]===e.x&&this.nodes[this.nodes.length-1][1]===e.y){t.paths.push({nodes:this.nodes});const n={minx:1/0,miny:1/0,maxx:-1/0,maxy:-1/0};for(const i of this.nodes)n.minx=Math.min(n.minx,i[0]),n.miny=Math.min(n.miny,i[0]),n.maxx=Math.max(n.maxx,i[1]),n.maxy=Math.max(n.maxy,i[1]);return this.nodes=[],new j(n.minx,n.miny,n.maxx-n.minx,n.maxy-n.miny)}return this.nodes.push([e.x,e.y]),j.NO_PAINT}pressDown(){return j.NO_PAINT}release(){return j.NO_PAINT}render(e,t,n){if(this.nodes.length>0){const i=this.nodes.concat([e]);new It().renderPath({nodes:i},n)}}}function xn(r){let e,t,n='<i class="fa fa-file"></i>',i,o,s='<i class="fa fa-floppy-disk"></i>',l,c,a='<i class="fa fa-folder-open"></i>',f,d,v,u,h='<i class="fa fa-arrow-pointer"></i>',p,m,y='<i class="fa fa-paintbrush"></i>',k,T,V='<i class="fa fa-landmark"></i>',_,E,X='<i class="fa fa-tree"></i>',F,I,A='<i class="fa fa-road"></i>',Z,D;return{c(){e=M("div"),t=M("button"),t.innerHTML=n,i=N(),o=M("button"),o.innerHTML=s,l=N(),c=M("button"),c.innerHTML=a,f=N(),d=M("hr"),v=N(),u=M("button"),u.innerHTML=h,p=N(),m=M("button"),m.innerHTML=y,k=N(),T=M("button"),T.innerHTML=V,_=N(),E=M("button"),E.innerHTML=X,F=N(),I=M("button"),I.innerHTML=A,this.h()},l(B){e=S(B,"DIV",{class:!0});var w=J(e);t=S(w,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),ne(t)!=="svelte-1m01bc9"&&(t.innerHTML=n),i=O(w),o=S(w,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),ne(o)!=="svelte-1gea4ds"&&(o.innerHTML=s),l=O(w),c=S(w,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),ne(c)!=="svelte-18vhduo"&&(c.innerHTML=a),f=O(w),d=S(w,"HR",{class:!0}),v=O(w),u=S(w,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),ne(u)!=="svelte-1n6mnah"&&(u.innerHTML=h),p=O(w),m=S(w,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),ne(m)!=="svelte-1q2mh60"&&(m.innerHTML=y),k=O(w),T=S(w,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),ne(T)!=="svelte-10fbohv"&&(T.innerHTML=V),_=O(w),E=S(w,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),ne(E)!=="svelte-dgiflo"&&(E.innerHTML=X),F=O(w),I=S(w,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),ne(I)!=="svelte-1gmqo2i"&&(I.innerHTML=A),w.forEach(b),this.h()},h(){g(t,"title","New map"),g(t,"class","svelte-1ecqtnm"),g(o,"title","Save map"),g(o,"class","svelte-1ecqtnm"),g(c,"title","Upload map"),g(c,"class","svelte-1ecqtnm"),g(d,"class","svelte-1ecqtnm"),g(u,"title","Selection tool (S)"),g(u,"class","svelte-1ecqtnm"),te(u,"selected",r[0]==="select"),g(m,"title","Terrain tool (T)"),g(m,"class","svelte-1ecqtnm"),te(m,"selected",r[0]==="terrain"),g(T,"title","Settlement tool (E)"),g(T,"class","svelte-1ecqtnm"),te(T,"selected",r[0]==="point"),g(E,"title","Forest tool (F)"),g(E,"class","svelte-1ecqtnm"),te(E,"selected",r[0]==="forest"),g(I,"title","Path tool (P)"),g(I,"class","svelte-1ecqtnm"),te(I,"selected",r[0]==="path"),g(e,"class","toolbar svelte-1ecqtnm")},m(B,w){C(B,e,w),x(e,t),x(e,i),x(e,o),x(e,l),x(e,c),x(e,f),x(e,d),x(e,v),x(e,u),x(e,p),x(e,m),x(e,k),x(e,T),x(e,_),x(e,E),x(e,F),x(e,I),Z||(D=[q(t,"click",r[1]),q(o,"click",r[3]),q(c,"click",r[2]),q(u,"click",r[5]),q(m,"click",r[6]),q(T,"click",r[7]),q(E,"click",r[8]),q(I,"click",r[9])],Z=!0)},p(B,[w]){w&1&&te(u,"selected",B[0]==="select"),w&1&&te(m,"selected",B[0]==="terrain"),w&1&&te(T,"selected",B[0]==="point"),w&1&&te(E,"selected",B[0]==="forest"),w&1&&te(I,"selected",B[0]==="path")},i:ye,o:ye,d(B){B&&b(e),Z=!1,$e(D)}}}function Tn(r,e,t){const n=et(),i={select:new _n,terrain:new kn,point:new yn,forest:new wn,path:new bn};let{selectedToolKey:o="terrain"}=e,{model:s}=e;setTimeout(()=>{n("toolSelected",i[o])},200);function l(){n("modelReplaced",Ce.newMap())}async function c(){const p=await Ce.uploadMap();p&&n("modelReplaced",p)}function a(){Ce.downloadMap(s)}_e.register({key:"s"},()=>t(0,o="select")),_e.register({key:"t"},()=>t(0,o="terrain")),_e.register({key:"e"},()=>t(0,o="point")),_e.register({key:"f"},()=>t(0,o="forest")),_e.register({key:"p"},()=>t(0,o="path"));const f=()=>t(0,o="select"),d=()=>t(0,o="terrain"),v=()=>t(0,o="point"),u=()=>t(0,o="forest"),h=()=>t(0,o="path");return r.$$set=p=>{"selectedToolKey"in p&&t(0,o=p.selectedToolKey),"model"in p&&t(4,s=p.model)},r.$$.update=()=>{r.$$.dirty&1&&n("toolSelected",i[o])},[o,l,c,a,s,f,d,v,u,h]}class Mn extends Ne{constructor(e){super(),Oe(this,e,Tn,xn,Re,{selectedToolKey:0,model:4})}}const z=class z{static async preload(e){let n=0;e(n++/8,"Loading water.png"),z.water=await z.loadImage("/images/map/water.png"),e(n++/8,"Loading grass.png"),z.grass=await z.loadImage("/images/map/grass.png"),e(n++/8,"Loading settlement-major-city.png"),z.majorCity=await z.loadImage("/images/map/settlement-major-city.png"),e(n++/8,"Loading settlement-city.png"),z.city=await z.loadImage("/images/map/settlement-city.png"),e(n++/8,"Loading settlement-town.png"),z.town=await z.loadImage("/images/map/settlement-town.png"),e(n++/8,"Loading settlement-village.png"),z.village=await z.loadImage("/images/map/settlement-village.png"),e(n++/8,"Loading settlement-poi.png"),z.pointOfInterest=await z.loadImage("/images/map/settlement-poi.png"),e(n++/8,"Loading tree-1.png"),z.tree=await z.loadImage("/images/map/tree-1.png")}static async loadImage(e){const t=new Image,n=new Promise(i=>t.onload=i);return t.src=z.getPath(e),await n,t}static getPath(e){return document.location.href.includes("github")?"/cartoga"+e:e}};P(z,"water"),P(z,"grass"),P(z,"majorCity"),P(z,"city"),P(z,"town"),P(z,"village"),P(z,"pointOfInterest"),P(z,"tree");let ee=z;const pe=Mt({zoomLevel:2,zoomMultiplier:1,pan:{x:0,y:0}});class Sn{constructor(){P(this,"textures",new Map);P(this,"nameOptions",new Map)}async preload(){this.textures.set(H.MajorCity,ee.majorCity),this.textures.set(H.City,ee.city),this.textures.set(H.Town,ee.town),this.textures.set(H.Village,ee.village),this.textures.set(H.PointOfInterest,ee.pointOfInterest),this.nameOptions.set(H.MajorCity,{render:!0,fontSize:14}),this.nameOptions.set(H.City,{render:!0,fontSize:12}),this.nameOptions.set(H.Town,{render:!0,fontSize:8}),this.nameOptions.set(H.Village,{render:!1,fontSize:0}),this.nameOptions.set(H.PointOfInterest,{render:!0,fontSize:8})}render(e,t){var n,i;t.clearRect(0,0,1200,860);for(const o of e.points){const s=this.textures.get(o.type);let l=5;s?(l=s.height,t.drawImage(s,o.x-s.width/2,o.y-s.height/2)):(t.strokeStyle="#381d0a",t.beginPath(),t.rect(o.x,o.y,5,5),t.stroke()),"name"in o&&((n=this.nameOptions.get(o.type))!=null&&n.render)&&(t.filter="blur(2px)",t.textAlign="center",t.fillStyle="white",t.font=`${(i=this.nameOptions.get(o.type))==null?void 0:i.fontSize}px Eczar`,t.fillText(new String(o.name).toString(),o.x,o.y+l),t.filter="none",t.fillStyle="#381d0a",t.fillText(new String(o.name).toString(),o.x,o.y+l))}}}class ze{constructor(e,t,n){this.canvas=e,this.context=t,this.dirtyRect=n}getPixelAt(e,t){const n=e*this.context.zoomMultiplier+this.context.pan.x,i=t*this.context.zoomMultiplier+this.context.pan.y;if(e>=0&&e<1200&&t>=0&&t<860){const o=this.canvas.getImageData(n,i,1,1);return{r:o.data[0],g:o.data[1],b:o.data[2],a:o.data[3]}}else return{r:0,g:0,b:0,a:0}}createPattern(e,t){return this.canvas.createPattern(e,t)}clearRect(e,t,n,i){this.canvas.clearRect(e,t,n,i)}beginPath(){this.canvas.beginPath()}moveTo(e,t){this.canvas.moveTo(e*this.context.zoomMultiplier+this.context.pan.x,t*this.context.zoomMultiplier+this.context.pan.y)}lineTo(e,t){this.canvas.lineTo(e*this.context.zoomMultiplier+this.context.pan.x,t*this.context.zoomMultiplier+this.context.pan.y)}quadraticCurveTo(e,t,n,i){this.canvas.quadraticCurveTo(e*this.context.zoomMultiplier+this.context.pan.x,t*this.context.zoomMultiplier+this.context.pan.y,n*this.context.zoomMultiplier+this.context.pan.x,i*this.context.zoomMultiplier+this.context.pan.y)}setLineDash(e){this.canvas.setLineDash(e)}closePath(){this.canvas.closePath()}stroke(){this.canvas.stroke()}fill(e){this.canvas.fill(e)}rect(e,t,n,i){return this.canvas.rect(e*this.context.zoomMultiplier+this.context.pan.x,t*this.context.zoomMultiplier+this.context.pan.y,n*this.context.zoomMultiplier,i*this.context.zoomMultiplier)}strokeRect(e,t,n,i){return this.canvas.strokeRect(e*this.context.zoomMultiplier+this.context.pan.x,t*this.context.zoomMultiplier+this.context.pan.y,n*this.context.zoomMultiplier,i*this.context.zoomMultiplier)}arc(e,t,n,i,o,s){this.canvas.arc(e*this.context.zoomMultiplier+this.context.pan.x,t*this.context.zoomMultiplier+this.context.pan.y,n*this.context.zoomMultiplier,i,o,s)}fillText(e,t,n,i){this.canvas.fillText(e,t*this.context.zoomMultiplier+this.context.pan.x,n*this.context.zoomMultiplier+this.context.pan.y,i)}getImageData(e,t,n,i){return this.canvas.getImageData(e*this.context.zoomMultiplier+this.context.pan.x,t*this.context.zoomMultiplier+this.context.pan.y,n*this.context.zoomMultiplier,i*this.context.zoomMultiplier)}drawImage(e,t,n){this.canvas.drawImage(e,t*this.context.zoomMultiplier+this.context.pan.x,n*this.context.zoomMultiplier+this.context.pan.y)}set fillStyle(e){this.canvas.fillStyle=e}set strokeStyle(e){this.canvas.strokeStyle=e}set filter(e){this.canvas.filter=e}set lineWidth(e){this.canvas.lineWidth=e}set textAlign(e){this.canvas.textAlign=e}set font(e){this.canvas.font=e}set lineCap(e){this.canvas.lineCap=e}}class Pn{constructor(){P(this,"offsets");P(this,"stampSize",[14,16]);P(this,"spacing",10)}async preload(){}render(e,t){this.offsets||(this.offsets=this.computeOffsets()),t.clearRect(0,0,1200,860),t.filter="blur(4px)",this.drawVector(e,t),t.filter="none",this.drawStamps(e,t)}drawVector(e,t){for(const n of e.features){t.beginPath();for(let i=0;i<n.vector.polygons.length;i++){const o=n.vector.polygons[i];t.moveTo(o.nodes[0][0],o.nodes[0][1]);for(let s=1;s<o.nodes.length;s++)t.lineTo(o.nodes[s][0],o.nodes[s][1])}t.strokeStyle="#381d0a30",t.fillStyle="#381d0a40",t.fill("evenodd"),t.stroke()}}drawStamps(e,t){const n=[];for(let i=0;i<1200/this.spacing;i++)for(let o=0;o<860/this.spacing;o++){const s=this.offsets[i][o];if(!s)continue;const l=[Math.round(i*this.spacing+s[0]),Math.round(o*this.spacing+s[1])];t.getPixelAt(l[0],l[1]).a>=32&&n.push([l[0]-this.stampSize[0]/2,l[1]-this.stampSize[1]/2])}for(const i of n)t.drawImage(ee.tree,i[0],i[1])}computeOffsets(){const e=[];for(let t=0;t<1200/this.spacing;t++){e.push([]);for(let n=0;n<860/this.spacing;n++)e[t][n]=[Math.random()*this.spacing*.7,Math.random()*this.spacing*.7]}return e}}class In{constructor(){P(this,"grassPattern")}async preload(){}render(e,t){if(!this.grassPattern){const n=t.createPattern(ee.grass,"repeat");n&&(this.grassPattern=n)}t.fillStyle=this.grassPattern||"#003000FF",t.clearRect(0,0,1200,860),t.beginPath();for(let n=0;n<e.terrain.vector.polygons.length;n++){const i=e.terrain.vector.polygons[n];t.moveTo(i.nodes[0][0],i.nodes[0][1]);for(let o=1;o<i.nodes.length;o++)t.lineTo(i.nodes[o][0],i.nodes[o][1]);t.closePath()}t.strokeStyle="#FFFFFF30",t.filter="blur(8px)",t.lineWidth=32,t.stroke(),t.filter="none",t.fill("evenodd"),t.strokeStyle="#381d0a30",t.lineWidth=3,t.stroke();for(let n=0;n<e.terrain.vector.unoptimizedUnionVectors.length;n++){const i=e.terrain.vector.unoptimizedUnionVectors[n];t.beginPath();for(let o=0;o<i.polygons.length;o++){const s=i.polygons[o];t.moveTo(s.nodes[0][0],s.nodes[0][1]);for(let l=1;l<s.nodes.length;l++)t.lineTo(s.nodes[l][0],s.nodes[l][1])}t.fill("evenodd")}}}const me={background:0,terrain:1,terrainFeatures:2,paths:3,points:4,tool:5};class zn{constructor(){P(this,"terrainRenderer");P(this,"terrainFeatureRenderer");P(this,"pointRenderer");P(this,"pathRenderer",new It);this.terrainRenderer=new In,this.terrainFeatureRenderer=new Pn,this.pointRenderer=new Sn,!(typeof document>"u")&&(setTimeout(()=>this.terrainRenderer.preload(),100),setTimeout(()=>this.terrainFeatureRenderer.preload(),100),setTimeout(()=>this.pointRenderer.preload(),100))}renderBackground(e,t,n){K.timerStart("Render Background");const i=t.createPattern(ee.water,"repeat");i&&(t.fillStyle=i,t.fillRect(n.x,n.y,n.width,n.height)),K.timerEnd("Render Background")}renderTerrain(e,t,n,i){K.timerStart("Render Terrain"),this.terrainRenderer.render(e,new ze(t,n,i)),K.timerEnd("Render Terrain")}renderTerrainFeatures(e,t,n,i){K.timerStart("Render Terrain Features"),this.terrainFeatureRenderer.render(e,new ze(t,n,i)),K.timerEnd("Render Terrain Features")}renderPoints(e,t,n,i){K.timerStart("Render Points"),this.pointRenderer.render(e,new ze(t,n,i)),K.timerEnd("Render Points")}renderPaths(e,t,n,i){K.timerStart("Render Paths"),this.pathRenderer.render(e,new ze(t,n,i)),K.timerEnd("Render Paths")}renderTool(e,t,n,i,o,s,l){i.clearRect(0,0,1200,860),e.render(t,n,new ze(i,o,s),l)}}function Cn(r){let e,t,n,i,o,s=r[0]*100+"",l,c,a,f,d;return{c(){e=M("div"),t=M("div"),n=M("div"),i=N(),o=M("span"),l=de(s),c=de("%"),a=N(),f=M("span"),d=de(r[1]),this.h()},l(v){e=S(v,"DIV",{class:!0});var u=J(e);t=S(u,"DIV",{class:!0});var h=J(t);n=S(h,"DIV",{class:!0,style:!0}),J(n).forEach(b),i=O(h),o=S(h,"SPAN",{class:!0});var p=J(o);l=ve(p,s),c=ve(p,"%"),p.forEach(b),h.forEach(b),a=O(u),f=S(u,"SPAN",{});var m=J(f);d=ve(m,r[1]),m.forEach(b),u.forEach(b),this.h()},h(){g(n,"class","progress-complete svelte-caggyw"),Je(n,"width",r[0]*100+"%"),g(o,"class","svelte-caggyw"),g(t,"class","progress svelte-caggyw"),g(e,"class","loading svelte-caggyw")},m(v,u){C(v,e,u),x(e,t),x(t,n),x(t,i),x(t,o),x(o,l),x(o,c),x(e,a),x(e,f),x(f,d)},p(v,[u]){u&1&&Je(n,"width",v[0]*100+"%"),u&1&&s!==(s=v[0]*100+"")&&Fe(l,s),u&2&&Fe(d,v[1])},i:ye,o:ye,d(v){v&&b(e)}}}function Fn(r,e,t){let{progress:n=0}=e,{message:i="Loading"}=e;return r.$$set=o=>{"progress"in o&&t(0,n=o.progress),"message"in o&&t(1,i=o.message)},[n,i]}class Rn extends Ne{constructor(e){super(),Oe(this,e,Fn,Cn,Re,{progress:0,message:1})}}function ut(r,e,t){const n=r.slice();return n[7]=e[t],n}function ht(r){let e,t;return e=new Rn({props:{progress:r[0].progress,message:r[0].message}}),{c(){Ae(e.$$.fragment)},l(n){De(e.$$.fragment,n)},m(n,i){Be(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.progress=n[0].progress),i&1&&(o.message=n[0].message),e.$set(o)},i(n){t||(ge(e.$$.fragment,n),t=!0)},o(n){ke(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function pt(r){let e;return{c(){e=M("canvas"),this.h()},l(t){e=S(t,"CANVAS",{id:!0,width:!0,height:!0,style:!0,class:!0}),J(e).forEach(b),this.h()},h(){g(e,"id","layer-"+r[7]),g(e,"width","1200"),g(e,"height","860"),Je(e,"border","1px solid #000000"),g(e,"class","svelte-1cguo7c")},m(t,n){C(t,e,n)},p:ye,d(t){t&&b(e)}}}function Nn(r){let e,t,n,i=r[0]&&ht(r),o=be(Object.values(me)),s=[];for(let l=0;l<o.length;l+=1)s[l]=pt(ut(r,o,l));return{c(){i&&i.c(),e=N(),t=M("div");for(let l=0;l<s.length;l+=1)s[l].c();this.h()},l(l){i&&i.l(l),e=O(l),t=S(l,"DIV",{class:!0});var c=J(t);for(let a=0;a<s.length;a+=1)s[a].l(c);c.forEach(b),this.h()},h(){g(t,"class","canvas-container svelte-1cguo7c")},m(l,c){i&&i.m(l,c),C(l,e,c),C(l,t,c);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(t,null);n=!0},p(l,[c]){if(l[0]?i?(i.p(l,c),c&1&&ge(i,1)):(i=ht(l),i.c(),ge(i,1),i.m(e.parentNode,e)):i&&(At(),ke(i,1,1,()=>{i=null}),Dt()),c&0){o=be(Object.values(me));let a;for(a=0;a<o.length;a+=1){const f=ut(l,o,a);s[a]?s[a].p(f,c):(s[a]=pt(f),s[a].c(),s[a].m(t,null))}for(;a<s.length;a+=1)s[a].d(1);s.length=o.length}},i(l){n||(ge(i),n=!0)},o(l){ke(i),n=!1},d(l){l&&(b(e),b(t)),i&&i.d(l),tt(s,l)}}}function On(r,e,t){const n=et();let{model:i}=e;const o=new zn;let s=[],l={progress:0,message:"Initializing"};Rt(async()=>{await ee.preload((p,m)=>t(0,l={progress:p,message:m})),t(0,l=void 0);const f=Array.from(document.querySelectorAll("canvas"));s=f.map(p=>p.getContext("2d"));const d=f[f.length-1];c(),o.renderBackground(i,s[0],new j(0,0,1200,860));let v={x:0,y:0};function u(p){const m=we(pe),y=p.clientX-(d.offsetLeft??0),k=p.clientY-(d.offsetTop??0);return{screenX:y,screenY:k,x:(y-m.pan.x)/m.zoomMultiplier,y:(k-m.pan.y)/m.zoomMultiplier}}d.addEventListener("mousedown",p=>{p.buttons===1&&(n("click",u(p)),n("pressDown",u(p))),p.buttons===4&&(v={x:p.clientX-(d.offsetLeft??0),y:p.clientY-(d.offsetTop??0)})}),d.addEventListener("mousemove",p=>{p.buttons===1&&n("pressDown",u(p)),p.buttons===4&&(pe.update(m=>{const y=m.pan.x+(p.clientX-(d.offsetLeft??0)-v.x),k=m.pan.y+(p.clientY-(d.offsetTop??0)-v.y);return m.pan={x:Math.min(0,Math.max(-1200,y)),y:Math.min(0,Math.max(-860,k))},m}),v={x:p.clientX-(d.offsetLeft??0),y:p.clientY-(d.offsetTop??0)}),n("move",u(p))}),d.addEventListener("mouseup",p=>{n("release",u(p))});const h=[.25,.5,1,1.5,2,3,4];d.addEventListener("wheel",p=>(p.deltaY>0?pe.update(m=>{const y=m.zoomMultiplier;return m.zoomLevel=Math.max(0,m.zoomLevel-1),m.zoomMultiplier=h[m.zoomLevel],m.zoomMultiplier/y,m}):pe.update(m=>{const y=m.zoomMultiplier;return m.zoomLevel=Math.min(h.length,m.zoomLevel+1),m.zoomMultiplier=h[m.zoomLevel],m.zoomMultiplier/y,m}),!1))}),pe.subscribe(f=>{l||c()});function c(f){const d=we(pe),v=f??new j(0,0,1200,860);o.renderTerrain(i,s[me.terrain],d,v),o.renderTerrainFeatures(i,s[me.terrainFeatures],d,v),o.renderPoints(i,s[me.points],d,v),o.renderPaths(i,s[me.paths],d,v)}function a(f,d,v){const u=we(pe);o.renderTool(f,d,v,s[me.tool],u,new j(0,0,1200,860),i)}return r.$$set=f=>{"model"in f&&t(1,i=f.model)},[l,i,c,a]}class En extends Ne{constructor(e){super(),Oe(this,e,On,Nn,Re,{model:1,render:2,renderTool:3})}get render(){return this.$$.ctx[2]}get renderTool(){return this.$$.ctx[3]}}function mt(r,e,t){const n=r.slice();return n[11]=e[t],n[12]=e,n[13]=t,n}function dt(r,e,t){const n=r.slice();return n[14]=e[t],n}function vt(r){let e,t="Tool options",n,i,o=be(r[0].getOptions()),s=[];for(let l=0;l<o.length;l+=1)s[l]=bt(mt(r,o,l));return{c(){e=M("h2"),e.textContent=t,n=N();for(let l=0;l<s.length;l+=1)s[l].c();i=ce(),this.h()},l(l){e=S(l,"H2",{class:!0,"data-svelte-h":!0}),ne(e)!=="svelte-sit87u"&&(e.textContent=t),n=O(l);for(let c=0;c<s.length;c+=1)s[c].l(l);i=ce(),this.h()},h(){g(e,"class","svelte-12rgorr")},m(l,c){C(l,e,c),C(l,n,c);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(l,c);C(l,i,c)},p(l,c){if(c&3){o=be(l[0].getOptions());let a;for(a=0;a<o.length;a+=1){const f=mt(l,o,a);s[a]?s[a].p(f,c):(s[a]=bt(f),s[a].c(),s[a].m(i.parentNode,i))}for(;a<s.length;a+=1)s[a].d(1);s.length=o.length}},d(l){l&&(b(e),b(n),b(i)),tt(s,l)}}}function gt(r){let e,t,n,i,o,s;function l(){r[5].call(e,r[11])}let c="min"in r[11]&&yt(r);return{c(){e=M("input"),n=N(),c&&c.c(),i=ce(),this.h()},l(a){e=S(a,"INPUT",{name:!0,type:!0,class:!0}),n=O(a),c&&c.l(a),i=ce(),this.h()},h(){g(e,"name",t=r[11].key),g(e,"type","number"),g(e,"class","svelte-12rgorr")},m(a,f){C(a,e,f),fe(e,r[1][r[11].key]),C(a,n,f),c&&c.m(a,f),C(a,i,f),o||(s=q(e,"input",l),o=!0)},p(a,f){r=a,f&1&&t!==(t=r[11].key)&&g(e,"name",t),f&3&&Xe(e.value)!==r[1][r[11].key]&&fe(e,r[1][r[11].key]),"min"in r[11]?c?c.p(r,f):(c=yt(r),c.c(),c.m(i.parentNode,i)):c&&(c.d(1),c=null)},d(a){a&&(b(e),b(n),b(i)),c&&c.d(a),o=!1,s()}}}function yt(r){let e,t,n,i,o,s,l;function c(){r[6].call(e,r[11])}return{c(){e=M("input"),this.h()},l(a){e=S(a,"INPUT",{name:!0,type:!0,min:!0,max:!0,step:!0,class:!0}),this.h()},h(){g(e,"name",t=r[11].key),g(e,"type","range"),g(e,"min",n=r[11].min),g(e,"max",i=r[11].max),g(e,"step",o=r[11].step),g(e,"class","svelte-12rgorr")},m(a,f){C(a,e,f),fe(e,r[1][r[11].key]),s||(l=[q(e,"change",c),q(e,"input",c)],s=!0)},p(a,f){r=a,f&1&&t!==(t=r[11].key)&&g(e,"name",t),f&1&&n!==(n=r[11].min)&&g(e,"min",n),f&1&&i!==(i=r[11].max)&&g(e,"max",i),f&1&&o!==(o=r[11].step)&&g(e,"step",o),f&3&&fe(e,r[1][r[11].key])},d(a){a&&b(e),s=!1,$e(l)}}}function _t(r){let e,t,n,i;function o(){r[7].call(e,r[11])}return{c(){e=M("input"),this.h()},l(s){e=S(s,"INPUT",{name:!0,type:!0,class:!0}),this.h()},h(){g(e,"name",t=r[11].key),g(e,"type","checkbox"),g(e,"class","svelte-12rgorr")},m(s,l){C(s,e,l),e.checked=r[1][r[11].key],n||(i=q(e,"change",o),n=!0)},p(s,l){r=s,l&1&&t!==(t=r[11].key)&&g(e,"name",t),l&3&&(e.checked=r[1][r[11].key])},d(s){s&&b(e),n=!1,i()}}}function wt(r){let e,t,n,i,o=be(r[11].options),s=[];for(let c=0;c<o.length;c+=1)s[c]=kt(dt(r,o,c));function l(){r[8].call(e,r[11])}return{c(){e=M("select");for(let c=0;c<s.length;c+=1)s[c].c();this.h()},l(c){e=S(c,"SELECT",{name:!0,class:!0});var a=J(e);for(let f=0;f<s.length;f+=1)s[f].l(a);a.forEach(b),this.h()},h(){g(e,"name",t=r[11].key),g(e,"class","svelte-12rgorr"),r[1][r[11].key]===void 0&&Ot(l)},m(c,a){C(c,e,a);for(let f=0;f<s.length;f+=1)s[f]&&s[f].m(e,null);it(e,r[1][r[11].key],!0),n||(i=q(e,"change",l),n=!0)},p(c,a){if(r=c,a&1){o=be(r[11].options);let f;for(f=0;f<o.length;f+=1){const d=dt(r,o,f);s[f]?s[f].p(d,a):(s[f]=kt(d),s[f].c(),s[f].m(e,null))}for(;f<s.length;f+=1)s[f].d(1);s.length=o.length}a&1&&t!==(t=r[11].key)&&g(e,"name",t),a&3&&it(e,r[1][r[11].key])},d(c){c&&b(e),tt(s,c),n=!1,i()}}}function kt(r){let e,t=r[14].label+"",n,i;return{c(){e=M("option"),n=de(t),this.h()},l(o){e=S(o,"OPTION",{});var s=J(e);n=ve(s,t),s.forEach(b),this.h()},h(){e.__value=i=r[14].id,fe(e,e.__value)},m(o,s){C(o,e,s),x(e,n)},p(o,s){s&1&&t!==(t=o[14].label+"")&&Fe(n,t),s&1&&i!==(i=o[14].id)&&(e.__value=i,fe(e,e.__value))},d(o){o&&b(e)}}}function bt(r){let e,t,n=r[11].name+"",i,o,s,l,c,a,f=r[11].type==="number"&&gt(r),d=r[11].type==="boolean"&&_t(r),v=r[11].type==="enum"&&wt(r);return{c(){e=M("div"),t=M("label"),i=de(n),s=N(),f&&f.c(),l=N(),d&&d.c(),c=N(),v&&v.c(),a=N(),this.h()},l(u){e=S(u,"DIV",{class:!0});var h=J(e);t=S(h,"LABEL",{for:!0,class:!0});var p=J(t);i=ve(p,n),p.forEach(b),s=O(h),f&&f.l(h),l=O(h),d&&d.l(h),c=O(h),v&&v.l(h),a=O(h),h.forEach(b),this.h()},h(){g(t,"for",o=r[11].key),g(t,"class","svelte-12rgorr"),g(e,"class","option svelte-12rgorr")},m(u,h){C(u,e,h),x(e,t),x(t,i),x(e,s),f&&f.m(e,null),x(e,l),d&&d.m(e,null),x(e,c),v&&v.m(e,null),x(e,a)},p(u,h){h&1&&n!==(n=u[11].name+"")&&Fe(i,n),h&1&&o!==(o=u[11].key)&&g(t,"for",o),u[11].type==="number"?f?f.p(u,h):(f=gt(u),f.c(),f.m(e,l)):f&&(f.d(1),f=null),u[11].type==="boolean"?d?d.p(u,h):(d=_t(u),d.c(),d.m(e,c)):d&&(d.d(1),d=null),u[11].type==="enum"?v?v.p(u,h):(v=wt(u),v.c(),v.m(e,a)):v&&(v.d(1),v=null)},d(u){u&&b(e),f&&f.d(),d&&d.d(),v&&v.d()}}}function xt(r){let e,t,n=ft[r[2].type]+"",i,o,s,l="name"in r[2]&&Tt(r);return{c(){e=M("h2"),t=de("Selected: "),i=de(n),o=N(),l&&l.c(),s=ce(),this.h()},l(c){e=S(c,"H2",{class:!0});var a=J(e);t=ve(a,"Selected: "),i=ve(a,n),a.forEach(b),o=O(c),l&&l.l(c),s=ce(),this.h()},h(){g(e,"class","svelte-12rgorr")},m(c,a){C(c,e,a),x(e,t),x(e,i),C(c,o,a),l&&l.m(c,a),C(c,s,a)},p(c,a){a&4&&n!==(n=ft[c[2].type]+"")&&Fe(i,n),"name"in c[2]?l?l.p(c,a):(l=Tt(c),l.c(),l.m(s.parentNode,s)):l&&(l.d(1),l=null)},d(c){c&&(b(e),b(o),b(s)),l&&l.d(c)}}}function Tt(r){let e,t,n="Name",i,o,s,l;return{c(){e=M("div"),t=M("label"),t.textContent=n,i=N(),o=M("input"),this.h()},l(c){e=S(c,"DIV",{class:!0});var a=J(e);t=S(a,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),ne(t)!=="svelte-bs9sy6"&&(t.textContent=n),i=O(a),o=S(a,"INPUT",{name:!0,type:!0,class:!0}),a.forEach(b),this.h()},h(){g(t,"for","name"),g(t,"class","svelte-12rgorr"),g(o,"name","name"),g(o,"type","text"),g(o,"class","svelte-12rgorr"),g(e,"class","option svelte-12rgorr")},m(c,a){C(c,e,a),x(e,t),x(e,i),x(e,o),fe(o,r[2].name),s||(l=[q(o,"input",r[9]),q(o,"change",r[10])],s=!0)},p(c,a){a&4&&o.value!==c[2].name&&fe(o,c[2].name)},d(c){c&&b(e),s=!1,$e(l)}}}function An(r){let e,t,n=r[0]&&vt(r),i=r[2]!==void 0&&xt(r);return{c(){n&&n.c(),e=N(),i&&i.c(),t=ce()},l(o){n&&n.l(o),e=O(o),i&&i.l(o),t=ce()},m(o,s){n&&n.m(o,s),C(o,e,s),i&&i.m(o,s),C(o,t,s)},p(o,[s]){o[0]?n?n.p(o,s):(n=vt(o),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null),o[2]!==void 0?i?i.p(o,s):(i=xt(o),i.c(),i.m(t.parentNode,t)):i&&(i.d(1),i=null)},i:ye,o:ye,d(o){o&&(b(e),b(t)),n&&n.d(o),i&&i.d(o)}}}function Dn(r,e,t){const n=et();let i;ae.subscribe(h=>{t(2,i=h)});let{selectedTool:o}=e,s;const l={};function c(h){l[h.key]=Xe(this.value),t(1,l),t(0,o),t(4,s),t(0,o)}function a(h){l[h.key]=Xe(this.value),t(1,l),t(0,o),t(4,s),t(0,o)}function f(h){l[h.key]=this.checked,t(1,l),t(0,o),t(4,s),t(0,o)}function d(h){l[h.key]=Nt(this),t(1,l),t(0,o),t(4,s),t(0,o)}function v(){i.name=this.value,t(2,i)}const u=()=>n("render");return r.$$set=h=>{"selectedTool"in h&&t(0,o=h.selectedTool)},r.$$.update=()=>{if(r.$$.dirty&19){if(t(4,s=o==null?void 0:o.getOptions()),s){t(4,s=o.getOptions());for(const h of s)"default"in h&&t(1,l[h.key]=l[h.key]??h.default,l)}n("optionsChanged",l)}r.$$.dirty&2&&n("optionsChanged",l)},[o,l,i,n,s,c,a,f,d,v,u]}class Bn extends Ne{constructor(e){super(),Oe(this,e,Dn,An,Re,{selectedTool:0})}}function jn(r){let e,t,n,i,o,s,l;e=new Mn({props:{model:r[3]}}),e.$on("toolSelected",r[9]),e.$on("modelReplaced",r[8]);let c={model:r[3]};return n=new En({props:c}),r[10](n),n.$on("click",r[4]),n.$on("pressDown",r[5]),n.$on("move",r[6]),n.$on("release",r[7]),s=new Bn({props:{selectedTool:r[0]}}),s.$on("optionsChanged",r[11]),s.$on("render",r[12]),{c(){Ae(e.$$.fragment),t=N(),Ae(n.$$.fragment),i=N(),o=M("div"),Ae(s.$$.fragment),this.h()},l(a){De(e.$$.fragment,a),t=O(a),De(n.$$.fragment,a),i=O(a),o=S(a,"DIV",{class:!0});var f=J(o);De(s.$$.fragment,f),f.forEach(b),this.h()},h(){g(o,"class","sidebar svelte-1qhawc6")},m(a,f){Be(e,a,f),C(a,t,f),Be(n,a,f),C(a,i,f),C(a,o,f),Be(s,o,null),l=!0},p(a,[f]){const d={};f&8&&(d.model=a[3]),e.$set(d);const v={};f&8&&(v.model=a[3]),n.$set(v);const u={};f&1&&(u.selectedTool=a[0]),s.$set(u)},i(a){l||(ge(e.$$.fragment,a),ge(n.$$.fragment,a),ge(s.$$.fragment,a),l=!0)},o(a){ke(e.$$.fragment,a),ke(n.$$.fragment,a),ke(s.$$.fragment,a),l=!1},d(a){a&&(b(t),b(i),b(o)),je(e,a),r[10](null),je(n,a),je(s)}}}function Un(r,e,t){let n,i={},o,s=new Ze;function l(m){let y=n.click(m.detail,s,i);o.render(y)}function c(m){let y=n.pressDown(m.detail,s,i);o.render(y),o.renderTool(n,[m.detail.x,m.detail.y],i)}function a(m){o.renderTool(n,[m.detail.x,m.detail.y],i)}function f(m){let y=n.release(m.detail,s,i);o.render(y)}function d(m){t(3,s=m.detail),setTimeout(()=>{o.render(void 0)})}_e.register({key:"Delete"},()=>{const m=we(ae);m&&(t(3,s.points=s.points.filter(y=>y!==m),s),ae.set(void 0),o.render(void 0),o.renderTool(n,[-1,-1],i))});const v=m=>t(0,n=m.detail);function u(m){Et[m?"unshift":"push"](()=>{o=m,t(2,o)})}return[n,i,o,s,l,c,a,f,d,v,u,m=>t(1,i=m.detail),()=>o.render(void 0)]}class Yn extends Ne{constructor(e){super(),Oe(this,e,Un,jn,Re,{})}}export{Yn as component};
