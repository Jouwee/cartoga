var st=Object.defineProperty;var it=(r,t,e)=>t in r?st(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var N=(r,t,e)=>(it(r,typeof t!="symbol"?t+"":t,e),e);import{s as _e,f as R,a as U,g as M,h as $,A as re,c as j,d as P,j as T,B as Q,i as B,x as F,C as Y,y as ie,D as Ce,E as Ne,F as Re,o as ot,k as lt,e as oe,l as Me,m as Ae,n as Le,G as te,H as xe,I as at,J as ft,K as ze,p as $e,L as ct}from"../chunks/scheduler.cf9d4a9b.js";import{S as ye,i as we,f as ut,b as Se,d as be,m as Pe,a as Fe,t as Oe,e as Ie}from"../chunks/index.b20454c5.js";function le(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function ht(){var r,t=0,e=!1;function n(s,i){return r.list.push({type:s,data:i?JSON.parse(JSON.stringify(i)):void 0}),r}return r={list:[],segmentId:function(){return t++},checkIntersection:function(s,i){return n("check",{seg1:s,seg2:i})},segmentChop:function(s,i){return n("div_seg",{seg:s,pt:i}),n("chop",{seg:s,pt:i})},statusRemove:function(s){return n("pop_seg",{seg:s})},segmentUpdate:function(s){return n("seg_update",{seg:s})},segmentNew:function(s,i){return n("new_seg",{seg:s,primary:i})},segmentRemove:function(s){return n("rem_seg",{seg:s})},tempStatus:function(s,i,o){return n("temp_status",{seg:s,above:i,below:o})},rewind:function(s){return n("rewind",{seg:s})},status:function(s,i,o){return n("status",{seg:s,above:i,below:o})},vert:function(s){return s===e?r:(e=s,n("vert",{x:s}))},log:function(s){return typeof s!="string"&&(s=JSON.stringify(s,!1,"  ")),n("log",{txt:s})},reset:function(){return n("reset")},selected:function(s){return n("selected",{segs:s})},chainStart:function(s){return n("chain_start",{seg:s})},chainRemoveHead:function(s,i){return n("chain_rem_head",{index:s,pt:i})},chainRemoveTail:function(s,i){return n("chain_rem_tail",{index:s,pt:i})},chainNew:function(s,i){return n("chain_new",{pt1:s,pt2:i})},chainMatch:function(s){return n("chain_match",{index:s})},chainClose:function(s){return n("chain_close",{index:s})},chainAddHead:function(s,i){return n("chain_add_head",{index:s,pt:i})},chainAddTail:function(s,i){return n("chain_add_tail",{index:s,pt:i})},chainConnect:function(s,i){return n("chain_con",{index1:s,index2:i})},chainReverse:function(s){return n("chain_rev",{index:s})},chainJoin:function(s,i){return n("chain_join",{index1:s,index2:i})},done:function(){return n("done")}},r}var mt=ht;function pt(r){typeof r!="number"&&(r=1e-10);var t={epsilon:function(e){return typeof e=="number"&&(r=e),r},pointAboveOrOnLine:function(e,n,s){var i=n[0],o=n[1],l=s[0],a=s[1],h=e[0],f=e[1];return(l-i)*(f-o)-(a-o)*(h-i)>=-r},pointBetween:function(e,n,s){var i=e[1]-n[1],o=s[0]-n[0],l=e[0]-n[0],a=s[1]-n[1],h=l*o+i*a;if(h<r)return!1;var f=o*o+a*a;return!(h-f>-r)},pointsSameX:function(e,n){return Math.abs(e[0]-n[0])<r},pointsSameY:function(e,n){return Math.abs(e[1]-n[1])<r},pointsSame:function(e,n){return t.pointsSameX(e,n)&&t.pointsSameY(e,n)},pointsCompare:function(e,n){return t.pointsSameX(e,n)?t.pointsSameY(e,n)?0:e[1]<n[1]?-1:1:e[0]<n[0]?-1:1},pointsCollinear:function(e,n,s){var i=e[0]-n[0],o=e[1]-n[1],l=n[0]-s[0],a=n[1]-s[1];return Math.abs(i*a-l*o)<r},linesIntersect:function(e,n,s,i){var o=n[0]-e[0],l=n[1]-e[1],a=i[0]-s[0],h=i[1]-s[1],f=o*h-l*a;if(Math.abs(f)<r)return!1;var m=e[0]-s[0],d=e[1]-s[1],c=(a*d-h*m)/f,u=(o*d-l*m)/f,p={alongA:0,alongB:0,pt:[e[0]+c*o,e[1]+c*l]};return c<=-r?p.alongA=-2:c<r?p.alongA=-1:c-1<=-r?p.alongA=0:c-1<r?p.alongA=1:p.alongA=2,u<=-r?p.alongB=-2:u<r?p.alongB=-1:u-1<=-r?p.alongB=0:u-1<r?p.alongB=1:p.alongB=2,p},pointInsideRegion:function(e,n){for(var s=e[0],i=e[1],o=n[n.length-1][0],l=n[n.length-1][1],a=!1,h=0;h<n.length;h++){var f=n[h][0],m=n[h][1];m-i>r!=l-i>r&&(o-f)*(i-m)/(l-m)+f-s>r&&(a=!a),o=f,l=m}return a}};return t}var dt=pt,vt={create:function(){var r={root:{root:!0,next:null},exists:function(t){return!(t===null||t===r.root)},isEmpty:function(){return r.root.next===null},getHead:function(){return r.root.next},insertBefore:function(t,e){for(var n=r.root,s=r.root.next;s!==null;){if(e(s)){t.prev=s.prev,t.next=s,s.prev.next=t,s.prev=t;return}n=s,s=s.next}n.next=t,t.prev=n,t.next=null},findTransition:function(t){for(var e=r.root,n=r.root.next;n!==null&&!t(n);)e=n,n=n.next;return{before:e===r.root?null:e,after:n,insert:function(s){return s.prev=e,s.next=n,e.next=s,n!==null&&(n.prev=s),s}}}};return r},node:function(r){return r.prev=null,r.next=null,r.remove=function(){r.prev.next=r.next,r.next&&(r.next.prev=r.prev),r.prev=null,r.next=null},r}},gt=vt,ae=gt;function _t(r,t,e){function n(u,p){return{id:e?e.segmentId():-1,start:u,end:p,myFill:{above:null,below:null},otherFill:null}}function s(u,p,v){return{id:e?e.segmentId():-1,start:u,end:p,myFill:{above:v.myFill.above,below:v.myFill.below},otherFill:null}}var i=ae.create();function o(u,p,v,k,y,w){var E=t.pointsCompare(p,y);return E!==0?E:t.pointsSame(v,w)?0:u!==k?u?1:-1:t.pointAboveOrOnLine(v,k?y:w,k?w:y)?1:-1}function l(u,p){i.insertBefore(u,function(v){var k=o(u.isStart,u.pt,p,v.isStart,v.pt,v.other.pt);return k<0})}function a(u,p){var v=ae.node({isStart:!0,pt:u.start,seg:u,primary:p,other:null,status:null});return l(v,u.end),v}function h(u,p,v){var k=ae.node({isStart:!1,pt:p.end,seg:p,primary:v,other:u,status:null});u.other=k,l(k,u.pt)}function f(u,p){var v=a(u,p);return h(v,u,p),v}function m(u,p){e&&e.segmentChop(u.seg,p),u.other.remove(),u.seg.end=p,u.other.pt=p,l(u.other,u.pt)}function d(u,p){var v=s(p,u.seg.end,u.seg);return m(u,p),f(v,u.primary)}function c(u,p){var v=ae.create();function k(x,C){var X=x.seg.start,L=x.seg.end,z=C.seg.start,V=C.seg.end;return t.pointsCollinear(X,z,V)?t.pointsCollinear(L,z,V)||t.pointAboveOrOnLine(L,z,V)?1:-1:t.pointAboveOrOnLine(X,z,V)?1:-1}function y(x){return v.findTransition(function(C){var X=k(x,C.ev);return X>0})}function w(x,C){var X=x.seg,L=C.seg,z=X.start,V=X.end,ne=L.start,ee=L.end;e&&e.checkIntersection(X,L);var Z=t.linesIntersect(z,V,ne,ee);if(Z===!1){if(!t.pointsCollinear(z,V,ne)||t.pointsSame(z,ee)||t.pointsSame(V,ne))return!1;var ke=t.pointsSame(z,ne),Te=t.pointsSame(V,ee);if(ke&&Te)return C;var rt=!ke&&t.pointBetween(z,ne,ee),Be=!Te&&t.pointBetween(V,ne,ee);if(ke)return Be?d(C,V):d(x,ee),C;rt&&(Te||(Be?d(C,V):d(x,ee)),d(C,z))}else Z.alongA===0&&(Z.alongB===-1?d(x,ne):Z.alongB===0?d(x,Z.pt):Z.alongB===1&&d(x,ee)),Z.alongB===0&&(Z.alongA===-1?d(C,z):Z.alongA===0?d(C,Z.pt):Z.alongA===1&&d(C,V));return!1}for(var E=[];!i.isEmpty();){var g=i.getHead();if(e&&e.vert(g.pt[0]),g.isStart){let x=function(){if(I){var C=w(g,I);if(C)return C}return O?w(g,O):!1};e&&e.segmentNew(g.seg,g.primary);var b=y(g),I=b.before?b.before.ev:null,O=b.after?b.after.ev:null;e&&e.tempStatus(g.seg,I?I.seg:!1,O?O.seg:!1);var _=x();if(_){if(r){var S;g.seg.myFill.below===null?S=!0:S=g.seg.myFill.above!==g.seg.myFill.below,S&&(_.seg.myFill.above=!_.seg.myFill.above)}else _.seg.otherFill=g.seg.myFill;e&&e.segmentUpdate(_.seg),g.other.remove(),g.remove()}if(i.getHead()!==g){e&&e.rewind(g.seg);continue}if(r){var S;g.seg.myFill.below===null?S=!0:S=g.seg.myFill.above!==g.seg.myFill.below,O?g.seg.myFill.below=O.seg.myFill.above:g.seg.myFill.below=u,S?g.seg.myFill.above=!g.seg.myFill.below:g.seg.myFill.above=g.seg.myFill.below}else if(g.seg.otherFill===null){var J;O?g.primary===O.primary?J=O.seg.otherFill.above:J=O.seg.myFill.above:J=g.primary?p:u,g.seg.otherFill={above:J,below:J}}e&&e.status(g.seg,I?I.seg:!1,O?O.seg:!1),g.other.status=b.insert(ae.node({ev:g}))}else{var A=g.status;if(A===null)throw new Error("PolyBool: Zero-length segment detected; your epsilon is probably too small or too large");if(v.exists(A.prev)&&v.exists(A.next)&&w(A.prev.ev,A.next.ev),e&&e.statusRemove(A.ev.seg),A.remove(),!g.primary){var K=g.seg.myFill;g.seg.myFill=g.seg.otherFill,g.seg.otherFill=K}E.push(g.seg)}i.getHead().remove()}return e&&e.done(),E}return r?{addRegion:function(u){for(var p,v=u[u.length-1],k=0;k<u.length;k++){p=v,v=u[k];var y=t.pointsCompare(p,v);y!==0&&f(n(y<0?p:v,y<0?v:p),!0)}},calculate:function(u){return c(u,!1)}}:{calculate:function(u,p,v,k){return u.forEach(function(y){f(s(y.start,y.end,y),!0)}),v.forEach(function(y){f(s(y.start,y.end,y),!1)}),c(p,k)}}}var yt=_t;function wt(r,t,e){var n=[],s=[];return r.forEach(function(i){var o=i.start,l=i.end;if(t.pointsSame(o,l)){console.warn("PolyBool: Warning: Zero-length segment detected; your epsilon is probably too small or too large");return}e&&e.chainStart(i);var a={index:0,matches_head:!1,matches_pt1:!1},h={index:0,matches_head:!1,matches_pt1:!1},f=a;function m(A,K,x){return f.index=A,f.matches_head=K,f.matches_pt1=x,f===a?(f=h,!1):(f=null,!0)}for(var d=0;d<n.length;d++){var c=n[d],u=c[0];c[1];var p=c[c.length-1];if(c[c.length-2],t.pointsSame(u,o)){if(m(d,!0,!0))break}else if(t.pointsSame(u,l)){if(m(d,!0,!1))break}else if(t.pointsSame(p,o)){if(m(d,!1,!0))break}else if(t.pointsSame(p,l)&&m(d,!1,!1))break}if(f===a){n.push([o,l]),e&&e.chainNew(o,l);return}if(f===h){e&&e.chainMatch(a.index);var v=a.index,k=a.matches_pt1?l:o,y=a.matches_head,c=n[v],w=y?c[0]:c[c.length-1],E=y?c[1]:c[c.length-2],g=y?c[c.length-1]:c[0],b=y?c[c.length-2]:c[1];if(t.pointsCollinear(E,w,k)&&(y?(e&&e.chainRemoveHead(a.index,k),c.shift()):(e&&e.chainRemoveTail(a.index,k),c.pop()),w=E),t.pointsSame(g,k)){n.splice(v,1),t.pointsCollinear(b,g,w)&&(y?(e&&e.chainRemoveTail(a.index,w),c.pop()):(e&&e.chainRemoveHead(a.index,w),c.shift())),e&&e.chainClose(a.index),s.push(c);return}y?(e&&e.chainAddHead(a.index,k),c.unshift(k)):(e&&e.chainAddTail(a.index,k),c.push(k));return}function I(A){e&&e.chainReverse(A),n[A].reverse()}function O(A,K){var x=n[A],C=n[K],X=x[x.length-1],L=x[x.length-2],z=C[0],V=C[1];t.pointsCollinear(L,X,z)&&(e&&e.chainRemoveTail(A,X),x.pop(),X=L),t.pointsCollinear(X,z,V)&&(e&&e.chainRemoveHead(K,z),C.shift()),e&&e.chainJoin(A,K),n[A]=x.concat(C),n.splice(K,1)}var _=a.index,S=h.index;e&&e.chainConnect(_,S);var J=n[_].length<n[S].length;a.matches_head?h.matches_head?J?(I(_),O(_,S)):(I(S),O(S,_)):O(S,_):h.matches_head?O(_,S):J?(I(_),O(S,_)):(I(S),O(_,S))}),s}var kt=wt;function fe(r,t,e){var n=[];return r.forEach(function(s){var i=(s.myFill.above?8:0)+(s.myFill.below?4:0)+(s.otherFill&&s.otherFill.above?2:0)+(s.otherFill&&s.otherFill.below?1:0);t[i]!==0&&n.push({id:e?e.segmentId():-1,start:s.start,end:s.end,myFill:{above:t[i]===1,below:t[i]===2},otherFill:null})}),e&&e.selected(n),n}var Tt={union:function(r,t){return fe(r,[0,2,1,0,2,2,0,0,1,0,1,0,0,0,0,0],t)},intersect:function(r,t){return fe(r,[0,0,0,0,0,2,0,2,0,0,1,1,0,2,1,0],t)},difference:function(r,t){return fe(r,[0,0,0,0,2,0,2,0,1,1,0,0,0,1,2,0],t)},differenceRev:function(r,t){return fe(r,[0,2,1,0,0,0,1,1,0,2,0,2,0,0,0,0],t)},xor:function(r,t){return fe(r,[0,2,1,0,2,0,0,1,1,0,0,2,0,1,2,0],t)}},St=Tt,bt={toPolygon:function(r,t){function e(i){if(i.length<=0)return r.segments({inverted:!1,regions:[]});function o(h){var f=h.slice(0,h.length-1);return r.segments({inverted:!1,regions:[f]})}for(var l=o(i[0]),a=1;a<i.length;a++)l=r.selectDifference(r.combine(l,o(i[a])));return l}if(t.type==="Polygon")return r.polygon(e(t.coordinates));if(t.type==="MultiPolygon"){for(var n=r.segments({inverted:!1,regions:[]}),s=0;s<t.coordinates.length;s++)n=r.selectUnion(r.combine(n,e(t.coordinates[s])));return r.polygon(n)}throw new Error("PolyBool: Cannot convert GeoJSON object to PolyBool polygon")},fromPolygon:function(r,t,e){e=r.polygon(r.segments(e));function n(c,u){return t.pointInsideRegion([(c[0][0]+c[1][0])*.5,(c[0][1]+c[1][1])*.5],u)}function s(c){return{region:c,children:[]}}var i=s(null);function o(c,u){for(var p=0;p<c.children.length;p++){var v=c.children[p];if(n(u,v.region)){o(v,u);return}}for(var k=s(u),p=0;p<c.children.length;p++){var v=c.children[p];n(v.region,u)&&(k.children.push(v),c.children.splice(p,1),p--)}c.children.push(k)}for(var l=0;l<e.regions.length;l++){var a=e.regions[l];a.length<3||o(i,a)}function h(c,u){for(var p=0,v=c[c.length-1][0],k=c[c.length-1][1],y=[],w=0;w<c.length;w++){var E=c[w][0],g=c[w][1];y.push([E,g]),p+=g*v-E*k,v=E,k=g}var b=p<0;return b!==u&&y.reverse(),y.push([y[0][0],y[0][1]]),y}var f=[];function m(c){var u=[h(c.region,!1)];f.push(u);for(var p=0;p<c.children.length;p++)u.push(d(c.children[p]))}function d(c){for(var u=0;u<c.children.length;u++)m(c.children[u]);return h(c.region,!0)}for(var l=0;l<i.children.length;l++)m(i.children[l]);return f.length<=0?{type:"Polygon",coordinates:[]}:f.length==1?{type:"Polygon",coordinates:f[0]}:{type:"MultiPolygon",coordinates:f}}},Pt=bt;/*
 * @copyright 2016 Sean Connelly (@voidqk), http://syntheti.cc
 * @license MIT
 * @preserve Project Home: https://github.com/voidqk/polybooljs
 */var Ft=mt,Ot=dt,De=yt,It=kt,ce=St,Ue=Pt,G=!1,ue=Ot(),q;q={buildLog:function(r){return r===!0?G=Ft():r===!1&&(G=!1),G===!1?!1:G.list},epsilon:function(r){return ue.epsilon(r)},segments:function(r){var t=De(!0,ue,G);return r.regions.forEach(t.addRegion),{segments:t.calculate(r.inverted),inverted:r.inverted}},combine:function(r,t){var e=De(!1,ue,G);return{combined:e.calculate(r.segments,r.inverted,t.segments,t.inverted),inverted1:r.inverted,inverted2:t.inverted}},selectUnion:function(r){return{segments:ce.union(r.combined,G),inverted:r.inverted1||r.inverted2}},selectIntersect:function(r){return{segments:ce.intersect(r.combined,G),inverted:r.inverted1&&r.inverted2}},selectDifference:function(r){return{segments:ce.difference(r.combined,G),inverted:r.inverted1&&!r.inverted2}},selectDifferenceRev:function(r){return{segments:ce.differenceRev(r.combined,G),inverted:!r.inverted1&&r.inverted2}},selectXor:function(r){return{segments:ce.xor(r.combined,G),inverted:r.inverted1!==r.inverted2}},polygon:function(r){return{regions:It(r.segments,ue,G),inverted:r.inverted}},polygonFromGeoJSON:function(r){return Ue.toPolygon(q,r)},polygonToGeoJSON:function(r){return Ue.fromPolygon(q,ue,r)},union:function(r,t){return he(r,t,q.selectUnion)},intersect:function(r,t){return he(r,t,q.selectIntersect)},difference:function(r,t){return he(r,t,q.selectDifference)},differenceRev:function(r,t){return he(r,t,q.selectDifferenceRev)},xor:function(r,t){return he(r,t,q.selectXor)}};function he(r,t,e){var n=q.segments(r),s=q.segments(t),i=q.combine(n,s),o=e(i);return q.polygon(o)}typeof window=="object"&&(window.PolyBool=q);var me=q;class de{static union(t,e){return me.union(t,e)}static intersect(t,e){return me.intersect(t,e)}static difference(t,e){return me.difference(t,e)}static differenceRev(t,e){return me.differenceRev(t,e)}static xor(t,e){return me.xor(t,e)}}class W{constructor(t){N(this,"polygons",[]);N(this,"unoptimizedUnionVectors",[]);this.polygons=t}fastUnion(t){const e=new W(this.polygons);return e.unoptimizedUnionVectors=this.unoptimizedUnionVectors.concat([t]),e}union(t){const e=de.union({regions:this.polygons.map(n=>n.nodes),inverted:!1},{regions:t.polygons.map(n=>n.nodes),inverted:!1});return new W(e.regions.map(n=>({nodes:n})))}intersect(t){const e=de.intersect({regions:this.polygons.map(n=>n.nodes),inverted:!1},{regions:t.polygons.map(n=>n.nodes),inverted:!1});return new W(e.regions.map(n=>({nodes:n})))}difference(t){const e=de.difference({regions:this.polygons.map(n=>n.nodes),inverted:!1},{regions:t.polygons.map(n=>n.nodes),inverted:!1});return new W(e.regions.map(n=>({nodes:n})))}xor(t){const e=de.xor({regions:this.polygons.map(n=>n.nodes),inverted:!1},{regions:t.polygons.map(n=>n.nodes),inverted:!1});return new W(e.regions.map(n=>({nodes:n})))}optimize(){let t=new W(this.polygons);for(const e of this.unoptimizedUnionVectors)t=t.union(e);return t}}class et{static square(t,e,n,s){return new W([{nodes:[[t,e],[t+n,e],[t+n,e+s],[t,e+s]]}])}static circle(t,e,n,s,i=0){const o={nodes:[]};for(let l=0;l<Math.PI*2;l+=Math.PI/s){const a=l+i;o.nodes.push([t+Math.cos(a)*n,e+Math.sin(a)*n])}return new W([o])}}var D=(r=>(r[r.Point=0]="Point",r[r.MajorCity=1]="MajorCity",r[r.City=2]="City",r[r.Town=3]="Town",r[r.Village=4]="Village",r[r.PointOfInterest=99]="PointOfInterest",r))(D||{});class xt{constructor(){N(this,"version",1);N(this,"terrain",{vector:new W([])});N(this,"features",[]);N(this,"paths",[]);N(this,"points",[])}}class tt{async preload(){}render(t,e){e.clearRect(0,0,1200,860);for(let n=0;n<t.paths.length;n++)this.renderPath(t.paths[n],e)}renderPath(t,e){e.beginPath(),e.moveTo(t.nodes[0][0],t.nodes[0][1]);for(let n=1;n<t.nodes.length;n++){const s=this.midPointBtw(t.nodes[n-1],t.nodes[n]);e.quadraticCurveTo(t.nodes[n-1][0],t.nodes[n-1][1],s[0],s[1])}e.lineTo(t.nodes[t.nodes.length-1][0],t.nodes[t.nodes.length-1][1]),e.filter="blur(0.1px)",e.strokeStyle="#381d0aA0",e.lineWidth=2,e.lineCap="round",e.setLineDash([6,4]),e.stroke()}midPointBtw(t,e){return[t[0]+(e[0]-t[0])/2,t[1]+(e[1]-t[1])/2]}}class Ct{constructor(){N(this,"textures",new Map);N(this,"nameOptions",new Map)}async preload(){const t=new Image;t.src="/images/map/settlement-major-city.png",this.textures.set(D.MajorCity,t);const e=new Image;e.src="/images/map/settlement-city.png",this.textures.set(D.City,e);const n=new Image;n.src="/images/map/settlement-town.png",this.textures.set(D.Town,n);const s=new Image;s.src="/images/map/settlement-village.png",this.textures.set(D.Village,s);const i=new Image;i.src="/images/map/settlement-poi.png",this.textures.set(D.PointOfInterest,i),this.nameOptions.set(D.MajorCity,{render:!0,fontSize:14}),this.nameOptions.set(D.City,{render:!0,fontSize:12}),this.nameOptions.set(D.Town,{render:!0,fontSize:8}),this.nameOptions.set(D.Village,{render:!1,fontSize:0}),this.nameOptions.set(D.PointOfInterest,{render:!0,fontSize:8})}render(t,e){var n,s;e.clearRect(0,0,1200,860);for(const i of t.points){const o=this.textures.get(i.type);let l=5;o?(l=o.height,e.drawImage(o,i.x-o.width/2,i.y-o.height/2)):(e.strokeStyle="#381d0a",e.beginPath(),e.rect(i.x,i.y,5,5),e.stroke()),"name"in i&&((n=this.nameOptions.get(i.type))!=null&&n.render)&&(e.filter="blur(2px)",e.textAlign="center",e.fillStyle="white",e.font=`${(s=this.nameOptions.get(i.type))==null?void 0:s.fontSize}px Eczar`,e.fillText(new String(i.name).toString(),i.x,i.y+l),e.filter="none",e.fillStyle="#381d0a",e.fillText(new String(i.name).toString(),i.x,i.y+l))}}}class Nt{constructor(){N(this,"stampTexture");N(this,"offsets");N(this,"stampSize",[14,16]);N(this,"spacing",10)}async preload(){this.stampTexture=new Image,this.stampTexture.src="/images/map/tree-1.png"}render(t,e){this.offsets||(this.offsets=this.computeOffsets()),e.clearRect(0,0,1200,860),e.filter="blur(4px)",this.drawVector(t,e),e.filter="none",this.drawStamps(t,e)}drawVector(t,e){for(const n of t.features){e.beginPath();for(let s=0;s<n.vector.polygons.length;s++){const i=n.vector.polygons[s];e.moveTo(i.nodes[0][0],i.nodes[0][1]);for(let o=1;o<i.nodes.length;o++)e.lineTo(i.nodes[o][0],i.nodes[o][1])}e.strokeStyle="#381d0a30",e.fillStyle="#381d0a40",e.fill("evenodd"),e.stroke()}}drawStamps(t,e){if(!this.stampTexture)return;const n=e.getImageData(0,0,1200,860);for(let s=0;s<1200/this.spacing;s++)for(let i=0;i<860/this.spacing;i++){const o=this.offsets[s][i],l=[Math.round(s*this.spacing+o[0]),Math.round(i*this.spacing+o[1])];n.data[l[1]*(n.width*4)+l[0]*4+3]>=32&&e.drawImage(this.stampTexture,l[0]-this.stampSize[0]/2,l[1]-this.stampSize[1]/2)}}computeOffsets(){const t=[];for(let e=0;e<1200/this.spacing;e++){t.push([]);for(let n=0;n<860/this.spacing;n++)t[e][n]=[Math.random()*this.spacing*.7,Math.random()*this.spacing*.7]}return t}}class Rt{constructor(){N(this,"grassTexture");N(this,"grassPattern")}async preload(){this.grassTexture=new Image,this.grassTexture.src="/images/map/grass.png"}render(t,e,n){if(this.grassTexture&&!this.grassPattern){const s=e.createPattern(this.grassTexture,"repeat");s&&(this.grassPattern=s)}e.fillStyle=this.grassPattern||"#003000FF",e.clearRect(0,0,1200,860),e.beginPath();for(let s=0;s<t.terrain.vector.polygons.length;s++){const i=t.terrain.vector.polygons[s];e.moveTo(i.nodes[0][0],i.nodes[0][1]);for(let o=1;o<i.nodes.length;o++)e.lineTo(i.nodes[o][0],i.nodes[o][1]);e.closePath()}e.strokeStyle="#FFFFFF30",e.filter="blur(8px)",e.lineWidth=32,e.stroke(),e.filter="none",e.fill("evenodd"),e.strokeStyle="#381d0a30",e.lineWidth=3,e.stroke();for(let s=0;s<t.terrain.vector.unoptimizedUnionVectors.length;s++){const i=t.terrain.vector.unoptimizedUnionVectors[s];e.beginPath();for(let o=0;o<i.polygons.length;o++){const l=i.polygons[o];e.moveTo(l.nodes[0][0],l.nodes[0][1]);for(let a=1;a<l.nodes.length;a++)e.lineTo(l.nodes[a][0],l.nodes[a][1])}e.fill("evenodd")}}}let ve;const se={background:0,terrain:1,terrainFeatures:2,paths:3,points:4,tool:5};class Mt{constructor(){N(this,"terrainRenderer");N(this,"terrainFeatureRenderer");N(this,"pointRenderer");N(this,"pathRenderer",new tt);this.terrainRenderer=new Rt,this.terrainFeatureRenderer=new Nt,this.pointRenderer=new Ct,!(typeof document>"u")&&(setTimeout(()=>this.terrainRenderer.preload(),100),setTimeout(()=>this.terrainFeatureRenderer.preload(),100),setTimeout(()=>this.pointRenderer.preload(),100))}renderBackground(t,e,n){ve||(ve=new Image,ve.src="/images/map/water.png");const s=e.createPattern(ve,"repeat");s&&(e.fillStyle=s,e.fillRect(n.x,n.y,n.width,n.height))}renderTerrain(t,e,n){this.terrainRenderer.render(t,e,n)}renderTerrainFeatures(t,e){this.terrainFeatureRenderer.render(t,e)}renderPoints(t,e){this.pointRenderer.render(t,e)}renderPaths(t,e){this.pathRenderer.render(t,e)}renderTool(t,e,n,s){s.clearRect(0,0,1200,860),t.render(e,n,s)}}var At=Object.defineProperty,Et=(r,t,e)=>t in r?At(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Bt=(r,t,e)=>(Et(r,typeof t!="symbol"?t+"":t,e),e);const Ee=class{static register(t,e){this.listeners.push({key:t.key,modifiers:t.modifiers,callback:e})}};Bt(Ee,"listeners",[]);typeof document<"u"?document.addEventListener("keydown",r=>{for(const t of Ee.listeners)r.key===t.key&&t.callback()}):console.error("No document on keybind registration. No keybinds will work");let pe=Ee;class nt{constructor(t){this.model=t}getNearestPoint(t,e,n){const s=n*n;let i,o=1/0;for(const l of this.model.points){const a=(l.x-t)*(l.x-t)+(l.y-e)*(l.y-e);a<=s&&a<o&&(i=l,o=a)}return i}}const ge=class ge{constructor(t,e,n,s){this.x=t,this.y=e,this.width=n,this.height=s}};N(ge,"NO_PAINT",new ge(0,0,0,0));let H=ge;const zt=[{id:D.MajorCity,label:"Major City"},{id:D.City,label:"City"},{id:D.Town,label:"Town"},{id:D.Village,label:"Village"},{id:D.PointOfInterest,label:"PointOfInterest"}];class Dt{getOptions(){return[{name:"Type",key:"type",type:"enum",options:zt}]}click(t,e,n){if(new nt(e).getNearestPoint(t.x,t.y,5))return H.NO_PAINT;{const i={x:t.x,y:t.y,type:n.type,name:""};e.points.push(i)}}pressDown(){return H.NO_PAINT}release(){return H.NO_PAINT}render(){}}class Ut{constructor(t){this.onSelectionChanged=t}getOptions(){return[]}click(t,e){const n=new nt(e).getNearestPoint(t.x,t.y,5);return n?(this.onSelectionChanged("point",n),H.NO_PAINT):(this.onSelectionChanged("none",void 0),H.NO_PAINT)}pressDown(){return H.NO_PAINT}release(){}render(){}}class jt{getOptions(){return[{key:"size",name:"Size",type:"number",default:25,min:5,max:100,step:1},{key:"erase",name:"Erase",type:"boolean"}]}click(){return H.NO_PAINT}pressDown(t,e,n){const s=Math.ceil(n.size/(8*Math.PI))+3,i=et.circle(t.x,t.y,n.size,s,Math.random()*Math.PI);e.features.length===0&&e.features.push({type:"forest",vector:new W([])}),n.erase?e.features[0].vector=e.features[0].vector.difference(i):e.features[0].vector=e.features[0].vector.union(i)}release(t,e){e.features[0].vector=e.features[0].vector.optimize()}render(t,e,n){n.beginPath(),n.fillStyle="#FFFFFF50",n.arc(t[0],t[1],e.size,0,Math.PI*2),n.fill()}}class Ht{getOptions(){return[{key:"size",name:"Size",type:"number",default:25,min:5,max:100,step:1},{key:"erase",name:"Erase",type:"boolean"}]}click(){return H.NO_PAINT}pressDown(t,e,n){const s=Math.ceil(n.size/(2*Math.PI))+3,i=et.circle(t.x,t.y,n.size,s,Math.random()*Math.PI);n.erase?e.terrain.vector=e.terrain.vector.difference(i):e.terrain.vector=e.terrain.vector.union(i)}release(t,e){e.terrain.vector=e.terrain.vector.optimize()}render(t,e,n){n.beginPath(),n.fillStyle="#FFFFFF50",n.arc(t[0],t[1],e.size,0,Math.PI*2),n.fill()}}class Vt{constructor(){N(this,"nodes",[])}getOptions(){return[]}click(t,e){if(this.nodes.length>=1&&this.nodes[this.nodes.length-1][0]===t.x&&this.nodes[this.nodes.length-1][1]===t.y){e.paths.push({nodes:this.nodes});const n={minx:1/0,miny:1/0,maxx:-1/0,maxy:-1/0};for(const s of this.nodes)n.minx=Math.min(n.minx,s[0]),n.miny=Math.min(n.miny,s[0]),n.maxx=Math.max(n.maxx,s[1]),n.maxy=Math.max(n.maxy,s[1]);return this.nodes=[],new H(n.minx,n.miny,n.maxx-n.minx,n.maxy-n.miny)}return this.nodes.push([t.x,t.y]),H.NO_PAINT}pressDown(){return H.NO_PAINT}release(){return H.NO_PAINT}render(t,e,n){if(this.nodes.length>0){const s=this.nodes.concat([t]);new tt().renderPath({nodes:s},n)}}}function Jt(r){let t,e,n='<i class="fa fa-arrow-pointer"></i>',s,i,o='<i class="fa fa-paintbrush"></i>',l,a,h='<i class="fa fa-landmark"></i>',f,m,d='<i class="fa fa-tree"></i>',c,u,p='<i class="fa fa-road"></i>',v,k;return{c(){t=R("div"),e=R("button"),e.innerHTML=n,s=U(),i=R("button"),i.innerHTML=o,l=U(),a=R("button"),a.innerHTML=h,f=U(),m=R("button"),m.innerHTML=d,c=U(),u=R("button"),u.innerHTML=p,this.h()},l(y){t=M(y,"DIV",{class:!0});var w=$(t);e=M(w,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),re(e)!=="svelte-1n6mnah"&&(e.innerHTML=n),s=j(w),i=M(w,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),re(i)!=="svelte-1q2mh60"&&(i.innerHTML=o),l=j(w),a=M(w,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),re(a)!=="svelte-10fbohv"&&(a.innerHTML=h),f=j(w),m=M(w,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),re(m)!=="svelte-dgiflo"&&(m.innerHTML=d),c=j(w),u=M(w,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),re(u)!=="svelte-1gmqo2i"&&(u.innerHTML=p),w.forEach(P),this.h()},h(){T(e,"title","Selection tool (S)"),T(e,"class","svelte-wqemx0"),Q(e,"selected",r[0]==="select"),T(i,"title","Terrain tool (T)"),T(i,"class","svelte-wqemx0"),Q(i,"selected",r[0]==="terrain"),T(a,"title","Settlement tool (E)"),T(a,"class","svelte-wqemx0"),Q(a,"selected",r[0]==="point"),T(m,"title","Forest tool (F)"),T(m,"class","svelte-wqemx0"),Q(m,"selected",r[0]==="forest"),T(u,"title","Path tool (P)"),T(u,"class","svelte-wqemx0"),Q(u,"selected",r[0]==="path"),T(t,"class","toolbar svelte-wqemx0")},m(y,w){B(y,t,w),F(t,e),F(t,s),F(t,i),F(t,l),F(t,a),F(t,f),F(t,m),F(t,c),F(t,u),v||(k=[Y(e,"click",r[2]),Y(i,"click",r[3]),Y(a,"click",r[4]),Y(m,"click",r[5]),Y(u,"click",r[6])],v=!0)},p(y,[w]){w&1&&Q(e,"selected",y[0]==="select"),w&1&&Q(i,"selected",y[0]==="terrain"),w&1&&Q(a,"selected",y[0]==="point"),w&1&&Q(m,"selected",y[0]==="forest"),w&1&&Q(u,"selected",y[0]==="path")},i:ie,o:ie,d(y){y&&P(t),v=!1,Ce(k)}}}function qt(r,t,e){const n=Ne(),s={select:new Ut((d,c)=>e(1,o=c)),terrain:new Ht,point:new Dt,forest:new jt,path:new Vt};let{selectedToolKey:i="terrain"}=t;setTimeout(()=>{n("toolSelected",s[i])},200),pe.register({key:"s"},()=>e(0,i="select")),pe.register({key:"t"},()=>e(0,i="terrain")),pe.register({key:"e"},()=>e(0,i="point")),pe.register({key:"f"},()=>e(0,i="forest")),pe.register({key:"p"},()=>e(0,i="path"));let{selectedPoint:o=void 0}=t;const l=()=>e(0,i="select"),a=()=>e(0,i="terrain"),h=()=>e(0,i="point"),f=()=>e(0,i="forest"),m=()=>e(0,i="path");return r.$$set=d=>{"selectedToolKey"in d&&e(0,i=d.selectedToolKey),"selectedPoint"in d&&e(1,o=d.selectedPoint)},r.$$.update=()=>{r.$$.dirty&1&&n("toolSelected",s[i])},[i,o,l,a,h,f,m]}class Xt extends ye{constructor(t){super(),we(this,t,qt,Jt,_e,{selectedToolKey:0,selectedPoint:1})}}function je(r,t,e){const n=r.slice();return n[6]=t[e],n}function He(r){let t;return{c(){t=R("canvas"),this.h()},l(e){t=M(e,"CANVAS",{id:!0,width:!0,height:!0,style:!0,class:!0}),$(t).forEach(P),this.h()},h(){T(t,"id","layer-"+r[6]),T(t,"width","1200"),T(t,"height","860"),lt(t,"border","1px solid #000000"),T(t,"class","svelte-1cguo7c")},m(e,n){B(e,t,n)},p:ie,d(e){e&&P(t)}}}function Yt(r){let t,e=le(Object.values(se)),n=[];for(let s=0;s<e.length;s+=1)n[s]=He(je(r,e,s));return{c(){t=R("div");for(let s=0;s<n.length;s+=1)n[s].c();this.h()},l(s){t=M(s,"DIV",{class:!0});var i=$(t);for(let o=0;o<n.length;o+=1)n[o].l(i);i.forEach(P),this.h()},h(){T(t,"class","canvas-container svelte-1cguo7c")},m(s,i){B(s,t,i);for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(t,null)},p(s,[i]){if(i&0){e=le(Object.values(se));let o;for(o=0;o<e.length;o+=1){const l=je(s,e,o);n[o]?n[o].p(l,i):(n[o]=He(l),n[o].c(),n[o].m(t,null))}for(;o<n.length;o+=1)n[o].d(1);n.length=e.length}},i:ie,o:ie,d(s){s&&P(t),Re(n,s)}}}function Kt(r,t,e){const n=Ne();let{model:s}=t;const i=new Mt;let o=[];ot(()=>{const h=Array.from(document.querySelectorAll("canvas"));o=h.map(m=>m.getContext("2d"));const f=h[h.length-1];l(),i.renderBackground(s,o[0],new H(0,0,1200,860)),f.addEventListener("mousedown",m=>{n("click",{x:m.clientX-(f.offsetLeft??0),y:m.clientY-(f.offsetTop??0)}),n("pressDown",{x:m.clientX-(f.offsetLeft??0),y:m.clientY-(f.offsetTop??0)})}),f.addEventListener("mousemove",m=>{m.buttons===1&&n("pressDown",{x:m.clientX-(f.offsetLeft??0),y:m.clientY-(f.offsetTop??0)}),n("move",{x:m.clientX-(f.offsetLeft??0),y:m.clientY-(f.offsetTop??0)})}),f.addEventListener("mouseup",m=>{n("release",{x:m.clientX-(f.offsetLeft??0),y:m.clientY-(f.offsetTop??0)})})});function l(h){const f=h??new H(0,0,1200,860);i.renderTerrain(s,o[se.terrain],f),i.renderTerrainFeatures(s,o[se.terrainFeatures]),i.renderPoints(s,o[se.points]),i.renderPaths(s,o[se.paths])}function a(h,f,m){i.renderTool(h,f,m,o[se.tool])}return r.$$set=h=>{"model"in h&&e(0,s=h.model)},[s,l,a]}class Gt extends ye{constructor(t){super(),we(this,t,Kt,Yt,_e,{model:0,render:1,renderTool:2})}get render(){return this.$$.ctx[1]}get renderTool(){return this.$$.ctx[2]}}function Ve(r,t,e){const n=r.slice();return n[10]=t[e],n[11]=t,n[12]=e,n}function Je(r,t,e){const n=r.slice();return n[13]=t[e],n}function qe(r){let t,e=le(r[1].getOptions()),n=[];for(let s=0;s<e.length;s+=1)n[s]=Ze(Ve(r,e,s));return{c(){for(let s=0;s<n.length;s+=1)n[s].c();t=oe()},l(s){for(let i=0;i<n.length;i+=1)n[i].l(s);t=oe()},m(s,i){for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(s,i);B(s,t,i)},p(s,i){if(i&6){e=le(s[1].getOptions());let o;for(o=0;o<e.length;o+=1){const l=Ve(s,e,o);n[o]?n[o].p(l,i):(n[o]=Ze(l),n[o].c(),n[o].m(t.parentNode,t))}for(;o<n.length;o+=1)n[o].d(1);n.length=e.length}},d(s){s&&P(t),Re(n,s)}}}function Xe(r){let t,e,n,s,i,o;function l(){r[4].call(t,r[10])}let a="min"in r[10]&&Ye(r);return{c(){t=R("input"),n=U(),a&&a.c(),s=oe(),this.h()},l(h){t=M(h,"INPUT",{name:!0,type:!0}),n=j(h),a&&a.l(h),s=oe(),this.h()},h(){T(t,"name",e=r[10].key),T(t,"type","number")},m(h,f){B(h,t,f),te(t,r[2][r[10].key]),B(h,n,f),a&&a.m(h,f),B(h,s,f),i||(o=Y(t,"input",l),i=!0)},p(h,f){r=h,f&2&&e!==(e=r[10].key)&&T(t,"name",e),f&6&&xe(t.value)!==r[2][r[10].key]&&te(t,r[2][r[10].key]),"min"in r[10]?a?a.p(r,f):(a=Ye(r),a.c(),a.m(s.parentNode,s)):a&&(a.d(1),a=null)},d(h){h&&(P(t),P(n),P(s)),a&&a.d(h),i=!1,o()}}}function Ye(r){let t,e,n,s,i,o,l;function a(){r[5].call(t,r[10])}return{c(){t=R("input"),this.h()},l(h){t=M(h,"INPUT",{name:!0,type:!0,min:!0,max:!0,step:!0}),this.h()},h(){T(t,"name",e=r[10].key),T(t,"type","range"),T(t,"min",n=r[10].min),T(t,"max",s=r[10].max),T(t,"step",i=r[10].step)},m(h,f){B(h,t,f),te(t,r[2][r[10].key]),o||(l=[Y(t,"change",a),Y(t,"input",a)],o=!0)},p(h,f){r=h,f&2&&e!==(e=r[10].key)&&T(t,"name",e),f&2&&n!==(n=r[10].min)&&T(t,"min",n),f&2&&s!==(s=r[10].max)&&T(t,"max",s),f&2&&i!==(i=r[10].step)&&T(t,"step",i),f&6&&te(t,r[2][r[10].key])},d(h){h&&P(t),o=!1,Ce(l)}}}function Ke(r){let t,e,n,s;function i(){r[6].call(t,r[10])}return{c(){t=R("input"),this.h()},l(o){t=M(o,"INPUT",{name:!0,type:!0}),this.h()},h(){T(t,"name",e=r[10].key),T(t,"type","checkbox")},m(o,l){B(o,t,l),t.checked=r[2][r[10].key],n||(s=Y(t,"change",i),n=!0)},p(o,l){r=o,l&2&&e!==(e=r[10].key)&&T(t,"name",e),l&6&&(t.checked=r[2][r[10].key])},d(o){o&&P(t),n=!1,s()}}}function Ge(r){let t,e,n,s,i=le(r[10].options),o=[];for(let a=0;a<i.length;a+=1)o[a]=We(Je(r,i,a));function l(){r[7].call(t,r[10])}return{c(){t=R("select");for(let a=0;a<o.length;a+=1)o[a].c();this.h()},l(a){t=M(a,"SELECT",{name:!0});var h=$(t);for(let f=0;f<o.length;f+=1)o[f].l(h);h.forEach(P),this.h()},h(){T(t,"name",e=r[10].key),r[2][r[10].key]===void 0&&ft(l)},m(a,h){B(a,t,h);for(let f=0;f<o.length;f+=1)o[f]&&o[f].m(t,null);ze(t,r[2][r[10].key],!0),n||(s=Y(t,"change",l),n=!0)},p(a,h){if(r=a,h&2){i=le(r[10].options);let f;for(f=0;f<i.length;f+=1){const m=Je(r,i,f);o[f]?o[f].p(m,h):(o[f]=We(m),o[f].c(),o[f].m(t,null))}for(;f<o.length;f+=1)o[f].d(1);o.length=i.length}h&2&&e!==(e=r[10].key)&&T(t,"name",e),h&6&&ze(t,r[2][r[10].key])},d(a){a&&P(t),Re(o,a),n=!1,s()}}}function We(r){let t,e=r[13].label+"",n,s;return{c(){t=R("option"),n=Me(e),this.h()},l(i){t=M(i,"OPTION",{});var o=$(t);n=Ae(o,e),o.forEach(P),this.h()},h(){t.__value=s=r[13].id,te(t,t.__value)},m(i,o){B(i,t,o),F(t,n)},p(i,o){o&2&&e!==(e=i[13].label+"")&&Le(n,e),o&2&&s!==(s=i[13].id)&&(t.__value=s,te(t,t.__value))},d(i){i&&P(t)}}}function Ze(r){let t,e,n=r[10].name+"",s,i,o,l,a,h,f=r[10].type==="number"&&Xe(r),m=r[10].type==="boolean"&&Ke(r),d=r[10].type==="enum"&&Ge(r);return{c(){t=R("div"),e=R("label"),s=Me(n),o=U(),f&&f.c(),l=U(),m&&m.c(),a=U(),d&&d.c(),h=U(),this.h()},l(c){t=M(c,"DIV",{class:!0});var u=$(t);e=M(u,"LABEL",{for:!0});var p=$(e);s=Ae(p,n),p.forEach(P),o=j(u),f&&f.l(u),l=j(u),m&&m.l(u),a=j(u),d&&d.l(u),h=j(u),u.forEach(P),this.h()},h(){T(e,"for",i=r[10].key),T(t,"class","option svelte-78v74y")},m(c,u){B(c,t,u),F(t,e),F(e,s),F(t,o),f&&f.m(t,null),F(t,l),m&&m.m(t,null),F(t,a),d&&d.m(t,null),F(t,h)},p(c,u){u&2&&n!==(n=c[10].name+"")&&Le(s,n),u&2&&i!==(i=c[10].key)&&T(e,"for",i),c[10].type==="number"?f?f.p(c,u):(f=Xe(c),f.c(),f.m(t,l)):f&&(f.d(1),f=null),c[10].type==="boolean"?m?m.p(c,u):(m=Ke(c),m.c(),m.m(t,a)):m&&(m.d(1),m=null),c[10].type==="enum"?d?d.p(c,u):(d=Ge(c),d.c(),d.m(t,h)):d&&(d.d(1),d=null)},d(c){c&&P(t),f&&f.d(),m&&m.d(),d&&d.d()}}}function Qe(r){let t,e,n;return{c(){t=R("input"),this.h()},l(s){t=M(s,"INPUT",{type:!0}),this.h()},h(){T(t,"type","text")},m(s,i){B(s,t,i),te(t,r[0].name),e||(n=Y(t,"input",r[8]),e=!0)},p(s,i){i&1&&t.value!==s[0].name&&te(t,s[0].name)},d(s){s&&P(t),e=!1,n()}}}function Wt(r){let t,e,n=r[1]&&qe(r),s=r[0]!==void 0&&"name"in r[0]&&Qe(r);return{c(){n&&n.c(),t=U(),s&&s.c(),e=oe()},l(i){n&&n.l(i),t=j(i),s&&s.l(i),e=oe()},m(i,o){n&&n.m(i,o),B(i,t,o),s&&s.m(i,o),B(i,e,o)},p(i,[o]){i[1]?n?n.p(i,o):(n=qe(i),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null),i[0]!==void 0&&"name"in i[0]?s?s.p(i,o):(s=Qe(i),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null)},i:ie,o:ie,d(i){i&&(P(t),P(e)),n&&n.d(i),s&&s.d(i)}}}function Zt(r,t,e){const n=Ne();let{selectedPoint:s}=t,{selectedTool:i}=t,o;const l={};function a(c){l[c.key]=xe(this.value),e(2,l),e(1,i),e(3,o),e(1,i)}function h(c){l[c.key]=xe(this.value),e(2,l),e(1,i),e(3,o),e(1,i)}function f(c){l[c.key]=this.checked,e(2,l),e(1,i),e(3,o),e(1,i)}function m(c){l[c.key]=at(this),e(2,l),e(1,i),e(3,o),e(1,i)}function d(){s.name=this.value,e(0,s)}return r.$$set=c=>{"selectedPoint"in c&&e(0,s=c.selectedPoint),"selectedTool"in c&&e(1,i=c.selectedTool)},r.$$.update=()=>{if(r.$$.dirty&14){if(e(3,o=i==null?void 0:i.getOptions()),o){e(3,o=i.getOptions());for(const c of o)"default"in c&&e(2,l[c.key]=l[c.key]??c.default,l)}n("optionsChanged",l)}r.$$.dirty&4&&n("optionsChanged",l)},[s,i,l,o,a,h,f,m,d]}class Qt extends ye{constructor(t){super(),we(this,t,Zt,Wt,_e,{selectedPoint:0,selectedTool:1})}}function Lt(r){let t,e,n,s,i,o,l,a,h,f,m,d,c,u,p="Upload",v,k,y=`        Terrain nodes: TODO
    `,w,E,g;function b(_){r[12](_)}let I={};r[1]!==void 0&&(I.selectedPoint=r[1]),t=new Xt({props:I}),$e.push(()=>ut(t,"selectedPoint",b)),t.$on("toolSelected",r[13]);let O={model:r[6]};return s=new Gt({props:O}),r[14](s),s.$on("click",r[7]),s.$on("pressDown",r[8]),s.$on("move",r[9]),s.$on("release",r[10]),l=new Qt({props:{selectedTool:r[2],selectedPoint:r[1]}}),l.$on("optionsChanged",r[15]),{c(){Se(t.$$.fragment),n=U(),Se(s.$$.fragment),i=U(),o=R("div"),Se(l.$$.fragment),a=U(),h=R("a"),f=Me("Download"),m=U(),d=R("input"),c=U(),u=R("button"),u.textContent=p,v=U(),k=R("pre"),k.textContent=y,this.h()},l(_){be(t.$$.fragment,_),n=j(_),be(s.$$.fragment,_),i=j(_),o=M(_,"DIV",{class:!0});var S=$(o);be(l.$$.fragment,S),a=j(S),h=M(S,"A",{href:!0,download:!0});var J=$(h);f=Ae(J,"Download"),J.forEach(P),m=j(S),d=M(S,"INPUT",{id:!0,type:!0}),c=j(S),u=M(S,"BUTTON",{"data-svelte-h":!0}),re(u)!=="svelte-15774uw"&&(u.textContent=p),v=j(S),k=M(S,"PRE",{"data-svelte-h":!0}),re(k)!=="svelte-1a79yfc"&&(k.textContent=y),S.forEach(P),this.h()},h(){T(h,"href",r[4]),T(h,"download","map.json"),T(d,"id","many"),T(d,"type","file"),T(o,"class","sidebar svelte-1eawmxs")},m(_,S){Pe(t,_,S),B(_,n,S),Pe(s,_,S),B(_,i,S),B(_,o,S),Pe(l,o,null),F(o,a),F(o,h),F(h,f),F(o,m),F(o,d),F(o,c),F(o,u),F(o,v),F(o,k),w=!0,E||(g=[Y(d,"change",r[16]),Y(u,"click",r[11])],E=!0)},p(_,[S]){const J={};!e&&S&2&&(e=!0,J.selectedPoint=_[1],ct(()=>e=!1)),t.$set(J);const A={};S&64&&(A.model=_[6]),s.$set(A);const K={};S&4&&(K.selectedTool=_[2]),S&2&&(K.selectedPoint=_[1]),l.$set(K),(!w||S&16)&&T(h,"href",_[4])},i(_){w||(Fe(t.$$.fragment,_),Fe(s.$$.fragment,_),Fe(l.$$.fragment,_),w=!0)},o(_){Oe(t.$$.fragment,_),Oe(s.$$.fragment,_),Oe(l.$$.fragment,_),w=!1},d(_){_&&(P(n),P(i),P(o)),Ie(t,_),r[14](null),Ie(s,_),Ie(l),E=!1,Ce(g)}}}function $t(r,t,e){let n,s,i={},o="",l,a;const h=new xt;function f(b){let I=s.click(b.detail,h,i);a.render(I),p()}function m(b){let I=s.pressDown(b.detail,h,i);a.render(I),p()}function d(b){a.renderTool(s,[b.detail.x,b.detail.y],i)}function c(b){let I=s.release(b.detail,h,i);a.render(I),p()}let u;function p(){u&&clearTimeout(u),u=setTimeout(()=>{e(4,o="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(h)))},100)}function v(){if(!l)return;let b=new FileReader;b.onload=function(I){var O,_;console.log(JSON.parse(((O=I.target)==null?void 0:O.result)||"")),Object.assign(h,JSON.parse(((_=I.target)==null?void 0:_.result)||"")),e(6,h.terrain.vector=new W(h.terrain.vector.polygons),h),a.render(),p()},b.readAsText(l[0])}function k(b){n=b,e(1,n)}const y=b=>e(2,s=b.detail);function w(b){$e[b?"unshift":"push"](()=>{a=b,e(5,a)})}const E=b=>e(3,i=b.detail);function g(){l=this.files,e(0,l)}return r.$$.update=()=>{if(r.$$.dirty&1&&l){console.log(l);for(const b of l)console.log(`${b.name}: ${b.size} bytes`)}},[l,n,s,i,o,a,h,f,m,d,c,v,k,y,w,E,g]}class sn extends ye{constructor(t){super(),we(this,t,$t,Lt,_e,{})}}export{sn as component};
